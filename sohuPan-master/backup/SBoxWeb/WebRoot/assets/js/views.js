Sbox.Views.Layout=Backbone.View.extend({el:$("#content"),template:_.template($("#layout-template").html()),initialize:function(){this.render()},render:function(){this.$el.html(this.template());new Sbox.Views.SideBar;return this}});
Sbox.Views.SideBar=Backbone.View.extend({el:$("#content"),template:_.template($("#sidebar-template").html()),events:{"click #myFileHead":"myFile","click #publicFileHead":"publikFile","click #shareFileHead":"shareFile","click #outChainHead":"outChain","click .outchain .outlink":"outlink","click .outchain .uploadlink":"uploadlink","click #recycleBinHead":"recycleBin"},initialize:function(){this.render()},render:function(){this.$("#sidebar").html(this.template());return this},myFile:function(){Backbone.history.navigate("!/"+
MY_DISK_NAME,!0)},publikFile:function(){Backbone.history.navigate("!/"+PUBLIC_DISK_NAME,!0)},shareFile:function(){Backbone.history.navigate("!/"+SHARE_DISK_NAME,!0)},outChain:function(){var a=$("#outChainHead").next();0===a.find("li.cur").length?a.find(".outlink").trigger("click"):a.find("li.cur").trigger("click")},outlink:function(){Backbone.history.navigate("!/"+OUT_CHAIN+"/outlink",!0)},uploadlink:function(){Backbone.history.navigate("!/"+OUT_CHAIN+"/uploadlink",!0)},recycleBin:function(){Backbone.history.navigate("!/"+
RECYCLE_BIN,!0)}});
Sbox.Views.MyFileView=Backbone.View.extend({className:"my-file",initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path;this.render()},render:function(){var a=new Sbox.Views.MainOperation({fileList:this.fileList,path:this.path}),b=new Sbox.Views.PathView({model:this.path}),c=new Sbox.Views.ViewChangeView({fileList:this.fileList}),d=new Sbox.Views.FileManage({fileList:this.fileList,path:this.path});this.$el.append(a.render().el).append(b.render().el).append(c.render().el).append(d.render().el).appendTo($("#main"));return this}});
Sbox.Views.PublicFileView=Backbone.View.extend({className:"public-file",initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path;this.render()},render:function(){var a=new Sbox.Views.MainOperation({fileList:this.fileList,path:this.path}),b=new Sbox.Views.PathView({model:this.path}),c=new Sbox.Views.ViewChangeView({fileList:this.fileList}),d=new Sbox.Views.FileManage({fileList:this.fileList,path:this.path});this.$el.append(a.render().el).append(b.render().el).append(c.render().el).append(d.render().el).appendTo($("#main"));
return this}});
Sbox.Views.ShareFileView=Backbone.View.extend({className:"share-file",initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path;this.render()},render:function(){var a=new Sbox.Views.MainOperation({fileList:this.fileList,path:this.path}),b=new Sbox.Views.PathView({model:this.path}),c=new Sbox.Views.ViewChangeView({fileList:this.fileList}),d=new Sbox.Views.FileManage({fileList:this.fileList,path:this.path});this.$el.append(a.render().el).append(b.render().el).append(c.render().el).append(d.render().el).appendTo($("#main"));return this}});
Sbox.Views.MainOperation=Backbone.View.extend({className:"main-op",template:_.template($("#mainOperation-template").html()),events:{"click .upload":"upload","click .create":"create"},initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path;_.bindAll(this,"reset","render");this.fileList.bind("reset",this.reset)},render:function(){this.$el.html(this.template());this.$("a.upload").addClass("upload-disabled");this.$("a.create").addClass("create-disabled");return this},upload:function(a){$(a.currentTarget).hasClass("upload-disabled")||
(Sbox.Upload(this.path,"upload",this.fileList),a.preventDefault())},create:function(a){if(!$(a.currentTarget).hasClass("create-disabled")){var b=new Date,b=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" "+b.getHours()+":"+b.getMinutes(),b=new Sbox.Models.File({parentDir:this.path.get("pathId"),note:"",modifyTime:b,size:-1,shareFlag:0,name:""});this.fileList.add(b);this.$("a.upload").addClass("upload-disabled");this.$("a.create").addClass("create-disabled");a.preventDefault()}},reset:function(){var a=
this.path,b=a.get("type"),a=a.get("acl");("share"===b||"public"===b)&&(null===a||1===a)?(this.$("a.upload").addClass("upload-disabled"),this.$("a.create").addClass("create-disabled")):2===a?(this.$("a.upload").removeClass("upload-disabled"),this.$("a.create").addClass("create-disabled")):3===a?(this.$("a.upload").removeClass("upload-disabled"),this.$("a.create").removeClass("create-disabled")):4===a?(this.$("a.upload").addClass("upload-disabled"),this.$("a.create").addClass("create-disabled")):5===
a?(this.$("a.upload").removeClass("upload-disabled"),this.$("a.create").addClass("create-disabled")):6===a?(this.$("a.upload").removeClass("upload-disabled"),this.$("a.create").addClass("create-disabled")):(this.$("a.upload").removeClass("upload-disabled"),this.$("a.create").removeClass("create-disabled"))}});
Sbox.Views.PathView=Backbone.View.extend({className:"navigation",template:_.template($("#navigation-template").html()),events:{"click .up a":"goback","click .path a":"gopath"},initialize:function(){_.bindAll(this,"render");this.model.bind("change",this.render);this.model.bind("path.load",this.render)},render:function(){var a=this.model.get("path");this.path=a=a.split("/").slice(1);this.$el.html(this.template({paths:a}));return this},goback:function(a){$(a.currentTarget).hasClass("disabled")||(this.gopath(this.path.length-
1),a.preventDefault())},gopath:function(a){var b;$.isNumeric(a)?b=a-1:(b=parseInt($(a.currentTarget).attr("_index")),a.preventDefault());this.path=this.path.slice(0,b+1);Backbone.history.navigate("!/"+this.path.join("/"),!0)}});
Sbox.Views.ViewChangeView=Backbone.View.extend({className:"view-change",template:_.template($("#view-change-template").html()),events:{"click a":"changeView"},initialize:function(){this.fileList=this.options.fileList},render:function(){this.$el.html(this.template());"preview"===$.cookie("showtype")?this.$(".pview").addClass("on"):this.$(".lview").addClass("on");return this},changeView:function(a){var b=$(a.currentTarget);b.hasClass("on")||(b.hasClass("lview")?(this.fileList.trigger("view.change",
"listview"),$.cookie("showtype","listview")):(this.fileList.trigger("view.change","preview"),$.cookie("showtype","preview")),this.$(".on").removeClass("on"),b.addClass("on"),a.preventDefault())}});
Sbox.Views.ToolBarView=Backbone.View.extend({className:"toolbar",template:_.template($("#toolbar-template").html()),events:{"click .upload":"upload","click .quitshare":"quitshare","click .show-member":"showMember","click .share":"share","click .file-view":"preview","click .download":"download","click .outchain":"createOutChain","click .uploadlink":"createUploadLink","click .remark":"editRemark","click .move":"move","click .copy":"copy","click .rename":"rename","click .delete":"del","click .history":"checkHistory",
"click .lock":"lock","click .setsize":"setSize","click .share-setting":"setShare","click .share-cancle":"cancleShare","click .outchain-setting":"setOutChain","click .outchain-cancle":"cancleOutChain","click .outchain-view":"viewOutChain","click .outchain-send":"sendOutChain","click .uploadlink-setting":"setUploadLink","click .uploadlink-cancle":"cancleUploadLink","click .uploadlink-view":"viewUploadLink","mouseenter li.has-sub":"showSubMenu","mouseleave li.has-sub":"hideSubMenu"},initialize:function(){this.fileList=
this.options.fileList;this.path=this.options.path;this.model=new Sbox.Models.ToolBar;_.bindAll(this,"render","select");this.model.bind("change",this.render);this.fileList.bind("change",this.select);this.fileList.bind("reset",this.select)},render:function(){this.$el.html(this.template(this.model.toJSON()));return this},select:function(){var a=this.fileList.getChecked();0===a.length?this.$el.hide():this.$el.show();this.model.setSelectedFiles(a)},upload:function(a){var b=this.fileList.getChecked()[0];
Sbox.Upload(b.get("id"),"upload",this.fileList);a.preventDefault()},share:function(a){var b=this.fileList.getChecked()[0];Sbox.Share(b);a.preventDefault()},quitshare:function(a){var b=this.fileList.getChecked(),c=this;Sbox.Warning({title:"\u9000\u51fa\u5171\u4eab",message:'<p>\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u8be5\u6587\u4ef6\u5939\u5171\u4eab\u5417\uff1f</p><p class="tip">\u9000\u51fa\u5171\u4eab\u540e\u8be5\u6587\u4ef6\u5939\u5c06\u88ab\u5220\u9664\uff01</p>',callback:function(a){a&&c.fileList.quitshare(b)}});
a.preventDefault()},showMember:function(a){var b=this.fileList.getChecked()[0];Sbox.ViewShareMember(b);a.preventDefault()},editRemark:function(a){var b=this.fileList.getChecked()[0];Sbox.EditRemark(b);a.preventDefault()},lock:function(a){var b=this.fileList.getChecked()[0];Sbox.Lock(b);a.preventDefault()},preview:function(a){var b=this.fileList.getChecked();isPreviewImgFile(b[0].get("name"),b[0].get("size"))?Sbox.Preview(b[0],this.fileList):window.open("/getFileOnline/"+b[0].get("id"));a.preventDefault()},
download:function(a){var b=this.fileList.getChecked();Sbox.Download(b);a.preventDefault()},rename:function(a){var b=this.fileList.getChecked()[0];Sbox.ReName(b);a.preventDefault()},move:function(a){var b=this.fileList.getChecked();Sbox.Move(b,!1,this.fileList,this.path.get("type"));a.preventDefault()},copy:function(a){var b=this.fileList.getChecked();Sbox.Move(b,!0,this.fileList,this.path.get("type"));a.preventDefault()},del:function(a){var b=this.fileList.getChecked();Sbox.DeleteFile(this.fileList,
b);a.preventDefault()},checkHistory:function(a){var b=this.fileList.getChecked()[0];window.open("/history/"+b.get("id")+"/"+b.get("versionNumber"));a.preventDefault()},setSize:function(a){var b=this.fileList.getChecked()[0];Sbox.SetSize(b);a.preventDefault()},setShare:function(a){var b=this.fileList.getChecked()[0];Sbox.Share(b);a.preventDefault()},cancleShare:function(a){var b=this.fileList.getChecked()[0];Sbox.CancleShare(b);a.preventDefault()},createOutChain:function(a){var b=this.fileList.getChecked()[0];
Sbox.CreateOutChain(b);a.preventDefault()},viewOutChain:function(a){this.fileList.getChecked()[0].getOutChain();a.preventDefault()},setOutChain:function(a){this.fileList.getChecked()[0].editOutChain();a.preventDefault()},cancleOutChain:function(a){var b=this.fileList.getChecked()[0];Sbox.DeleteOutChain([b],this.fileList);a.preventDefault()},sendOutChain:function(a){var b=this.fileList.getChecked()[0];Sbox.SendOutChain(b);a.preventDefault()},createUploadLink:function(a){var b=this.fileList.getChecked()[0];
Sbox.CreateUploadLink(b);a.preventDefault()},setUploadLink:function(a){this.fileList.getChecked()[0].editUploadLink();a.preventDefault()},cancleUploadLink:function(a){var b=this.fileList.getChecked()[0];Sbox.DeleteUploadLink([b],this.fileList);a.preventDefault()},viewUploadLink:function(a){this.fileList.getChecked()[0].getUploadLink();a.preventDefault()},showSubMenu:function(a){$(a.currentTarget).addClass("hover")},hideSubMenu:function(a){$(a.currentTarget).removeClass("hover")}});
Sbox.Views.ContextMenu=Backbone.View.extend({className:"dropdown contextmenu",template:_.template($("#toolbar-template").html()),events:{"click .upload":"upload","click .quitshare":"quitshare","click .show-member":"showMember","click .share":"share","click .file-view":"preview","click .download":"download","click .outchain":"createOutChain","click .uploadlink":"createUploadLink","click .remark":"editRemark","click .move":"move","click .copy":"copy","click .rename":"rename","click .delete":"del","click .history":"checkHistory",
"click .lock":"lock","click .setsize":"setSize","click .share-manage":"stopPropagation","click .outchain-manage":"stopPropagation","click .share-setting":"setShare","click .share-cancle":"cancleShare","click .outchain-setting":"setOutChain","click .outchain-cancle":"cancleOutChain","click .outchain-view":"viewOutChain","click .outchain-send":"sendOutChain","click .uploadlink-setting":"setUploadLink","click .uploadlink-cancle":"cancleUploadLink","click .uploadlink-view":"viewUploadLink","mouseenter li.has-sub":"showSubMenu",
"mouseleave li.has-sub":"hideSubMenu"},initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path;this.model=new Sbox.Models.ContextMenu;_.bindAll(this,"render","select");this.model.bind("change",this.render);this.fileList.bind("contextmenu",this.select)},render:function(){this.$el.html(this.template(this.model.toJSON()));return this},stopPropagation:function(a){a.stopImmediatePropagation()},select:function(){var a=this.fileList.getChecked();0===a.length?this.$el.hide():
this.$el.show();this.model.setSelectedFiles(a)},upload:function(a){var b=this.fileList.getChecked()[0];Sbox.Upload(b.get("id"),"upload",this.fileList);a.preventDefault()},quitshare:function(a){var b=this.fileList.getChecked(),c=this;Sbox.Warning({title:"\u9000\u51fa\u5171\u4eab",message:"\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u8be5\u6587\u4ef6\u5939\u5171\u4eab\u5417\uff1f",callback:function(a){a&&c.fileList.quitshare(b)}});a.preventDefault()},showMember:function(a){var b=this.fileList.getChecked()[0];
Sbox.ViewShareMember(b);a.preventDefault()},editRemark:function(a){var b=this.fileList.getChecked()[0];Sbox.EditRemark(b);a.preventDefault()},lock:function(a){var b=this.fileList.getChecked()[0];Sbox.Lock(b);a.preventDefault()},preview:function(a){var b=this.fileList.getChecked();isPreviewImgFile(b[0].get("name"),b[0].get("size"))?Sbox.Preview(b[0],this.fileList):window.open("/getFileOnline/"+b[0].get("id"));a.preventDefault()},download:function(a){var b=this.fileList.getChecked();Sbox.Download(b);
a.preventDefault()},rename:function(a){var b=this.fileList.getChecked()[0];Sbox.ReName(b);a.preventDefault()},move:function(a){var b=this.fileList.getChecked();Sbox.Move(b,!1,this.fileList,this.path.get("type"));a.preventDefault()},copy:function(a){var b=this.fileList.getChecked();Sbox.Move(b,!0,this.fileList,this.path.get("type"));a.preventDefault()},del:function(a){var b=this.fileList.getChecked();Sbox.DeleteFile(this.fileList,b);a.preventDefault()},checkHistory:function(a){var b=this.fileList.getChecked()[0];
window.open("/history/"+b.get("id")+"/"+b.get("versionNumber"));a.preventDefault()},setSize:function(a){var b=this.fileList.getChecked()[0];Sbox.SetSize(b);a.preventDefault()},share:function(a){var b=this.fileList.getChecked()[0];Sbox.Share(b);a.preventDefault()},setShare:function(a){var b=this.fileList.getChecked()[0];Sbox.Share(b);a.preventDefault()},cancleShare:function(a){var b=this.fileList.getChecked()[0];Sbox.CancleShare(b);a.preventDefault()},createOutChain:function(a){var b=this.fileList.getChecked()[0];
Sbox.CreateOutChain(b);a.preventDefault()},viewOutChain:function(a){this.fileList.getChecked()[0].getOutChain();a.preventDefault()},setOutChain:function(a){this.fileList.getChecked()[0].editOutChain();a.preventDefault()},cancleOutChain:function(a){var b=this.fileList.getChecked()[0];Sbox.DeleteOutChain([b],this.fileList);a.preventDefault()},sendOutChain:function(a){var b=this.fileList.getChecked()[0];Sbox.SendOutChain(b);a.preventDefault()},createUploadLink:function(a){var b=this.fileList.getChecked()[0];
Sbox.CreateUploadLink(b);a.preventDefault()},setUploadLink:function(a){this.fileList.getChecked()[0].editUploadLink();a.preventDefault()},cancleUploadLink:function(a){var b=this.fileList.getChecked()[0];Sbox.DeleteUploadLink([b],this.fileList);a.preventDefault()},viewUploadLink:function(a){this.fileList.getChecked()[0].getUploadLink();a.preventDefault()},showSubMenu:function(a){var a=$(a.currentTarget),b=a.find("ul.dropdown"),c=$(window).width(),d=$(window).height(),e=a.offset(),f=b.height();b.css("left",
e.left+240>c-10?-125:121);e.top+f>d?b.css({top:"auto",bottom:-8}):b.css({top:-8,bottom:"auto"});a.addClass("hover")},hideSubMenu:function(a){a=$(a.currentTarget);a.removeClass("hover");a.find("ul.dropdown").css({left:-9999,top:-9999,bottom:"auto"})}});
Sbox.Views.FileSortView=Backbone.View.extend({className:"list-header",template:_.template($("#file-sort-template").html()),events:{"click .checkbox":"checkAll","click .name":"sortByName","click .size":"sortBySize","click .usedsize":"sortByUsedSize","click .create-time":"sortByCreateTime","click .expire-time":"sortByExpireTime","click .down-count":"sortByDownCount","click .time":"sortByTime"},initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path;_.bindAll(this,"render",
"toggleChecked","cancelSort");this.fileList.bind("change",this.toggleChecked);this.fileList.bind("reset",this.toggleChecked);this.fileList.bind("path.load",this.cancelSort)},render:function(){this.$el.html(this.template({path:!0}));return this},toggleChecked:function(){var a=this.fileList.getChecked();0===this.fileList.length||a.length!==this.fileList.length?this.$el.find(".checkbox .icon").removeClass("icon-checked").addClass("icon-unchecked"):this.$el.find(".checkbox .icon").removeClass("icon-unchecked").addClass("icon-checked")},
cancelSort:function(){this.$(".col").removeClass("asc").removeClass("desc")},checkAll:function(a){$(a.currentTarget).find("span").hasClass("icon-unchecked")?this.fileList.checkAll():this.fileList.uncheckAll()},sortByName:function(a){var b=$(a.currentTarget);!b.hasClass("asc")&&!b.hasClass("desc")&&this.$el.find(".col").removeClass("asc").removeClass("desc");this.sortBy(a,"name")},sortBySize:function(a){var b=$(a.currentTarget);!b.hasClass("asc")&&!b.hasClass("desc")&&this.$el.find(".col").removeClass("asc").removeClass("desc");
this.sortBy(a,"size")},sortByUsedSize:function(a){var b=$(a.currentTarget);!b.hasClass("asc")&&!b.hasClass("desc")&&this.$el.find(".col").removeClass("asc").removeClass("desc");this.sortBy(a,"usedSize")},sortByTime:function(a){var b=$(a.currentTarget);!b.hasClass("asc")&&!b.hasClass("desc")&&this.$el.find(".col").removeClass("asc").removeClass("desc");this.sortBy(a,"modifyTime")},sortByCreateTime:function(a){var b=$(a.currentTarget);!b.hasClass("asc")&&!b.hasClass("desc")&&this.$el.find(".col").removeClass("asc").removeClass("desc");
this.sortBy(a,"createTime")},sortByExpireTime:function(a){var b=$(a.currentTarget);!b.hasClass("asc")&&!b.hasClass("desc")&&this.$el.find(".col").removeClass("asc").removeClass("desc");this.sortBy(a,"expiredate")},sortByDownCount:function(a){var b=$(a.currentTarget);!b.hasClass("asc")&&!b.hasClass("desc")&&this.$el.find(".col").removeClass("asc").removeClass("desc");this.sortBy(a,"downCount")},sortBy:function(a,b){var c=$(a.currentTarget),d=c.hasClass("asc"),e=this.fileList.groupBy(function(a){return"undefined"!==
typeof a.get("parentDir")?1:0}),f;for(f in e)"size"===b&&"1"===f||("name"===b?this.fileList.models[0].get(b)?e[f].sort(function(a,c){return(d?1:-1)*a.get(b).localeCompare(c.get(b))}):e[f].sort(function(a,b){return(d?1:-1)*a.get("nickName").localeCompare(b.get("nickName"))}):"size"===b||"usedSize"===b?e[f].sort(function(a,c){return(d?1:-1)*(a.get(b)-c.get(b))}):"modifyTime"===b||"createTime"===b||"expiredate"===b?e[f].sort(function(a,c){var e=a.get(b).split(" "),f=c.get(b).split(" "),e=e[0].split("-").concat(e[1].split(":")),
f=f[0].split("-").concat(f[1].split(":"));e[1]--;f[1]--;return(d?1:-1)*(new Date(e[0],e[1],e[2],e[3],e[4],e[5])-new Date(f[0],f[1],f[2],f[3],f[4],f[5]))}):"downCount"===b&&e[f].sort(function(a,c){var e=""===a.get(b)?0:parseInt(a.get(b)),f=""===c.get(b)?0:parseInt(c.get(b));return(d?1:-1)*(e-f)}));d?c.removeClass("asc").addClass("desc"):c.removeClass("desc").addClass("asc");this.fileList.models=[].concat(e["1"]||[],e["0"]||[]);this.fileList.trigger("reset")}});
Sbox.Views.FileListView=Backbone.View.extend({className:"list-body",template:_.template($("#file-list-tempate").html()),events:{"mouseenter li.file":"hover","mouseleave li.file":"leave","click li.file":"check","contextmenu li.file":"contextmenu","dblclick li.file":"gotoPath"},initialize:function(){var a=this;this.currentElement=null;this.showType=this.options.showType||$.cookie("showtype")||"listview";this.fileList=this.options.fileList;this.path=this.options.path;_.bindAll(this,"render","addOne",
"addAll","refresh","loading","changeView","deleteStart","deleteEnd","copyStart","copyEnd","moveStart","moveEnd","quitBegin","quitEnd","deleteOutChainBegin","deleteOutChainEnd","deleteUploadLinkBegin","deleteUploadLinkEnd");this.fileList.bind("add",this.addOne);this.fileList.bind("reset",this.addAll);this.fileList.bind("delete.start",this.deleteStart);this.fileList.bind("delete.end",this.deleteEnd);this.fileList.bind("copy.start",this.copyStart);this.fileList.bind("copy.end",this.copyEnd);this.fileList.bind("move.start",
this.moveStart);this.fileList.bind("move.end",this.moveEnd);this.fileList.bind("quit.begin",this.quitBegin);this.fileList.bind("quit.end",this.quitEnd);this.fileList.bind("view.change",this.changeView);this.path.bind("path.load",this.refresh);this.fileList.bind("reload",this.refresh);this.fileList.bind("loading",this.loading);this.fileList.bind("deleteoutchain.begin",this.deleteOutChainBegin);this.fileList.bind("deleteoutchain.end",this.deleteOutChainEnd);this.fileList.bind("deleteuploadlink.begin",
this.deleteUploadLinkBegin);this.fileList.bind("deleteuploadlink.end",this.deleteUploadLinkEnd);this.fileList.bind("hidecontexmenu",function(){a.contextMenuElement&&$(a.contextMenuElement.el).hide()});$(document).on("click",function(){a.contextMenuElement&&$(a.contextMenuElement.el).hide()})},render:function(){var a=this;this.$el.html(this.template({showtype:111}));var b=this.$(".files");this.$(".files").attr("class","files clearfix "+this.showType);this.$el.find("ul.files").mousedown(function(b){if((b.target||
b.srcElement)===this)a.currentElement=null,setTimeout(function(){a.fileList.uncheckAll()},20);!$(b.target).is("input")&&a.$el.find(".active")[0]&&(a.$el.find(".active input").blur(),b.preventDefault(),b.stopImmediatePropagation())});this.$el.find("ul.files").on("mousedown","li.selected",function(b){var c=a.fileList.getChecked();if(!c[0].get("acl")&&(!c[0].get("email")&&!c[0].get("isShareFile")&&!(1===c[0].get("power")||2===c[0].get("power")))&&!$(b.target).is("input"))a.isDraggingFile=!0,a.dragFileTip||
(a.dragFileTip=$('<div class="drag-file-info"><span></span><em></em></div>').appendTo($("body"))),a.dragFileTip.find("em").text(a.fileList.getChecked().length),a.dragFileTip.css({left:-9999,top:-9999})});$(document).on("mousemove",function(b){a.isDraggingFile&&(a.dragFileTip.css({left:b.pageX+2,top:b.pageY+2}),b.stopImmediatePropagation())}).on("mouseup","li.file",function(){if(a.isDraggingFile){var b=$(this).attr("_id"),c=a.fileList.getChecked(),f=!0;_(c).each(function(a){a.get("id")===b&&(f=!1);
a.get("shareFlag")&&(f=!1)});a.fileList.get(b).get("parentDir")||(f=!1);f&&a.fileList.moveFiles(c,!1,b)}}).on("mouseup",function(){a.isDraggingFile=!1;a.dragFileTip&&a.dragFileTip.css({left:-9999,top:-9999})});if($.browser.msie||!document.hasOwnProperty("ontouchstart"))this.$el.find("ul.files").drag("start",function(b){var c=b.target||b.srcElement;if($(c).hasClass("icon")||$(c).is("a")||$(c).hasClass("file-type"))return!1;a.contextMenuElement&&$(a.contextMenuElement.el).hide();if(a.$el.find(".active")[0]||
a.isDraggingFile)return!1;a.isDragging=!0;!b.ctrlKey&&!b.shiftKey&&a.fileList.uncheckAll();return $('<div class="selection" />').css("opacity",0.65).appendTo(document.body)}).drag(function(a,b){$(b.proxy).css({top:Math.min(a.pageY,b.startY),left:Math.min(a.pageX,b.startX),height:Math.abs(a.pageY-b.startY),width:Math.abs(a.pageX-b.startX)})}).drag("end",function(b,c){a.isDragging=!1;$(c.proxy).remove()}),$.drop({multi:!0});if(supportHtml5)try{b[0].addEventListener("dragleave",function(b){b.preventDefault();
b.stopPropagation();var c=a.path,b=c.get("type"),c=c.get("acl");"share"===b&&(null===c||1===c||4===c)||$(this).css({border:"none",margin:0})}),b[0].addEventListener("dragenter",function(b){b.preventDefault();b.stopPropagation();var c=a.path,b=c.get("type"),c=c.get("acl");"share"===b&&(null===c||1===c||4===c)||$(this).css({border:"2px dashed #BCE",margin:"-2px 0"})}),b[0].addEventListener("dragover",function(b){b.stopPropagation();b.preventDefault();var c=a.path,b=c.get("type"),c=c.get("acl");"share"===
b&&(null===c||1===c||4===c)||$(this).css({border:"2px dashed #BCE",margin:"-2px 0"})}),b[0].addEventListener("drop",function(b){b.preventDefault();b.stopPropagation();$(this).css({border:"none",margin:0});b=b.dataTransfer.files;console.log(b);if(0!==b.length){var c=a.path,f=c.get("type"),c=c.get("acl");"share"===f&&(null===c||1===c||4===c)||Sbox.Upload(a.path,"upload",a.fileList,b)}})}catch(c){}return this},addOne:function(a){var b=this;1===this.fileList.length&&(this.$(".files").empty(),this.$(".files").attr("class",
"files clearfix "+this.showType));a.set({power:b.path.get("acl"),isShareFile:"share"===b.path.get("type")});a=new Sbox.Views.FileItemView({model:a,type:this.showType,fileList:this.fileList,path:this.path});this.$(".files").prepend(a.render().el);this.path.get("pathId");var c=a.$el.find(".file-name"),d=c.find("input");c.addClass("active");setTimeout(function(){d.focus();d.select()},30);($.browser.msie||!document.hasOwnProperty("ontouchstart"))&&a.$el.drop("start",function(){$(this).addClass("active")}).drop(function(){var a=
$(this).attr("_id");b.fileList.toggelCheckById(a)}).drop("end",function(){$(this).removeClass("active")})},addAll:function(){var a=this;this.currentElement=null;if(0<this.fileList.length)if(this.$(".files").attr("class","files clearfix "+this.showType),this.fileList.at(0).get("code"))Sbox.Login();else{var b=this.path.get("pathId"),c=this.path.get("uid"),d=this.fileList.at(0),e=d.get("email"),f=d.get("parentDir");e?d="root":f?d=f:(d=d.get("belongDir"),d=d==userId?"root":d);if(!(d!=b&&d!=c&&!("public"===
this.path.get("type")&&"public"===b))&&(this.$(".files").empty(),this.fileList.each(function(b){b.set({power:a.path.get("acl"),isShareFile:a.path.get("type")==="share"});b=new Sbox.Views.FileItemView({model:b,type:a.showType,fileList:a.fileList,path:a.path});a.$(".files").append(b.render().el)}),$.browser.msie||!document.hasOwnProperty("ontouchstart")))this.$el.find(".file").drop("start",function(){$(this).addClass("active")}).drop(function(){var b=$(this).attr("_id");a.fileList.toggelCheckById(b)}).drop("end",
function(){$(this).removeClass("active")}),$.drop({multi:!0})}else this.$(".files").empty(),this.$(".files").attr("class","files"),"share"===this.path.get("type")&&"root"===this.path.get("pathId")?this.$(".files").append($('<li class="not-get-shared">\u60a8\u8fd8\u6ca1\u6709\u6536\u5230\u5171\u4eab\u6587\u4ef6\uff01 </li>')):this.$(".files").append($('<li style="text-align:center; padding:20px 0; color:gray; font-size:16px;">\u8be5\u76ee\u5f55\u4e0b\u8fd8\u6ca1\u6709\u6587\u4ef6\uff01 </li>'))},refresh:function(){var a=
this.fileList;a.trigger("loading");a.fetch({data:{id:""===this.path.get("pathId")?"root":this.path.get("pathId"),uid:this.path.get("uid"),acl:this.path.get("acl"),_t:Math.random()}})},loading:function(){this.$(".files").empty();this.$(".files").attr("class","files");this.$(".files").append($('<li style="text-align:center; padding:20px 0; color:gray;"><span class="icon icon-loading"></span> \u6b63\u5728\u52a0\u8f7d...</li>'))},deleteStart:function(){this.loading=Sbox.Loading("\u6b63\u5728\u5220\u9664\u8bf7\u7a0d\u5019...")},
deleteEnd:function(a){var b=this.fileList,c,d=[],e=[];701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200===a.result.code?(c=b.get(a.id),b.remove(c),d.push(c)):e.push(b.get(a.id))}),this.loading.remove(),0===e.length?Sbox.Success("\u5220\u9664\u6210\u529f"):Sbox.Fail("\u6587\u4ef6\u5220\u9664\u5931\u8d25\u3002"),Sbox.deleteNodeToTree(d),b.trigger("reset"),Sbox.RefreshUsage())},copyStart:function(){this.loading=Sbox.Loading("\u6b63\u5728\u590d\u5236\u8bf7\u7a0d\u5019...")},
copyEnd:function(a,b){var c=this.fileList,d,e,f=[],g=[],h=[],i;701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200===a.result.code?(d=c.get(a.id),f.push(d),e=d.clone(),e.set({id:a.result.newId},{silent:!0}),h.push(e)):(i||(i=a.result.code),g.push(c.get(a.id)))}),this.loading.remove(),0===g.length?Sbox.Success("\u590d\u5236\u6210\u529f"):302===i?Sbox.Fail(g.length+"\u4e2a\u6587\u4ef6\u590d\u5236\u5931\u8d25\uff0c\u76ee\u6807\u76ee\u5f55\u5df2\u5b58\u5728\u540c\u540d\u6587\u4ef6",
2):500===i||501===i?Sbox.Fail("\u4e0d\u80fd\u5c06\u6587\u4ef6\u590d\u5236\u5230\u81ea\u5df1\u6216\u5176\u5b50\u76ee\u5f55\u4e0b",2):Sbox.Fail("\u590d\u5236\u5931\u8d25"),Sbox.addNodeToTree(b,h,"mine"),c.trigger("reset"))},moveStart:function(){this.loading=Sbox.Loading("\u6b63\u5728\u79fb\u52a8\u8bf7\u7a0d\u5019...")},moveEnd:function(a,b){var c=this.fileList,d,e=c.get(b),f=[],g=[],h;701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200===a.result.code?(d=c.get(a.id),d.set("name",
a.name),d.get("parentDir")&&(e&&!e.get("hasSon"))&&e.set({hasSon:1},{silent:!0}),c.remove(d),f.push(d)):(h||(h=a.result.code),g.push(c.get(a.id)))}),this.loading.remove(),0===g.length?Sbox.Success("\u79fb\u52a8\u6210\u529f"):503===h?Sbox.Fail(g.length+"\u4e2a\u6587\u4ef6\u79fb\u52a8\u5931\u8d25\uff0c\u76ee\u6807\u76ee\u5f55\u5df2\u5b58\u5728\u540c\u540d\u6587\u4ef6",2):500===h||501===h||601===h?Sbox.Fail("\u4e0d\u80fd\u5c06\u6587\u4ef6\u79fb\u52a8\u5230\u81ea\u5df1\u6216\u5176\u5b50\u76ee\u5f55\u4e0b",
2):504===h?Sbox.Fail("\u7a7a\u95f4\u4e0d\u8db3"):Sbox.Fail("\u79fb\u52a8\u5931\u8d25"),Sbox.deleteNodeToTree(f),Sbox.addNodeToTree(b,f,"mine"),Sbox.addNodeToTree(b,f,"public"),c.trigger("reset"))},quitBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u9000\u51fa...")},quitEnd:function(a){var b=this.fileList,c,d=[],e=[];701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200===a.result.code?(c=b.get(a.id),b.remove(c),d.push(c)):e.push(b.get(a.id))}),this.loading.remove(),
0===e.length?Sbox.Success("\u9000\u51fa\u5171\u4eab\u6210\u529f"):Sbox.Fail("\u9000\u51fa\u5171\u4eab\u5931\u8d25\u3002"),Sbox.deleteNodeToTree(d),b.trigger("reset"))},deleteOutChainBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u53d6\u6d88\u8bf7\u7a0d\u5019...")},deleteOutChainEnd:function(a){var b=this.fileList,c=!0;701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200!==a.result.code?c=!1:b.get(a.id).set({hasOutChain:!1,outlink:null,hasPassword:0})}),this.loading.remove(),
c?Sbox.Success("\u53d6\u6d88\u5916\u94fe\u6210\u529f"):Sbox.Fail("\u53d6\u6d88\u5916\u94fe\u5931\u8d25\u3002"))},deleteUploadLinkBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u5173\u95ed\u8bf7\u7a0d\u5019...")},deleteUploadLinkEnd:function(a){var b=this.fileList,c=!0;701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200!==a.result.code?c=!1:b.get(a.id).set({anonymousUpload:!1,uploadlink:null})}),this.loading.remove(),c?Sbox.Success("\u5173\u95ed\u533f\u540d\u4e0a\u4f20\u6210\u529f"):
Sbox.Fail("\u5173\u95ed\u533f\u540d\u4e0a\u4f20\u5931\u8d25\u3002"))},changeView:function(a){this.showType=a;this.fileList.trigger("reset")},hover:function(a){this.isDragging||(a=$(a.currentTarget),a.addClass("hover"),a.hasClass("ismine")&&a.addClass("ismine-hover"))},leave:function(a){a=$(a.currentTarget);a.removeClass("hover");a.hasClass("ismine")&&a.removeClass("ismine-hover");a.find(".more-operation").hide()},check:function(a){var b=$(a.currentTarget),c=b.attr("_id"),d=this.fileList,e=d.get(c);
this.$el.find(".list-item");if(e&&(c=a.target||a.srcElement,!$(c).hasClass("icon-checked")&&!$(c).hasClass("icon-unchecked"))){if(!a.ctrlKey&&!a.shiftKey||null===this.currentElement)this.currentElement=b,!a.ctrlKey&&!a.shiftKey&&(e.get("checked")&&1===d.getChecked().length?setTimeout(function(){e.set({checked:!1})},30):setTimeout(function(){d.uncheckAll();e.set({checked:!0})},30));a.ctrlKey&&e.set({checked:!e.get("checked")});if(a.shiftKey){var f=d.getIndexOfById(this.currentElement.attr("_id")),
g=d.getIndexOfById(b.attr("_id"));f>g&&(f+=g,g=f-g,f-=g);d.each(function(a,b){b>=f&&b<=g?d.at(b).set({checked:true}):d.at(b).set({checked:false})})}}},contextmenu:function(a){if(!$(a.target||a.srcElement).is("input")){var b=$(a.currentTarget).attr("_id"),c=this.fileList,b=c.get(b);this.$el.find(".list-item");if(b){b.get("checked")||(c.uncheckAll(),b.set({checked:!0}));this.contextMenuElement||(this.contextMenuElement=new Sbox.Views.ContextMenu({fileList:this.fileList,path:this.path}),$(this.contextMenuElement.el).css({position:"absolute",
zIndex:99,left:-9999,top:-9999}).appendTo($("body")));this.fileList.trigger("contextmenu");var c=$(this.contextMenuElement.el),d=a.pageX,b=a.pageY,e=$(window).height(),f=$(window).width(),g=c.width(),h=c.height(),d=d+g>f-10?d-g-3:d+1,b=b+h>e-10?b-h-13:b+1;c.find("li")[0]?c.css({top:b,left:d}).show():c.hide();a.stopImmediatePropagation();a.preventDefault()}}},gotoPath:function(a){if(!$(a.target).is("input")){var b=$(a.currentTarget).attr("_id"),a=this.fileList;if(b=a.get(b))"undefined"!==typeof b.get("parentDir")?
(a.trigger("loading"),a=this.path.get("path")+"/"+b.get("name"),this.path.addCache([a]),Sbox.addNodeToTree(this.path.get("pathId")||this.path.get("uid"),[b],this.path.get("type"),"update"),Backbone.history.navigate("!"+a,!0)):b.get("email")&&(a.trigger("loading"),a=this.path.get("path")+"/"+b.get("nickName"),this.path.addCache([a]),Sbox.addNodeToTree(this.path.get("pathId"),[b],this.path.get("type"),"update"),Backbone.history.navigate("!"+a,!0))}}});
Sbox.Views.FileItemView=Backbone.View.extend({tagName:"li",className:"file",listTemplate:_.template($("#listview-file-template").html()),previewTemplate:_.template($("#preview-file-template").html()),events:{"click .checkbox":"check","click .file-name a":"openFile","click .file-icon a":"openFile","click .remark":"editRemark","click .lock":"lock","click .unlock":"lock","click .download":"download","click .outchain":"createOutChain","click .rename":"rename","click .move":"move","click .copy":"copy",
"click .delete":"del","click .history":"checkHistory","click .setsize":"setSize","click .upload":"upload","click .share":"share","click .more":"showMore","click .file-remark input":"stopPropagation","click .file-name input":"stopPropagation","blur .file-remark input":"onBlurUpdateRemark","keypress .file-remark input":"onEnterUpdateRemark","blur .file-name input":"onBlurUpdateName","keypress .file-name input":"onEnterUpdateName"},initialize:function(){this.type=this.options.type;this.fileList=this.options.fileList;
this.path=this.options.path;_.bindAll(this,"render","updateName","addFail","addSuccess","renameFail","renameSuccess","updateRemark","remarkFail","remarkSuccess","setSizeBegin","setSizeEnd","lockBegin","lockEnd","unLockBegin","unLockEnd","getOutChainBegin","getOutChainEnd","createOutChainBegin","createOutChainEnd","sendOutChainBegin","sendOutChainEnd","beforeEdit","editOutChainBegin","editOutChainEnd","getUploadLinkBegin","getUploadLinkEnd","createUploadLinkBegin","createUploadLinkEnd","editUploadLinkBefore",
"editUploadLinkBegin","editUploadLinkEnd");this.model.bind("change",this.render);this.model.unbind("change:note");this.model.bind("change:note",this.updateRemark);this.model.unbind("add.fail");this.model.bind("add.fail",this.addFail);this.model.unbind("add.success");this.model.bind("add.success",this.addSuccess);this.model.unbind("rename.fail");this.model.bind("rename.fail",this.renameFail);this.model.unbind("rename.success");this.model.bind("rename.success",this.renameSuccess);this.model.unbind("remark.fail");
this.model.bind("remark.fail",this.remarkFail);this.model.unbind("remark.success");this.model.bind("remark.success",this.remarkSuccess);this.model.unbind("setsize.begin");this.model.bind("setsize.begin",this.setSizeBegin);this.model.unbind("setsize.end");this.model.bind("setsize.end",this.setSizeEnd);this.model.unbind("lock.begin");this.model.bind("lock.begin",this.lockBegin);this.model.unbind("lock.end");this.model.bind("lock.end",this.lockEnd);this.model.unbind("unlock.begin");this.model.bind("unlock.begin",
this.unLockBegin);this.model.unbind("unlock.end");this.model.bind("unlock.end",this.unLockEnd);this.model.unbind("getoutchain.begin");this.model.bind("getoutchain.begin",this.getOutChainBegin);this.model.unbind("getoutchain.end");this.model.bind("getoutchain.end",this.getOutChainEnd);this.model.unbind("createoutchain.begin");this.model.bind("createoutchain.begin",this.createOutChainBegin);this.model.unbind("createoutchain.end");this.model.bind("createoutchain.end",this.createOutChainEnd);this.model.unbind("sendoutchain.begin");
this.model.bind("sendoutchain.begin",this.sendOutChainBegin);this.model.unbind("sendoutchain.end");this.model.bind("sendoutchain.end",this.sendOutChainEnd);this.model.unbind("beforeedit");this.model.bind("beforeedit",this.beforeEdit);this.model.unbind("editoutchain.begin",this.editOutChainBegin);this.model.bind("editoutchain.begin",this.editOutChainBegin);this.model.unbind("editoutchain.end",this.editOutChainEnd);this.model.bind("editoutchain.end",this.editOutChainEnd);this.model.unbind("getuploadlink.begin");
this.model.bind("getuploadlink.begin",this.getUploadLinkBegin);this.model.unbind("getuploadlink.end");this.model.bind("getuploadlink.end",this.getUploadLinkEnd);this.model.unbind("createuploadlink.begin");this.model.bind("createuploadlink.begin",this.createUploadLinkBegin);this.model.unbind("createuploadlink.end");this.model.bind("createuploadlink.end",this.createUploadLinkEnd);this.model.unbind("edituploadlink.before");this.model.bind("edituploadlink.before",this.editUploadLinkBefore);this.model.unbind("edituploadlink.begin",
this.editUploadLinkBegin);this.model.bind("edituploadlink.begin",this.editUploadLinkBegin);this.model.unbind("edituploadlink.end",this.editUploadLinkEnd);this.model.bind("edituploadlink.end",this.editUploadLinkEnd)},render:function(){var a=this.type;"listview"===a?this.$el.html(this.listTemplate(this.model.toJSON())):this.$el.html(this.previewTemplate(this.model.toJSON()));this.model.isNew()?this.$el.addClass("isnew"):(this.$el.attr("_id",this.model.id),this.$el.attr("id",this.model.id),this.$el.removeClass("isnew"));
this.model.get("power")&&this.$el.addClass("power"+this.model.get("power"));this.model.get("creatorId")===userId&&(6!=this.model.get("power")&&5!=this.model.get("power")&&1!=this.model.get("power"))&&this.$el.addClass("ismine");this.model.get("parentDir")||this.$el.addClass("isfile");this.model.get("checked")?this.$el.addClass("selected"):this.$el.removeClass("selected");"listview"===a?this.$el.addClass("list-item"):this.$el.addClass("preview-item");return this},addFail:function(){this.$(".file-name").addClass("active");
setTimeout(function(){this.$(".file-name input").focus()},20)},addSuccess:function(){$(".main-op a.upload").removeClass("upload-disabled");$(".main-op a.create").removeClass("create-disabled");Sbox.addNodeToTree(this.path.get("pathId"),[this.model],"mine");Sbox.addNodeToTree(this.path.get("pathId"),[this.model],"public");this.fileList.trigger("restat")},renameFail:function(){this.$(".file-name").addClass("active");setTimeout(function(){this.$(".file-name input").focus()},20)},renameSuccess:function(){"undefined"!==
typeof this.model.get("parentDir")&&Sbox.renameNodeToTree(this.model.get("id"),this.model)},remarkFail:function(){this.$(".file-remark").addClass("active");setTimeout(function(){this.$(".file-remark input").focus()})},remarkSuccess:function(){},setSizeBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u8bbe\u7f6e\u8bf7\u7a0d\u5019...")},setSizeEnd:function(a,b){701===a.code||403===a.code?Sbox.Login():200===a.code?(Sbox.Success("\u8bbe\u7f6e\u6210\u529f"),this.model.set({size:1048576*b},{silent:!0})):
501===a.code?Sbox.Fail("\u8bbe\u7f6e\u5931\u8d25\uff0c\u7528\u6237\u603b\u7a7a\u95f4\u4e0d\u8db3"):502===a.code?Sbox.Fail("\u8bbe\u7f6e\u5931\u8d25\uff0c\u4e0d\u662f\u5171\u4eab\u6587\u4ef6\u5939"):503===a.code?Sbox.Fail("\u8bbe\u7f6e\u7684\u5927\u5c0f\u5c0f\u4e8e\u8be5\u76ee\u5f55\u5df2\u4f7f\u7528\u7a7a\u95f4"):Sbox.Fail("\u8bbe\u7f6e\u5931\u8d25");this.loading.remove()},lockBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u4e0a\u9501\u8bf7\u7a0d\u5019...")},lockEnd:function(a){701===a.code||
403===a.code?Sbox.Login():200===a.code&&(this.loading.remove(),Sbox.Success("\u4e0a\u9501\u6210\u529f"),this.model.set({lock:1,locker:userId}))},unLockBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u89e3\u9501\u8bf7\u7a0d\u5019...")},unLockEnd:function(a){this.loading.remove();701===a.code||403===a.code?Sbox.Login():200===a.code?(Sbox.Success("\u89e3\u9501\u6210\u529f"),this.model.set({lock:0})):500===a.code&&Sbox.Fail("\u53ea\u6709\u4e0a\u9501\u7684\u7528\u6237\u624d\u6709\u89e3\u9501\u6743\u9650")},
getOutChainBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u83b7\u53d6\u5916\u94fe...")},getOutChainEnd:function(a){a?701===a.code||403===a.code?Sbox.Login():200===a.code&&(this.loading.remove(),a=a.outSideChain,this.model.set({outlink:a.outchainStr,expiredate:a.expiredate,memo:a.memo,password:a.password,hasPassword:a.hasPassword,sharePrivilege:a.sharePrivilege,language:a.language},{silent:!0}),Sbox.ShowOutChain(this.model)):Sbox.ShowOutChain(this.model)},beforeEdit:function(a){a?701===a.code||
403===a.code?Sbox.Login():200===a.code&&(a=a.outSideChain,this.model.set({outlink:a.outchainStr,expiredate:a.expiredate,memo:a.memo,password:a.password,hasPassword:a.hasPassword,sharePrivilege:a.sharePrivilege,language:a.language},{silent:!0}),Sbox.CreateOutChain(this.model)):Sbox.CreateOutChain(this.model)},createOutChainBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u751f\u6210\u5916\u94fe...")},createOutChainEnd:function(a,b,c,d,e,f,g){this.loading.remove();701===a.code||403===a.code?
Sbox.Login():200===a.code?(this.model.set({outlink:a.outSideChain,expiredate:d,hasPassword:b,password:c,memo:e,sharePrivilege:f,language:g,hasOutChain:!0}),Sbox.ShowOutChain(this.model)):Sbox.Fail("\u751f\u6210\u5931\u8d25\u3002");console.log(this.model)},sendOutChainBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u53d1\u9001\u8bf7\u7a0d\u5019...")},sendOutChainEnd:function(a){701===a.code||403===a.code?Sbox.Login():200===a.code&&(this.loading.remove(),Sbox.Success("\u53d1\u9001\u6210\u529f"))},
editOutChainBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u4fdd\u5b58\u8bf7\u7a0d\u5019...")},editOutChainEnd:function(a,b,c,d,e,f,g){701===a.code||403===a.code?Sbox.Login():200===a.code&&(this.loading.remove(),this.model.set({hasPassword:b,password:c,expiredate:d,memo:e,sharePrivilege:f,language:g},{silent:!0}),Sbox.Success("\u4fee\u6539\u6210\u529f"))},getUploadLinkBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u83b7\u53d6\u533f\u540d\u4e0a\u4f20\u94fe\u63a5...")},getUploadLinkEnd:function(a){a?
701===a.code||403===a.code?Sbox.Login():200===a.code&&(this.loading.remove(),a=a.outSideChain,this.model.set({uploadlink:a.outchainStr,expiredate:a.expiredate,password:a.password},{silent:!0}),Sbox.ShowUploadLink(this.model)):Sbox.ShowUploadLink(this.model)},editUploadLinkBefore:function(a){a?701===a.code||403===a.code?Sbox.Login():200===a.code&&(a=a.outSideChain,this.model.set({uploadlink:a.outchainStr,expiredate:a.expiredate,password:a.password},{silent:!0}),Sbox.CreateUploadLink(this.model)):Sbox.CreateUploadLink(this.model)},
createUploadLinkBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u751f\u6210\u533f\u540d\u4e0a\u4f20\u94fe\u63a5...")},createUploadLinkEnd:function(a,b,c){this.loading.remove();701===a.code||403===a.code?Sbox.Login():200===a.code?(this.model.set({uploadlink:a.outSideChain,expiredate:c,password:b,anonymousUpload:!0}),Sbox.ShowUploadLink(this.model)):Sbox.Fail("\u751f\u6210\u5931\u8d25\u3002")},editUploadLinkBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u4fdd\u5b58\u8bf7\u7a0d\u5019...")},
editUploadLinkEnd:function(a,b,c){701===a.code||403===a.code?Sbox.Login():200===a.code?(this.loading.remove(),this.model.set({password:b,expiredate:c},{silent:!0}),Sbox.Success("\u4fee\u6539\u6210\u529f")):Sbox.Fail("\u4fee\u6539\u5931\u8d25")},check:function(a){$(a.currentTarget).find(".icon").hasClass("icon-unchecked")?this.model.set({checked:!0}):this.model.set({checked:!1});this.fileList.trigger("hidecontexmenu");a.stopImmediatePropagation()},openFile:function(a){var b=this;if(""!==this.model.get("name"))if(this.model.get("parentDir")){setTimeout(function(){b.fileList.trigger("loading")},
20);var c=this.path.get("path")+"/"+this.model.get("name");this.path.addCache([c]);Sbox.addNodeToTree(this.path.get("pathId")||this.path.get("uid"),[this.model],this.path.get("type"),"update");Backbone.history.navigate("!"+c,!0);a.preventDefault()}else this.model.get("email")?(setTimeout(function(){b.fileList.trigger("loading")},20),c=this.path.get("path")+"/"+this.model.get("nickName")+(this.model.get("isOutDomain")?"<"+this.model.get("email")+">":""),this.path.addCache([c]),Sbox.addNodeToTree(this.path.get("pathId"),
[this.model],this.path.get("type"),"update"),Backbone.history.navigate("!"+c,!0),a.preventDefault()):(c=getFileType(this.model.get("name")),isPreviewImgFile(this.model.get("name"),this.model.get("size"))?(5!==this.path.get("acl")&&Sbox.Preview(this.model,this.fileList),a.preventDefault()):previewFileType.test(c)?0===this.model.get("size")&&(Sbox.Fail("\u7a7a\u6587\u4ef6\u4e0d\u652f\u6301\u5728\u7ebf\u9884\u89c8"),a.preventDefault()):a.preventDefault())},editRemark:function(a){Sbox.EditRemark(this.model);
a.stopImmediatePropagation();a.preventDefault()},lock:function(a){Sbox.Lock(this.model);a.preventDefault()},download:function(){},createOutChain:function(a){this.model.getOutChain();a.preventDefault()},rename:function(a){Sbox.ReName(this.model);this.$(".more-operation").hide();a.stopImmediatePropagation();a.preventDefault()},move:function(a){Sbox.Move([this.model],!1,this.fileList,this.path.get("type"));a.preventDefault()},copy:function(a){Sbox.Move([this.model],!0,this.fileList,this.path.get("type"));
a.preventDefault()},del:function(a){file=this.model;Sbox.DeleteFile(this.fileList,[file]);a.preventDefault()},checkHistory:function(){},setSize:function(a){Sbox.SetSize(this.model);a.preventDefault()},upload:function(a){Sbox.Upload(this.model.get("id"),"upload",this.fileList);a.preventDefault()},share:function(a){Sbox.Share(this.model);a.preventDefault()},showMore:function(a){var b=this.$(".more-operation");b.is(":hidden")?b.show():b.hide();a.stopImmediatePropagation();a.preventDefault()},stopPropagation:function(a){a.stopImmediatePropagation()},
updateRemark:function(){},onBlurUpdateRemark:function(a){var b=$(a.currentTarget),a=b.val();this.model.get("note")===a?this.model.trigger("reset"):140<a.length?Sbox.Error({message:"\u5907\u6ce8\u4e0d\u5f97\u8d85\u8fc7140\u5b57",callback:function(){b.focus()}}):this.model.updateRemark(a)},onEnterUpdateRemark:function(a){13===a.keyCode&&a.currentTarget.blur()},updateName:function(){},onBlurUpdateName:function(a){var b=this,c=$(a.currentTarget),d=$.trim(c.val());if(""!==this.model.get("name")&&this.model.get("name")===
d)this.model.trigger("reset");else if(notAllow.test(d))Sbox.Error({message:'\u6587\u4ef6\u540d\u4e0d\u80fd\u5305\u542b\u4ee5\u4e0b\u5b57\u7b26 \\ / : * ? " < > |',onHide:function(){c.focus()}});else if("."===d.charAt(d.length-1))Sbox.Error({message:"\u6587\u4ef6\u540d\u4e0d\u80fd\u4ee5\u201c.\u201d\u7ed3\u5c3e",onHide:function(){c.focus()}});else if(""===d)Sbox.Error({message:"\u6587\u4ef6\u540d\u4e0d\u80fd\u4e3a\u7a7a",onHide:function(){c.focus()}});else if(0<=d.lastIndexOf(".")&&""===d.substring(0,
d.lastIndexOf(".")))Sbox.Error({message:!this.model.get("parentDir")?"\u6587\u4ef6\u540d\u4e0d\u80fd\u4e3a\u7a7a":"\u6587\u4ef6\u5939\u4e0d\u80fd\u4ee5\u201c.\u201d\u5f00\u5934",onHide:function(){c.focus()}});else if(/^(CON|AUX|COM1|COM2|COM3|COM4|LPT1|LPT2|LPT3|PRN|NUL)$|^(CON|AUX|COM1|COM2|COM3|COM4|LPT1|LPT2|LPT3|PRN|NUL)\./i.test(d))Sbox.Error({message:"\u4e0d\u5141\u8bb8\u7684\u6587\u4ef6\u540d",onHide:function(){c.focus()}});else if(100<d.length)Sbox.Error({message:"\u6587\u4ef6\u540d\u4e0d\u80fd\u8d85\u8fc7100\u5b57",
onHide:function(){c.focus()}});else{var e=!0;this.fileList.each(function(a){a!==b.model&&d.toLocaleLowerCase()===a.get("name").toLocaleLowerCase()&&(e=!1)});e?("root"===this.model.get("parentDir")||this.model.get("parentDir")==userId)&&("\u6211\u6536\u5230\u7684\u5171\u4eab\u6587\u4ef6"===d.toLocaleLowerCase()||"\u4f01\u4e1a\u5171\u4eab"===d.toLocaleLowerCase())?Sbox.Error({message:"\u6587\u4ef6\u540d\u4e0d\u5408\u6cd5",onHide:function(){c.focus()}}):!this.model.isNew()&&!this.model.get("parentDir")&&
getFileType(d)!==getFileType(this.model.get("name"))?Sbox.Warning({message:"\u786e\u5b9a\u4fee\u6539\u6587\u4ef6\u7c7b\u578b\uff1f",onHide:function(){c.focus()},callback:function(a){a&&b.model.update(d)}}):this.model.update(d):Sbox.Error({message:"\u8be5\u76ee\u5f55\u5df2\u5b58\u5728\u540c\u540d\u6587\u4ef6\uff08\u5939\uff09",onHide:function(){c.focus()}})}},onEnterUpdateName:function(a){13===a.keyCode&&a.currentTarget.blur()}});
Sbox.Views.FileStatView=Backbone.View.extend({className:"file-stat",template:_.template($("#file-stat-template").html()),initialize:function(){this.fileList=this.options.fileList;_.bindAll(this,"render");this.fileList.bind("reset",this.render);this.fileList.bind("restat",this.render)},render:function(){var a=this.fileList.getFoldNum(),b=this.fileList.getFileNum();this.$el.html(this.template({folderNum:a,fileNum:b}));return this}});
Sbox.Views.FileManage=Backbone.View.extend({className:"list-table file-manage",initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path},render:function(){var a=new Sbox.Views.ToolBarView({fileList:this.fileList,path:this.path}),b=new Sbox.Views.FileSortView({fileList:this.fileList,path:this.path}),c=new Sbox.Views.FileListView({fileList:this.fileList,path:this.path}),d=new Sbox.Views.FileStatView({fileList:this.fileList});this.$el.append(a.render().el).append(b.render().el).append(c.render().el).append(d.render().el);
return this}});
Sbox.Views.TreeView=Backbone.View.extend({initialize:function(){function a(){var a=216;c.find(".treenode_bg").each(function(){var b=$(this),c=b.find("a"),b=parseInt(b.css("paddingLeft"))+18+c.width();b>a&&(a=b)});c.height()>c.parent().height()&&216==a&&(a-=20);c.width(a)}var b=this;this.type=this.options.type;var c=$('<ul id="'+this.$el.attr("id")+'Tree" class="ztree">').appendTo(this.$el);c.append('<li style="padding:20px;text-align:center;" class="tree-loading"><span class="icon icon-loading"></span></li>');var d;
"mine"===this.type?d="/GetService!getService.action?_t="+(new Date).valueOf():"share"===this.type?d="/GetShareDir!getTree.action?_t="+(new Date).valueOf():"public"===this.type&&(d="/GetPublicNodeList!getAllnode.action?_t="+(new Date).valueOf());this.tree=$.fn.zTree.init(c,{view:{autoCancelSelected:!1,dblClickExpand:!1,expandSpeed:"fast",nameIsHTML:!1,selectedMulti:!1,showIcon:!0,showLine:!1,showTitle:!0},data:{keep:{leaf:!1,parent:!1},key:{},simpleData:{}},async:{autoParam:["uid","id"],dataFilter:function(a,
c,d){var h=[];701===d.code||403===d.code?Sbox.Login():_(d).each(function(a){var d={};if(a.email)d.id="",d.uid=a.id,d.name=a.isOutDomain?a.nickName+"<"+a.email+">":a.nickName,d.isParent=!0,d.acl=1;else if(d.uid="",d.id=a.id,d.name=a.name,d.isParent=a.hasSon||a.hsaSon?!0:!1,c?d.acl=c.acl:"public"===b.type&&userPublicAcl&&(d.acl=userPublicAcl),a.acl)d.acl=a.acl;h.push(d)});return h},enable:!0,url:d},callback:{onClick:function(c,d,g){b.setPath(g);a()},onAsyncSuccess:function(d,f,g){b.loaded?b.expandNode():
b.loaded=!0;g&&(g.loaded=!0);a();c.find("li.tree-loading").remove()},onExpand:function(){a()}}});Sbox.addTree({type:this.type,tree:this.tree});this.pathModel=this.options.path;_.bindAll(this,"render","expandNode");this.pathModel.bind("change",this.render)},render:function(){var a=this,b=this.pathModel.get("path");this.tmpPath=b;b=b.split("/");this.path=b.slice(2);this.parentNode=null;setTimeout(function(){a.loaded?(0===a.path.length&&(a.tree.cancelSelectedNode(a.tree.getSelectedNodes()[0]),a.pathModel.set({pathId:"public"===
a.type?"public":"root",uid:"",acl:"public"===a.type&&userPublicAcl?userPublicAcl:null},{silent:!0}),a.pathModel.trigger("path.load")),a.expandNode()):(a.loadTime?a.loadTime++:a.loadTime=1,2E3<=a.loadTime?Sbox.Fail("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5"):a.render())},10)},expandNode:function(){if(this.path&&0!==this.path.length){var a=this.path.shift(),b=this.parentNode,c=this.tree.getNodesByFilter(function(c){return c.level===(b?b.level+1:0)&&c.name===a},!0,b);c?(this.parentNode=
c,0===this.path.length?(this.tree.selectNode(this.parentNode),this.pathModel.set({pathId:this.parentNode.id,uid:this.parentNode.uid},{silent:!0}),this.parentNode.acl&&this.pathModel.set({acl:this.parentNode.acl},{silent:!0}),this.pathModel.trigger("path.load")):c.loaded?this.expandNode():c.isParent?this.tree.reAsyncChildNodes(c,"refresh",!0):(c=this.tmpPath.split(a)[0],c=c.substring(0,c.length)+a,Backbone.history.navigate("!"+c,!1),this.tree.selectNode(this.parentNode),this.pathModel.set({pathId:this.parentNode.id,
uid:this.parentNode.uid},{silent:!0}),this.pathModel.set({path:c},{silent:!0}),this.pathModel.trigger("path.load"))):(this.parentNode?(this.tree.selectNode(this.parentNode),this.pathModel.set({pathId:this.parentNode.id,uid:this.parentNode.uid},{silent:!0})):(this.tree.cancelSelectedNode(this.tree.getSelectedNodes()[0]),this.pathModel.set({pathId:"public"===this.type?"public":"root",uid:"",acl:"public"===this.type&&userPublicAcl?userPublicAcl:null},{silent:!0})),this.parentNode&&this.parentNode.acl&&
this.pathModel.set({acl:this.parentNode.acl},{silent:!0}),c=this.tmpPath.split(a)[0],c=c.substring(0,c.length-1),Backbone.history.navigate("!"+c,!1),this.pathModel.set({path:c},{silent:!0}),this.pathModel.trigger("path.load"))}},setPath:function(a){for(var b=[],c=this.pathModel.get("path").split("/")[1];a;)b.push(a.name),a=a.getParentNode();b=0===b.length?"!/"+c:"!/"+c+"/"+b.reverse().join("/");this.pathModel.addCache([b.substr(1)]);"#"+b===location.hash?this.pathModel.trigger("path.load"):Backbone.history.navigate(b,
!0);return b},addNode:function(){},delNode:function(){}});
Sbox.Views.LinkItemView=Backbone.View.extend({tagName:"li",className:"file",template:_.template($("#link-item-template").html()),events:{"click .checkbox":"check","click .send":"send","click .copy":"copy","click .edit":"edit","click .del":"del"},initialize:function(){this.type=this.options.type;this.fileList=this.options.fileList;_.bindAll(this,"render","sendOutChainBegin","sendOutChainEnd","editOutChainBegin","editOutChainEnd");this.model.bind("change",this.render);this.model.bind("sendoutchain.begin",
this.sendOutChainBegin);this.model.bind("sendoutchain.end",this.sendOutChainEnd);this.model.bind("editoutchain.begin",this.editOutChainBegin);this.model.bind("editoutchain.end",this.editOutChainEnd)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.attr("_id",this.model.id);this.$el.attr("id","outlink"+this.model.id);this.model.get("checked")?this.$el.addClass("selected"):this.$el.removeClass("selected");this.$el.addClass("list-item");return this},check:function(a){$(a.currentTarget).find(".icon").hasClass("icon-unchecked")?
this.model.set({checked:!0}):this.model.set({checked:!1});this.fileList.trigger("hidecontexmenu");a.stopImmediatePropagation()},sendOutChainBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u53d1\u9001\u8bf7\u7a0d\u5019...")},sendOutChainEnd:function(a){701===a.code||403===a.code?Sbox.Login():200===a.code&&(this.loading.remove(),Sbox.Success("\u53d1\u9001\u6210\u529f"))},editOutChainBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u4fdd\u5b58\u8bf7\u7a0d\u5019...")},editOutChainEnd:function(a,
b,c,d,e,f,g){701===a.code||403===a.code?Sbox.Login():200===a.code&&(this.loading.remove(),this.model.set({hasPassword:b,password:c,expiredate:d,memo:e,sharePrivilege:f,language:g}),Sbox.Success("\u4fee\u6539\u6210\u529f"))},send:function(a){Sbox.SendOutChain(this.model);a.preventDefault()},copy:function(a){Sbox.ShowOutChain(this.model);a.preventDefault()},edit:function(a){Sbox.EditOutChain(this.model);a.preventDefault()},del:function(a){Sbox.DeleteOutChain([this.model],this.fileList);a.preventDefault()},
stopPropagation:function(a){a.stopImmediatePropagation()}});
Sbox.Views.LinkContextMenu=Backbone.View.extend({className:"dropdown contextmenu",template:_.template($("#outchain-toolbar-template").html()),events:{"click .copy":"copy","click .send":"send","click .edit":"edit","click .del":"del"},initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path;this.model=new Sbox.Models.LinkContextMenu;_.bindAll(this,"render","select");this.model.bind("change",this.render);this.fileList.bind("contextmenu",this.select)},render:function(){this.$el.html(this.template(this.model.toJSON()));
return this},select:function(){var a=this.fileList.getChecked();0===a.length?this.$el.hide():this.$el.show();this.model.setSelectedOutChains(a)},copy:function(a){var b=this.fileList.getChecked()[0];Sbox.ShowOutChain(b);a.preventDefault()},send:function(a){var b=this.fileList.getChecked()[0];Sbox.SendOutChain(b);a.preventDefault()},edit:function(a){var b=this.fileList.getChecked()[0];Sbox.EditOutChain(b);a.preventDefault()},del:function(a){var b=this.fileList.getChecked();Sbox.DeleteOutChain(b,this.fileList);
a.preventDefault()}});
Sbox.Views.LinkListView=Backbone.View.extend({className:"list-body",template:_.template($("#file-list-tempate").html()),events:{"mouseenter li.file":"hover","mouseleave li.file":"leave","click li.file":"check","contextmenu li.file":"contextmenu"},initialize:function(){var a=this;this.currentElement=null;this.showType=this.options.showType||"listview";this.fileList=this.options.fileList;_.bindAll(this,"render","addAll","deleteBegin","deleteEnd");this.fileList.bind("add",this.addOne);this.fileList.bind("reset",
this.addAll);this.fileList.bind("deleteoutchain.begin",this.deleteBegin);this.fileList.bind("deleteoutchain.end",this.deleteEnd);this.fileList.bind("hidecontexmenu",function(){a.contextMenuElement&&$(a.contextMenuElement.el).hide()});$(document).on("click",function(){a.contextMenuElement&&$(a.contextMenuElement.el).hide()})},render:function(){var a=this;this.$el.html(this.template({showtype:111}));this.$(".files").attr("class","files "+this.showType);this.$el.find("ul.files").mousedown(function(b){if((b.target||
b.srcElement)===this)a.currentElement=null,a.fileList.uncheckAll()});if($.browser.msie||!document.hasOwnProperty("ontouchstart"))this.$el.find("ul.files").drag("start",function(b){var c=b.target||b.srcElement;if($(c).hasClass("icon")||$(c).is("a"))return!1;a.contextMenuElement&&$(a.contextMenuElement.el).hide();a.isDragging=!0;!b.ctrlKey&&!b.shiftKey&&a.fileList.uncheckAll();return $('<div class="selection" />').css("opacity",0.65).appendTo(document.body)}).drag(function(a,c){$(c.proxy).css({top:Math.min(a.pageY,
c.startY),left:Math.min(a.pageX,c.startX),height:Math.abs(a.pageY-c.startY),width:Math.abs(a.pageX-c.startX)})}).drag("end",function(b,c){a.isDragging=!1;$(c.proxy).remove()}),$.drop({multi:!0});return this},deleteBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u53d6\u6d88\u8bf7\u7a0d\u5019...")},deleteEnd:function(a){var b=this.fileList,c,d=[],e=[];701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200===a.result.code?(c=b.get(a.id),b.remove(c),d.push(c)):e.push(b.get(a.id))}),
this.loading.remove(),0===e.length?Sbox.Success("\u53d6\u6d88\u5916\u94fe\u6210\u529f"):Sbox.Fail("\u53d6\u6d88\u5916\u94fe\u5931\u8d25"),b.trigger("reset"))},addAll:function(){var a=this;this.$(".files").empty();this.currentElement=null;if(0<this.fileList.length)if(this.$(".files").attr("class","files "+this.showType),this.fileList.at(0).get("code"))Sbox.Login();else{if(this.fileList.each(function(b){b.set({hasPassword:b.get("password")},{silent:!0});b=new Sbox.Views.LinkItemView({model:b,fileList:a.fileList});
a.$(".files").append(b.render().el)}),$.browser.msie||!document.hasOwnProperty("ontouchstart"))this.$el.find(".file").drop("start",function(){$(this).addClass("active")}).drop(function(){var b=$(this).attr("_id");a.fileList.toggelCheckById(b)}).drop("end",function(){$(this).removeClass("active")}),$.drop({multi:!0})}else this.$(".files").attr("class","files"),this.$(".files").append($('<li class="not-create-outlink">\u60a8\u8fd8\u6ca1\u6709\u751f\u6210\u8fc7\u5916\u94fe\u54e6\uff01</li>'))},hover:function(a){this.isDragging||
$(a.currentTarget).addClass("hover")},leave:function(a){a=$(a.currentTarget);a.removeClass("hover");a.find(".more-operation").hide()},check:function(a){var b=$(a.currentTarget),c=b.attr("_id"),d=this.fileList,e=d.get(c);this.$el.find(".list-item");if(e&&(c=a.target||a.srcElement,!$(c).hasClass("icon-checked")&&!$(c).hasClass("icon-unchecked"))){if(!a.ctrlKey&&!a.shiftKey||null===this.currentElement)this.currentElement=b,!a.ctrlKey&&!a.shiftKey&&(e.get("checked")&&1===d.getChecked().length?setTimeout(function(){e.set({checked:!1})},
30):setTimeout(function(){d.uncheckAll();e.set({checked:!0})},30));a.ctrlKey&&e.set({checked:!e.get("checked")});if(a.shiftKey){var f=d.getIndexOfById(this.currentElement.attr("_id")),g=d.getIndexOfById(b.attr("_id"));f>g&&(f+=g,g=f-g,f-=g);d.each(function(a,b){b>=f&&b<=g?d.at(b).set({checked:true}):d.at(b).set({checked:false})})}}},contextmenu:function(a){if(!$(a.target||a.srcElement).is("input")){var b=$(a.currentTarget).attr("_id"),c=this.fileList,b=c.get(b);this.$el.find(".list-item");if(b){b.get("checked")||
(c.uncheckAll(),b.set({checked:!0}));this.contextMenuElement||(this.contextMenuElement=new Sbox.Views.LinkContextMenu({fileList:this.fileList,path:this.path}),$(this.contextMenuElement.el).css({position:"absolute",zIndex:99,left:-9999,top:-9999}).appendTo($("body")));this.fileList.trigger("contextmenu");var c=$(this.contextMenuElement.el),d=a.pageX,b=a.pageY,e=$(window).height(),f=$(window).width(),g=c.width(),h=c.height(),d=d+g>f-10?d-g-3:d+1,b=b+h>e-10?b-h-13:b+1;c.find("li")[0]?c.css({top:b,left:d}).show():
c.hide();a.stopImmediatePropagation();a.preventDefault()}}}});
Sbox.Views.LinkToolBarView=Backbone.View.extend({className:"toolbar",template:_.template($("#outchain-toolbar-template").html()),events:{"click .send":"send","click .copy":"copy","click .edit":"edit","click .del":"del"},initialize:function(){this.fileList=this.options.fileList;this.model=new Sbox.Models.LinkToolbar;_.bindAll(this,"render","select");this.model.bind("change",this.render);this.fileList.bind("change",this.select);this.fileList.bind("reset",this.select)},render:function(){this.$el.html(this.template(this.model.toJSON()));
return this},select:function(){var a=this.fileList.getChecked();0===a.length?this.$el.hide():this.$el.show();this.model.setSelectedOutChains(a)},send:function(a){var b=this.fileList.getChecked()[0];Sbox.SendOutChain(b);a.preventDefault()},copy:function(a){var b=this.fileList.getChecked()[0];Sbox.ShowOutChain(b);a.preventDefault()},edit:function(a){var b=this.fileList.getChecked()[0];Sbox.EditOutChain(b);a.preventDefault()},del:function(a){var b=this.fileList.getChecked();Sbox.DeleteOutChain(b,this.fileList);
a.preventDefault()}});Sbox.Views.LinkSortView=Sbox.Views.FileSortView.extend({template:_.template($("#link-sort-template").html())});
Sbox.Views.LinkManageView=Backbone.View.extend({className:"list-table link-manage",initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path},render:function(){var a=new Sbox.Views.LinkToolBarView({fileList:this.fileList}),b=new Sbox.Views.LinkSortView({fileList:this.fileList}),c=new Sbox.Views.LinkListView({fileList:this.fileList});this.$el.append(a.render().el).append(b.render().el).append(c.render().el);return this}});
Sbox.Views.LinkView=Backbone.View.extend({className:"outchain",initialize:function(){this.fileList=this.options.fileList;this.render()},render:function(){var a=new Sbox.Views.LinkManageView({fileList:this.fileList});this.$el.append(a.render().el).appendTo($("#main"));return this}});
Sbox.Views.UploadLinkItemView=Backbone.View.extend({tagName:"li",className:"file",template:_.template($("#uploadlink-item-template").html()),events:{"click .checkbox":"check"},initialize:function(){this.type=this.options.type;this.fileList=this.options.fileList;_.bindAll(this,"render","editUploadLinkBegin","editUploadLinkEnd");this.model.bind("change",this.render);this.model.bind("edituploadlink.begin",this.editUploadLinkBegin);this.model.bind("edituploadlink.end",this.editUploadLinkEnd)},render:function(){this.$el.html(this.template(this.model.toJSON()));
this.$el.attr("_id",this.model.id);this.$el.attr("id","uploadlink"+this.model.id);this.model.get("checked")?this.$el.addClass("selected"):this.$el.removeClass("selected");this.$el.addClass("list-item");return this},check:function(a){$(a.currentTarget).find(".icon").hasClass("icon-unchecked")?this.model.set({checked:!0}):this.model.set({checked:!1});this.fileList.trigger("hidecontexmenu");a.stopImmediatePropagation()},editUploadLinkBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u4fdd\u5b58\u8bf7\u7a0d\u5019...")},
editUploadLinkEnd:function(a,b,c){701===a.code||403===a.code?Sbox.Login():200===a.code?(this.loading.remove(),this.model.set({password:b,expiredate:c}),Sbox.Success("\u4fee\u6539\u6210\u529f")):Sbox.Fail("\u4fee\u6539\u5931\u8d25")},stopPropagation:function(a){a.stopImmediatePropagation()}});
Sbox.Views.UploadLinkContextMenu=Backbone.View.extend({className:"dropdown contextmenu",template:_.template($("#uploadlink-toolbar-template").html()),events:{"click .copy":"copy","click .edit":"edit","click .del":"del"},initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path;this.model=new Sbox.Models.UploadLinkContextMenu;_.bindAll(this,"render","select");this.model.bind("change",this.render);this.fileList.bind("contextmenu",this.select)},render:function(){this.$el.html(this.template(this.model.toJSON()));
return this},select:function(){var a=this.fileList.getChecked();0===a.length?this.$el.hide():this.$el.show();this.model.setSelectedUploadLinks(a)},copy:function(a){var b=this.fileList.getChecked()[0];Sbox.ShowUploadLink(b);a.preventDefault()},edit:function(a){var b=this.fileList.getChecked()[0];Sbox.EditUploadLink(b);a.preventDefault()},del:function(a){var b=this.fileList.getChecked();Sbox.DeleteUploadLink(b,this.fileList);a.preventDefault()}});
Sbox.Views.UploadLinkListView=Backbone.View.extend({className:"list-body",template:_.template($("#file-list-tempate").html()),events:{"mouseenter li.file":"hover","mouseleave li.file":"leave","click li.file":"check","contextmenu li.file":"contextmenu"},initialize:function(){var a=this;this.currentElement=null;this.showType=this.options.showType||"listview";this.fileList=this.options.fileList;_.bindAll(this,"render","addAll","deleteBegin","deleteEnd");this.fileList.bind("add",this.addOne);this.fileList.bind("reset",
this.addAll);this.fileList.bind("deleteuploadlink.begin",this.deleteBegin);this.fileList.bind("deleteuploadlink.end",this.deleteEnd);this.fileList.bind("hidecontexmenu",function(){a.contextMenuElement&&$(a.contextMenuElement.el).hide()});$(document).on("click",function(){a.contextMenuElement&&$(a.contextMenuElement.el).hide()})},render:function(){var a=this;this.$el.html(this.template({showtype:111}));this.$(".files").attr("class","files "+this.showType);this.$el.find("ul.files").mousedown(function(b){if((b.target||
b.srcElement)===this)a.currentElement=null,a.fileList.uncheckAll()});if($.browser.msie||!document.hasOwnProperty("ontouchstart"))this.$el.find("ul.files").drag("start",function(b){var c=b.target||b.srcElement;if($(c).hasClass("icon")||$(c).is("a"))return!1;a.contextMenuElement&&$(a.contextMenuElement.el).hide();a.isDragging=!0;!b.ctrlKey&&!b.shiftKey&&a.fileList.uncheckAll();return $('<div class="selection" />').css("opacity",0.65).appendTo(document.body)}).drag(function(a,c){$(c.proxy).css({top:Math.min(a.pageY,
c.startY),left:Math.min(a.pageX,c.startX),height:Math.abs(a.pageY-c.startY),width:Math.abs(a.pageX-c.startX)})}).drag("end",function(b,c){a.isDragging=!1;$(c.proxy).remove()}),$.drop({multi:!0});return this},deleteBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u5173\u95ed\u8bf7\u7a0d\u5019...")},deleteEnd:function(a){var b=this.fileList,c,d=[],e=[];701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200===a.result.code?(c=b.get(a.id),b.remove(c),d.push(c)):e.push(b.get(a.id))}),
this.loading.remove(),0===e.length?Sbox.Success("\u5173\u95ed\u533f\u540d\u4e0a\u4f20\u6210\u529f"):Sbox.Fail("\u5173\u95ed\u533f\u540d\u4e0a\u4f20\u5931\u8d25"),b.trigger("reset"))},addAll:function(){var a=this;this.$(".files").empty();this.currentElement=null;if(0<this.fileList.length)if(this.$(".files").attr("class","files "+this.showType),this.fileList.at(0).get("code"))Sbox.Login();else{if(this.fileList.each(function(b){b=new Sbox.Views.UploadLinkItemView({model:b,fileList:a.fileList});a.$(".files").append(b.render().el)}),
$.browser.msie||!document.hasOwnProperty("ontouchstart"))this.$el.find(".file").drop("start",function(){$(this).addClass("active")}).drop(function(){var b=$(this).attr("_id");a.fileList.toggelCheckById(b)}).drop("end",function(){$(this).removeClass("active")}),$.drop({multi:!0})}else this.$(".files").attr("class","files"),this.$(".files").append($('<li class="not-create-outlink">\u60a8\u8fd8\u6ca1\u6709\u751f\u6210\u8fc7\u533f\u540d\u4e0a\u4f20\u94fe\u63a5\u54e6\uff01</li>'))},hover:function(a){this.isDragging||
$(a.currentTarget).addClass("hover")},leave:function(a){a=$(a.currentTarget);a.removeClass("hover");a.find(".more-operation").hide()},check:function(a){var b=$(a.currentTarget),c=b.attr("_id"),d=this.fileList,e=d.get(c);this.$el.find(".list-item");if(e&&(c=a.target||a.srcElement,!$(c).hasClass("icon-checked")&&!$(c).hasClass("icon-unchecked"))){if(!a.ctrlKey&&!a.shiftKey||null===this.currentElement)this.currentElement=b,!a.ctrlKey&&!a.shiftKey&&(e.get("checked")&&1===d.getChecked().length?setTimeout(function(){e.set({checked:!1})},
30):setTimeout(function(){d.uncheckAll();e.set({checked:!0})},30));a.ctrlKey&&e.set({checked:!e.get("checked")});if(a.shiftKey){var f=d.getIndexOfById(this.currentElement.attr("_id")),g=d.getIndexOfById(b.attr("_id"));f>g&&(f+=g,g=f-g,f-=g);d.each(function(a,b){b>=f&&b<=g?d.at(b).set({checked:true}):d.at(b).set({checked:false})})}}},contextmenu:function(a){if(!$(a.target||a.srcElement).is("input")){var b=$(a.currentTarget).attr("_id"),c=this.fileList,b=c.get(b);this.$el.find(".list-item");if(b){b.get("checked")||
(c.uncheckAll(),b.set({checked:!0}));this.contextMenuElement||(this.contextMenuElement=new Sbox.Views.UploadLinkContextMenu({fileList:this.fileList,path:this.path}),$(this.contextMenuElement.el).css({position:"absolute",zIndex:99,left:-9999,top:-9999}).appendTo($("body")));this.fileList.trigger("contextmenu");var c=$(this.contextMenuElement.el),d=a.pageX,b=a.pageY,e=$(window).height(),f=$(window).width(),g=c.width(),h=c.height(),d=d+g>f-10?d-g-3:d+1,b=b+h>e-10?b-h-13:b+1;c.find("li")[0]?c.css({top:b,
left:d}).show():c.hide();a.stopImmediatePropagation();a.preventDefault()}}}});
Sbox.Views.UploadLinkToolBarView=Backbone.View.extend({className:"toolbar",template:_.template($("#uploadlink-toolbar-template").html()),events:{"click .copy":"copy","click .edit":"edit","click .del":"del"},initialize:function(){this.fileList=this.options.fileList;this.model=new Sbox.Models.UploadLinkToolbar;_.bindAll(this,"render","select");this.model.bind("change",this.render);this.fileList.bind("change",this.select);this.fileList.bind("reset",this.select)},render:function(){this.$el.html(this.template(this.model.toJSON()));
return this},select:function(){var a=this.fileList.getChecked();0===a.length?this.$el.hide():this.$el.show();this.model.setSelectedUploadLinks(a)},copy:function(a){var b=this.fileList.getChecked()[0];Sbox.ShowUploadLink(b);a.preventDefault()},edit:function(a){var b=this.fileList.getChecked()[0];Sbox.EditUploadLink(b);a.preventDefault()},del:function(a){var b=this.fileList.getChecked();Sbox.DeleteUploadLink(b,this.fileList);a.preventDefault()}});Sbox.Views.UploadLinkSortView=Sbox.Views.FileSortView.extend({template:_.template($("#uploadlink-sort-template").html())});
Sbox.Views.UploadLinkManageView=Backbone.View.extend({className:"list-table uploadlink-manage",initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path},render:function(){var a=new Sbox.Views.UploadLinkToolBarView({fileList:this.fileList}),b=new Sbox.Views.UploadLinkSortView({fileList:this.fileList}),c=new Sbox.Views.UploadLinkListView({fileList:this.fileList});this.$el.append(a.render().el).append(b.render().el).append(c.render().el);return this}});
Sbox.Views.UploadLinkView=Backbone.View.extend({className:"uploadlink",initialize:function(){this.fileList=this.options.fileList;this.render()},render:function(){var a=new Sbox.Views.UploadLinkManageView({fileList:this.fileList});this.$el.append(a.render().el).appendTo($("#main"));return this}});
Sbox.Views.RecycleItemView=Backbone.View.extend({tagName:"li",className:"file",template:_.template($("#recycle-item-template").html()),events:{"click .checkbox":"check","click .reduce":"reduce","click .del":"del"},initialize:function(){this.type=this.options.type;this.fileList=this.options.fileList;_.bindAll(this,"render");this.model.bind("change",this.render)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.attr("_id",this.model.id);this.$el.attr("id",this.model.id);
this.model.get("checked")?this.$el.addClass("selected"):this.$el.removeClass("selected");this.$el.addClass("list-item");return this},check:function(a){$(a.currentTarget).find(".icon").hasClass("icon-unchecked")?this.model.set({checked:!0}):this.model.set({checked:!1});this.fileList.trigger("hidecontexmenu");a.stopImmediatePropagation()},reduce:function(a){Sbox.Restore([this.model],this.fileList);a.preventDefault()},del:function(a){Sbox.CompleteDelete([this.model],this.fileList);a.preventDefault()},
stopPropagation:function(a){a.stopImmediatePropagation()}});
Sbox.Views.RecycleContextMenu=Backbone.View.extend({className:"dropdown contextmenu",template:_.template($("#recycle-toolbar-template").html()),events:{"click .reduce":"reduce","click .del":"del"},initialize:function(){this.fileList=this.options.fileList;this.path=this.options.path;this.model=new Sbox.Models.RecycleContextMenu;_.bindAll(this,"render","select");this.model.bind("change",this.render);this.fileList.bind("contextmenu",this.select)},render:function(){this.$el.html(this.template(this.model.toJSON()));
return this},select:function(){var a=this.fileList.getChecked();0===a.length?this.$el.hide():this.$el.show();this.model.setSelectedOutChains(a)},reduce:function(a){var b=this.fileList.getChecked();Sbox.Restore(b,this.fileList);a.preventDefault()},del:function(a){var b=this.fileList.getChecked();Sbox.CompleteDelete(b,this.fileList);a.preventDefault()}});
Sbox.Views.RecycleListView=Backbone.View.extend({className:"list-body",template:_.template($("#file-list-tempate").html()),events:{"mouseenter li.file":"hover","mouseleave li.file":"leave","click li.file":"check","contextmenu li.file":"contextmenu"},initialize:function(){var a=this;this.currentElement=null;this.showType=this.options.showType||"listview";this.fileList=this.options.fileList;_.bindAll(this,"render","addAll","restoreBegin","restoreEnd","completeDeleteBegin","completeDeleteEnd","emptyBegin",
"emptyEnd");this.fileList.bind("add",this.addOne);this.fileList.bind("reset",this.addAll);this.fileList.bind("restore.begin",this.restoreBegin);this.fileList.bind("restore.end",this.restoreEnd);this.fileList.bind("completedelete.begin",this.completeDeleteBegin);this.fileList.bind("completedelete.end",this.completeDeleteEnd);this.fileList.bind("empty.begin",this.emptyBegin);this.fileList.bind("empty.end",this.emptyEnd);this.fileList.bind("hidecontexmenu",function(){a.contextMenuElement&&$(a.contextMenuElement.el).hide()});
$(document).on("click",function(){a.contextMenuElement&&$(a.contextMenuElement.el).hide()})},render:function(){var a=this;this.$el.html(this.template({showtype:111}));this.$(".files").attr("class","files "+this.showType);this.$el.find("ul.files").mousedown(function(b){if((b.target||b.srcElement)===this)a.currentElement=null,a.fileList.uncheckAll()});if($.browser.msie||!document.hasOwnProperty("ontouchstart"))this.$el.find("ul.files").drag("start",function(b){var c=b.target||b.srcElement;if($(c).hasClass("icon")||
$(c).is("a"))return!1;a.contextMenuElement&&$(a.contextMenuElement.el).hide();a.isDragging=!0;!b.ctrlKey&&!b.shiftKey&&a.fileList.uncheckAll();return $('<div class="selection" />').css("opacity",0.65).appendTo(document.body)}).drag(function(a,c){$(c.proxy).css({top:Math.min(a.pageY,c.startY),left:Math.min(a.pageX,c.startX),height:Math.abs(a.pageY-c.startY),width:Math.abs(a.pageX-c.startX)})}).drag("end",function(b,c){a.isDragging=!1;$(c.proxy).remove()}),$.drop({multi:!0});return this},restoreBegin:function(){this.loading=
Sbox.Loading("\u6b63\u5728\u8fd8\u539f\u8bf7\u7a0d\u5019...")},restoreEnd:function(a,b){var c=this.fileList,d,e=c.get(b),f=[],g=[],h;701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200===a.result.code?(d=c.get(a.id),d.set("name",a.name),d.get("parentDir")&&(e&&!e.get("hasSon"))&&e.set({hasSon:1},{silent:!0}),c.remove(d),f.push(d)):(h||(h=a.result.code),g.push(c.get(a.id)))}),this.loading.remove(),0===g.length?Sbox.Success("\u8fd8\u539f\u6210\u529f"):504===h?Sbox.Fail("\u8fd8\u539f\u5931\u8d25\uff0c\u7a7a\u95f4\u4e0d\u8db3"):
Sbox.Fail("\u6587\u4ef6\u8fd8\u539f\u5931\u8d25"),Sbox.addNodeToTree(b,f,"mine"),Sbox.addNodeToTree(b,f,"public"),c.trigger("reset"),Sbox.RefreshUsage())},completeDeleteBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u5220\u9664\u8bf7\u7a0d\u5019...")},completeDeleteEnd:function(a){var b=this.fileList,c,d=[],e=[],f;701===a.code?(Sbox.Loading().remove(),Sbox.Login()):(_(a).each(function(a){200===a.result.code?(c=b.get(a.id),b.remove(c),d.push(c)):(f||(f=a.result.code),e.push(b.get(a.id)))}),
this.loading.remove(),702===f?Sbox.ValidateDeletePassword(function(){b.completeDelete(b.getChecked())}):(0===e.length?Sbox.Success("\u5220\u9664\u6210\u529f"):Sbox.Fail("\u6587\u4ef6\u5220\u9664\u5931\u8d25\u3002"),b.trigger("reset")))},emptyBegin:function(){this.loading=Sbox.Loading("\u6b63\u5728\u6e05\u7a7a\u56de\u6536\u7ad9...")},emptyEnd:function(a){var b=this;this.loading.remove();701===a.code||403===a.code?Sbox.Login():200===a.code?Sbox.Success("\u56de\u6536\u7ad9\u5df2\u6e05\u7a7a"):702===
a.code?Sbox.ValidateDeletePassword(function(){b.fileList.empty()}):Sbox.Fail("\u6e05\u7a7a\u56de\u6536\u7ad9\u5931\u8d25");this.fileList.fetch({data:{_t:Math.random()}})},addAll:function(){var a=this;this.$(".files").empty();this.currentElement=null;if(0<this.fileList.length)if(this.$(".files").attr("class","files "+this.showType),this.fileList.at(0).get("code"))Sbox.Login();else{if(this.fileList.each(function(b){b=new Sbox.Views.RecycleItemView({model:b,fileList:a.fileList});a.$(".files").append(b.render().el)}),
$.browser.msie||!document.hasOwnProperty("ontouchstart"))this.$el.find(".file").drop("start",function(){$(this).addClass("active")}).drop(function(){var b=$(this).attr("_id");a.fileList.toggelCheckById(b)}).drop("end",function(){$(this).removeClass("active")}),$.drop({multi:!0})}else this.$(".files").attr("class","files"),this.$(".files").append($('<li style="text-align:center; padding:20px 0; color:gray;font-size:16px;">\u56de\u6536\u7ad9\u91cc\u8fd8\u6ca1\u6709\u6587\u4ef6\uff01</li>'))},hover:function(a){this.isDragging||
$(a.currentTarget).addClass("hover")},leave:function(a){a=$(a.currentTarget);a.removeClass("hover");a.find(".more-operation").hide()},check:function(a){var b=$(a.currentTarget),c=b.attr("_id"),d=this.fileList,e=d.get(c);this.$el.find(".list-item");if(e&&(c=a.target||a.srcElement,!$(c).hasClass("icon-checked")&&!$(c).hasClass("icon-unchecked"))){if(!a.ctrlKey&&!a.shiftKey||null===this.currentElement)this.currentElement=b,!a.ctrlKey&&!a.shiftKey&&(e.get("checked")&&1===d.getChecked().length?setTimeout(function(){e.set({checked:!1})},
30):setTimeout(function(){d.uncheckAll();e.set({checked:!0})},30));a.ctrlKey&&e.set({checked:!e.get("checked")});if(a.shiftKey){var f=d.getIndexOfById(this.currentElement.attr("_id")),g=d.getIndexOfById(b.attr("_id"));f>g&&(f+=g,g=f-g,f-=g);d.each(function(a,b){b>=f&&b<=g?d.at(b).set({checked:true}):d.at(b).set({checked:false})})}}},contextmenu:function(a){if(!$(a.target||a.srcElement).is("input")){var b=$(a.currentTarget).attr("_id"),c=this.fileList,b=c.get(b);this.$el.find(".list-item");if(b){b.get("checked")||
(c.uncheckAll(),b.set({checked:!0}));this.contextMenuElement||(this.contextMenuElement=new Sbox.Views.RecycleContextMenu({fileList:this.fileList,path:this.path}),$(this.contextMenuElement.el).css({position:"absolute",zIndex:99,left:-9999,top:-9999}).appendTo($("body")));this.fileList.trigger("contextmenu");var c=$(this.contextMenuElement.el),d=a.pageX,b=a.pageY,e=$(window).height(),f=$(window).width(),g=c.width(),h=c.height(),d=d+g>f-10?d-g-3:d+1,b=b+h>e-10?b-h-13:b+1;c.find("li")[0]?c.css({top:b,
left:d}).show():c.hide();a.stopImmediatePropagation();a.preventDefault()}}}});Sbox.Views.RecycleWarningView=Backbone.View.extend({className:"warning",template:_.template($("#recycle-warning-template").html()),initialize:function(){this.render()},render:function(){this.$el.html(this.template());return this}});
Sbox.Views.RecycleSettingView=Backbone.View.extend({className:"r-setting",template:_.template($("#recycle-setting-template").html()),events:{"click .setting-delpass":"settingDelpass","click .change-delpass":"changeDelpass"},initialize:function(){this.render()},render:function(){this.$el.html(this.template());return this},settingDelpass:function(){var a=this;Sbox.SetDeletePassword(function(){open_delete_password=1;a.render()})},changeDelpass:function(){Sbox.ChangeDeletePassword()}});
Sbox.Views.RecycleOpView=Backbone.View.extend({className:"main-op",template:_.template($("#recycle-mainop-remplate").html()),events:{"click #empty":"empty"},initialize:function(){this.fileList=this.options.fileList},render:function(){this.$el.html(this.template());return this},empty:function(a){0===this.fileList.length?Sbox.Error("\u56de\u6536\u7ad9\u91cc\u8fd8\u6ca1\u6709\u6587\u4ef6\uff01"):(Sbox.EmptyRecyclebin(this.fileList),a.preventDefault())}});
Sbox.Views.RecycleToolbarView=Backbone.View.extend({className:"toolbar",template:_.template($("#recycle-toolbar-template").html()),events:{"click .reduce":"reduce","click .del":"del"},initialize:function(){this.fileList=this.options.fileList;this.model=new Sbox.Models.RecycleToolbar;_.bindAll(this,"render","select");this.model.bind("change",this.render);this.fileList.bind("change",this.select);this.fileList.bind("reset",this.select)},render:function(){this.$el.html(this.template(this.model.toJSON()));
return this},select:function(){var a=this.fileList.getChecked();0===a.length?this.$el.hide():this.$el.show();this.model.setSelectedOutChains(a)},reduce:function(a){var b=this.fileList.getChecked();Sbox.Restore(b,this.fileList);a.preventDefault()},del:function(a){var b=this.fileList.getChecked();Sbox.CompleteDelete(b,this.fileList);a.preventDefault()}});Sbox.Views.RecycleSortView=Sbox.Views.FileSortView.extend({template:_.template($("#recycle-sort-template").html())});
Sbox.Views.RecycleManageView=Backbone.View.extend({className:"list-table recyclebin-manage",initialize:function(){this.fileList=this.options.fileList},render:function(){var a=new Sbox.Views.RecycleToolbarView({fileList:this.fileList}),b=new Sbox.Views.RecycleSortView({fileList:this.fileList}),c=new Sbox.Views.RecycleListView({fileList:this.fileList});this.$el.append(a.render().el).append(b.render().el).append(c.render().el);return this}});
Sbox.Views.RecycleView=Backbone.View.extend({className:"recyclebin",initialize:function(){this.fileList=this.options.fileList;this.render()},render:function(){var a=new Sbox.Views.RecycleWarningView,b=new Sbox.Views.RecycleSettingView,c=new Sbox.Views.RecycleOpView({fileList:this.fileList}),d=new Sbox.Views.RecycleManageView({fileList:this.fileList});this.$el.append(c.render().el).append(b.render().el).append(a.render().el).append(d.render().el).appendTo($("#main"));return this}});
