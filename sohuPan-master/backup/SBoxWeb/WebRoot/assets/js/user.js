(function(d){Sbox.AddUser=function(){function f(){d.get("/User!freeSpace.action?_t="+Math.random(),function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(e=Math.floor(100*(a.freeSpace/1024/1024/1024))/100,b.html(e+" GB")):(b.html('<span class="error">\u83b7\u53d6\u5931\u8d25\uff0c<a href="javascript:;">\u91cd\u65b0\u83b7\u53d6</a></span>'),b.find("a").click(function(){b.html('<span class="icon icon-loading"></span>');f()}))},"json").error(function(){b.html('<span class="error">\u83b7\u53d6\u5931\u8d25\uff0c<a href="javascript:;">\u91cd\u65b0\u83b7\u53d6</a></span>');
b.find("a").click(function(){b.html('<span class="icon icon-loading"></span>');f()})})}var g=new Sbox.Views.Window({title:"\u6dfb\u52a0\u65b0\u7528\u6237",body:'<form><div class="adduser-dialog"> \t\t\t        \t\t<div class="field" data-type="username"> \t\t\t        \t\t\t<div class="label">\u7528\u6237\u540d\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="text" class="ipt-text" name="nickName" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip">* \u5efa\u8bae\u586b\u5199\u771f\u5b9e\u59d3\u540d</span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field" data-type="email"> \t\t\t        \t\t\t<div class="label">\u767b\u5f55\u90ae\u7bb1\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="text" class="ipt-text" name="email" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip">* \u8bf7\u586b\u5199\u771f\u5b9e\u90ae\u7bb1</span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field" data-type="password"> \t\t\t        \t\t\t<div class="label">\u521d\u59cb\u5bc6\u7801\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="password" class="ipt-text" name="password" onpaste="return false;" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip">* \u8bf7\u8f93\u51656-16\u4e2a\u5b57\u7b26</span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field usage" data-type="usage"> \t\t\t        \t\t\t<div class="label">\u5206\u914d\u7a7a\u95f4\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="text" class="ipt-text" value="" name="settingSize" /> GB \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t<span class="tip">* \u5269\u4f59\u53ef\u5206\u914d\u7a7a\u95f4\uff1a<em id="freeSpace"><span class="icon icon-loading"></span></em></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field" style="margin-bottom:-30px; margin-top:-10px;"> \t\t\t        \t\t\t<div class="label"></div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<span class="error" id="serverError"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t</div></form>',
width:560,closeButton:!0});g.addButton({text:"\u786e\u5b9a",onclick:function(){j=!0;g.body.find("input").blur();j&&d.post("/User!add.action",g.body.find("form").serialize(),function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(Sbox.Success("\u521b\u5efa\u6210\u529f"),g.remove(),setTimeout(function(){location.reload()},1E3)):302===a.code?Sbox.Fail("\u8be5\u7528\u6237\u540d\u5df2\u5b58\u5728\uff0c\u5efa\u8bae\u4f7f\u7528\u201c\u59d3\u540d_\u90e8\u95e8\u201d\u547d\u540d"):303===a.code?Sbox.Fail("\u521b\u5efa\u5931\u8d25\uff0c\u767b\u5f55\u90ae\u7bb1\u5df2\u4f7f\u7528"):
503===a.code?Sbox.Fail("\u521b\u5efa\u5931\u8d25\uff0c\u5269\u4f59\u7a7a\u95f4\u4e0d\u8db3"):Sbox.Fail("\u521b\u5efa\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){g.remove()}});var h=g.body,c=h.find(".field"),b=h.find("#freeSpace");h.find("#serverError");var j=!0,e;f();c.each(function(a,i){function k(a){c.find(".tip").hide();
c.find(".error")[0]||c.append('<span class="error"></span>');c.find(".error").text(a).show();j=!1}function b(){c.find(".tip").show();c.find(".error").hide()}var i=d(i),f=i.attr("data-type"),h=i.find("input"),c=i.find(".tips");h.on("blur",function(){var a=d(this);switch(f){case "username":""===a.val()?k("* \u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a"):10<a.val().length?k("* \u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc710\u4e2a\u5b57\u7b26"):nameReg.test(a.val())?b():k("* \u652f\u6301\u4e2d\u82f1\u6587\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf");
break;case "email":a.val(d.trim(a.val()));""===a.val()?k("* \u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a"):mailReg.test(a.val())?b():k("* \u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e");break;case "password":""===a.val()?k("* \u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"):16<a.val().length||6>a.val().length?k("* \u957f\u5ea6\u4e3a6-16\u4e2a\u5b57\u7b26"):b();break;case "usage":!d.isNumeric(a.val())||0>=1*a.val()?k("* \u8bf7\u8f93\u5165\u6570\u5b57"):e&&1*a.val()>e?k("* \u5269\u4f59\u7a7a\u95f4\u4e0d\u8db3"):b()}}).on("keypress",
function(a){13===a.keyCode&&g.getButton("\u786e\u5b9a")[0].trigger("click")}).on("focus",function(){b()})});return g}})(jQuery);
(function(d){Sbox.DeleteUser=function(f,g){var h=g.find(".file-name").text(),c=g.attr("data-usedspace"),h="<p>\u60a8\u786e\u5b9a\u8981\u5220\u9664 "+h+' \u5417\uff1f</p> \t\t\t\t\t\t\t<p class="tip">\u8be5\u7528\u6237\u6240\u6709\u6587\u4ef6\u5bb9\u91cf '+formatbytes(c)+'</p> \t\t\t\t\t\t\t<p style="font-size:12px; margin:15px 0 5px 0;"><input type="radio" checked="checked" name="deltype" value="1" id="toAdmin" /><label for="toAdmin" style="vertical-align:middle;"> \u628a\u6587\u4ef6\u8f6c\u79fb\u7ed9\u7ba1\u7406\u5458</label></p> \t\t\t\t\t\t\t<p style="font-size:12px;"><input type="radio" name="deltype" value="0" id="delAll" /><label for="delAll" style="vertical-align:middle;"> \u5220\u9664\u8be5\u7528\u6237\u6240\u6709\u6587\u4ef6</label></p>',b=
Sbox.Warning({title:"\u5220\u9664\u7528\u6237",message:h,closeButton:!0,callback:function(c){if(c){var e=Sbox.Loading("\u6b63\u5728\u5220\u9664\u8bf7\u7a0d\u5019"),c=b.body.find("input:radio:checked").val();d.post("/User!delete.action",{id:f,deleteWay:c},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(e.remove(),Sbox.Success("\u5220\u9664\u6210\u529f"),g.remove(),setTimeout(function(){location.reload()},1E3)):Sbox.Fail("\u5220\u9664\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}}});return b}})(jQuery);
(function(d){Sbox.SetUsage=function(f,g){function h(){d.get("/User!freeSpace.action?_t="+Math.random(),function(c){701===c.code||403===c.code?Sbox.Login():200===c.code?(a=Math.floor(100*((c.freeSpace+1*g.attr("data-size"))/1024/1024/1024))/100,e.html(a+" GB")):(e.html('<span class="error">\u83b7\u53d6\u5931\u8d25\uff0c<a href="javascript:;">\u91cd\u65b0\u83b7\u53d6</a></span>'),e.find("a").click(function(){e.html('<span class="icon icon-loading"></span>');h()}))},"json").error(function(){e.html('<span class="error">\u83b7\u53d6\u5931\u8d25\uff0c<a href="javascript:;">\u91cd\u65b0\u83b7\u53d6</a></span>');
e.find("a").click(function(){e.html('<span class="icon icon-loading"></span>');h()})})}var c=new Sbox.Views.Window({title:"\u4fee\u6539\u7528\u6237\u7a7a\u95f4",body:'<div class="setsize-dialog"> \t\t\t\t    \t\t<div class="field"> \t\t\t\t    \t\t\t<div class="label">\u5206\u914d\u7a7a\u95f4\u5927\u5c0f\uff1a</div> \t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t    \t\t\t\t<input type="text" class="ipt-text" /> GB \t\t\t\t    \t\t\t</div> \t\t\t\t    \t\t\t<div class="tips"> \t\t\t\t    \t\t\t\t<span class="tip"></span> \t\t\t\t    \t\t\t</div> \t\t\t\t    \t\t</div> \t\t\t\t    \t\t<div class="field" style="margin-bottom:0; color:gray; line-height:1.5;"> \t\t\t\t    \t\t\t<div class="label"></div> \t\t\t\t    \t\t\t<div class="ipt">\u8be5\u7528\u6237\u5df2\u4f7f\u7528\u7a7a\u95f4\uff1a<em id="usedSpace"></em> <br />\u5269\u4f59\u53ef\u5206\u914d\u7a7a\u95f4\uff1a<em id="freeSpace"><span class="icon icon-loading"></span></em></div> \t\t\t\t    \t\t</div> \t\t\t\t    \t</div>',
width:500,closeButton:!0}),b=c.body,j=b.find("#usedSpace"),e=b.find("#freeSpace"),a,i=!0;j.html(formatbytes(g.attr("data-usedSpace")));h();c.addButton({text:"\u786e\u5b9a",onclick:function(){var a=b.find("input"),e=a.val();i=!0;a.trigger("blur");i&&d.post("/User!updateSize.action",{settingSize:e,id:f},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(Sbox.Success("\u8bbe\u7f6e\u6210\u529f"),c.remove(),setTimeout(function(){location.reload()},1E3)):602===a.code?Sbox.Fail("\u5206\u914d\u7a7a\u95f4\u5c0f\u4e8e\u7528\u6237\u5df2\u4f7f\u7528\u7a7a\u95f4"):
302===a.code?Sbox.Fail("\u5269\u4f59\u7a7a\u95f4\u4e0d\u8db3"):Sbox.Fail("\u8bbe\u7f6e\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){c.remove()}});b.find("input").on("keypress",function(a){13===a.keyCode&&c.getButton("\u786e\u5b9a")[0].trigger("click")}).on("blur",function(){var c=d(this).val(),b=d(this).parent().next();!d.isNumeric(c)||
0>=1*c?(b.find(".error")[0]||b.append('<span class="error"></span>'),b.find(".error").text("* \u5fc5\u987b\u662f\u5927\u4e8e0\u7684\u6570\u5b57").show(),b.find(".tip").hide(),i=!1):a&&1*c>a?(b.find(".error")[0]||b.append('<span class="error"></span>'),b.find(".error").text("* \u5269\u4f59\u7a7a\u95f4\u4e0d\u8db3").show(),b.find(".tip").hide(),i=!1):(b.find(".error").hide(),b.find(".tip").show())}).on("focus",function(){var a=d(this).parent().next();a.find(".error").hide();a.find(".tip").show()})}})(jQuery);
(function(d){Sbox.ImportUser=function(){var f=(new Sbox.Views.Window({title:"\u6279\u91cf\u5bfc\u5165\u7528\u6237",body:'<div class="choose-file"> \t\t\t\t\t\t\t\t<form id="importFm" action="/addUsers/" method="post" target="addUserIfm" enctype="multipart/form-data"><input type="file" size="1" name="Filedata" id="importExcel" hidefocus="true" accept="application/msexcel" /></form> \t\t\t\t\t\t\t\t<label>\u9009\u62e9\u5bfc\u5165\u6587\u4ef6\uff1a</label><input type="text" readonly="readonly" class="ipt-text" /><a href="javascript:;" class="btn btn24 btn24-gray">\u6d4f\u89c8</a> \t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t<p class="tips">\u652f\u6301\u6587\u4ef6\u683c\u5f0f\uff1axls\u3001xlsx\u3001csv\uff0c1M\u4ee5\u5185\uff0c\u4e00\u6b21\u6700\u591a\u5bfc\u5165100\u4e2a\u7528\u6237\u3002<br /> <a href="/GetFile!getImportExecl.action">\u4e0b\u8f7d\u6a21\u677f</a></p> \t\t\t\t\t\t\t\t<p class="msg"></p> \t\t\t\t\t\t\t\t<iframe src="javascript:false" id="addUserIfm" name="addUserIfm" style="display:none;"></iframe>',
width:500,closeButton:!0})).addStyle("import-user-dialog"),g,h=f.body,c=h.find("#importFm"),b=c.find("input").css("opacity",0),j=h.find(".choose-file"),e=h.find(".msg");f.addButton({text:"\u786e\u5b9a",onclick:function(){var a=b.val(),i=/\.(xls|xlsx|csv)$/i;""===a?e.html('<span class="error">\u8bf7\u9009\u62e9\u6587\u4ef6</span>'):i.test(a)?(e.empty(),c.submit(),f.hide(),g=Sbox.Loading("\u6b63\u5728\u5bfc\u5165\uff0c\u8bf7\u4e0d\u8981\u5173\u95ed\u6216\u5237\u65b0\u8be5\u9875\u9762")):e.html('<span class="error">\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u683c\u5f0f</span>')},
className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){f.remove()}});b.on("change",function(){j.find("input.ipt-text").val(d(this).val())});window.importUserCallback=function(a){g.remove();a&&200===a.code?(f.remove(),Sbox.Alert({title:"\u6279\u91cf\u5bfc\u5165\u7528\u6237\u5b8c\u6210",message:'<div class="import-success" id="inportSuccess"><p>\u6279\u91cf\u5bfc\u5165\u7528\u6237\u5b8c\u6210</p>'+(0<a.failNumber?"<p>\u6709 "+(a.allCount-a.successNumber)+' \u4e2a\u7528\u6237\u5bfc\u5165\u5931\u8d25\u3002<a href="javascript:;">\u67e5\u770b\u5931\u8d25\u8be6\u60c5</a></p>':
"")+"</div>",width:540,onHide:function(){setTimeout(function(){location.reload()},20)}}),d("#inportSuccess").on("click","a",function(){var b="",c={302:"\u7528\u6237\u540d\u91cd\u540d",303:"\u90ae\u7bb1\u5df2\u5b58\u5728",304:"\u7528\u6237\u540d\u989d\u4e0d\u8db3",305:"\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e",306:"\u7528\u6237\u540d\u4e0d\u5408\u6cd5",307:"\u5bc6\u7801\u4e0d\u5408\u6cd5",309:"\u7a7a\u95f4\u5927\u5c0f\u4e0d\u5408\u6cd5",503:"\u5269\u4f59\u7a7a\u95f4\u4e0d\u8db3"},b=b+'<div class="ec"><table>',
b=b+'<colgroup><col width="20%" /><col width="40" /><col width="30%" /></colgroup>',b=b+"<tr><th>\u7528\u6237\u540d</th><th>\u90ae\u7bb1</th><th>\u5931\u8d25\u539f\u56e0</th></tr>",e=!0;_(a.result).each(function(d){200!==d.code&&304!==d.code&&(b+="<tr><td>"+d.nickName.replace("<","&lt;").replace(">","&gt;")+"</td><td>"+d.email.replace("<","&lt;").replace(">","&gt;")+"</td><td>"+c[d.code]+"</td></tr>");304===d.code&&a.failNumber<=a.allCount-a.successNumber&&(e=!1,b+='<tr style="border:0;"><td colspan="3" style="text-align:center;">\u7528\u6237\u540d\u989d\u4e0d\u8db3\uff0c\u6700\u540e'+
(a.allCount-a.failNumber-a.successNumber+1)+"\u4e2a\u7528\u6237\u5bfc\u5165\u5931\u8d25</td></tr>")});e&&(100<=a.successNumber+a.failNumber&&a.successNumber+a.failNumber<a.allCount)&&(b+='<tr style="border:0;"><td colspan="3" style="text-align:center;">\u6bcf\u6b21\u6700\u591a\u5bfc\u5165100\u4e2a\u7528\u6237\uff0c\u4f59\u4e0b\u7528\u6237\u5747\u5bfc\u5165\u5931\u8d25</td></tr>');var b=b+"</div></table>",d=(new Sbox.Views.Window({title:"\u5bfc\u5165\u5931\u8d25\u8be6\u60c5",body:b,width:540,closeButton:!0,
onHide:function(){d.remove()}})).addStyle("import-error-detail").addButton({text:"\u786e\u5b9a",onclick:function(){d.hide()},className:"confirm"})})):a&&308===a.code?(f.show(),e.html('<span class="error">\u6587\u4ef6\u8d85\u8fc7\u5927\u5c0f\uff0c\u8bf7\u4fdd\u63011M\u4ee5\u5185</span>')):(f.show(),e.html('<span class="error">\u5bfc\u5165\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u6587\u4ef6\u5185\u5bb9\u662f\u5426\u7b26\u5408\u8981\u6c42</span>'))};return f}})(jQuery);
jQuery(function(){$("#mainOp").on("click",".add",function(){$(this).hasClass("btn32-disabled")||Sbox.AddUser()}).on("click",".import",function(){$(this).hasClass("btn32-disabled")||Sbox.ImportUser()});var d=$("#userList"),f=d.find(".list-item");d.on("mouseenter",".list-item",function(){$(this).addClass("hover")}).on("mouseleave",".list-item",function(){$(this).removeClass("hover")});f.each(function(d,f){var c=$(f),b=c.attr("data-id"),j=c.attr("data-email");$(f).on("click",".reset",function(){Sbox.Confirm({message:"\u786e\u8ba4\u91cd\u7f6e\u8be5\u7528\u6237\u7684\u5bc6\u7801\uff1f",
callback:function(b){b&&$.post("/User!resetPassword.action",{loginName:j},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(Sbox.Alert("\u91cd\u7f6e\u5bc6\u7801\u6210\u529f\uff0c\u65b0\u5bc6\u7801\u5df2\u53d1\u9001\u81f3\u8be5\u7528\u6237\u90ae\u7bb1\uff01"),dialog.remove()):Sbox.Fail("\u5bc6\u7801\u91cd\u7f6e\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}})}).on("click",".edit",function(){Sbox.SetUsage(b,
c);return!1}).on("click",".del",function(){Sbox.DeleteUser(b,c);return!1})})});
