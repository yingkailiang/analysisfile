jQuery(function(){if(document.getElementById("createGroup")&&!$("#createGroup").hasClass("btn32-disabled"))$("#createGroup").on("click",function(){Sbox.CreateGroup()})});jQuery(function(){if($(".manage-content")[0])$(".manage-content .list-body").on("mouseenter","li",function(){$(this).addClass("hover")}).on("mouseleave","li",function(){$(this).removeClass("hover")})});
jQuery(function(){if(document.getElementById("groupList")){var a=$("#groupList li");_(a).each(function(a){var g=$(a),b=g.attr("data-id"),i=g.find(".name a:eq(0)").text();g.on("click",".rename-group",function(){Sbox.RenameGroup(b,i,g)}).on("click",".del-group",function(){Sbox.DeleteGroup(b,g)})})}});jQuery(function(){if(document.getElementById("addNewGroup")&&!$("#addNewGroup").hasClass("btn32-disabled"))$("#addNewGroup").on("click",function(){Sbox.AddUserToGroup(groupId)})});
jQuery(function(){if(document.getElementById("groupMemberList")){var a=$("#groupMemberList li");_(a).each(function(a){var g=$(a),b=g.attr("data-id");g.on("click",".remove",function(){Sbox.RemoveFromGroup(b,groupId,g)}).on("click",".moveto",function(){Sbox.MoveToGroup(b,groupId,g)})})}});jQuery(function(){if(document.getElementById("changeAdmin"))$("#changeAdmin").on("click",function(){Sbox.ChangeAdmin()})});
(function(a){Sbox.CreateGroup=function(){function h(){var m="";_(b).each(function(a){var b=a.members,d="";b&&_(b).each(function(a){d+='<li title="'+a.nickName+"<"+a.loginName+'>" data-id="'+a.id+'">'+replaceHtml(a.nickName)+'<span class="u-email">&lt;'+a.loginName+"&gt;</span></li>"});m+='<dl>                             <dt data-id="'+a.id+'" title="'+a.group_name+"("+a.members.length+')">                                 <span class="icon icon-gclose"></span><span style="width:200px;height:26px;overflow:hidden;">'+
replaceHtml(a.group_name)+" ("+a.members.length+')</span>                             </dt>                             <dd style="display:none;">                                 <ul>'+d+"</ul>                            </dd>                         </dl>"});n.html(m)}function g(a){var b=!1;_(c).each(function(d){d.id==a.id&&(b=!0)});if(!b){c.push(a);var d='<li data-id="'+a.id+'">                         '+replaceHtml(a.nickName)+'<span class="u-email">&lt;'+a.loginName+'&gt;</span>                         <a href="javascript:;" class="remove" title="\u79fb\u9664"><span class="icon icon-cancle2"></span></a>                     </li>';
q.append(d);q.scrollTop(9999);p.text(c.length)}}var b=null,i,c=[],f=new Sbox.Views.Window({title:"\u65b0\u5efa\u7fa4\u7ec4",body:'<div class="group-dialog"> \t\t\t\t\t\t\t\t<div class="group-name"> \t\t\t\t\t\t\t\t\t<label>\u7fa4\u7ec4\u540d\uff1a</label> \t\t\t\t\t\t\t\t\t<input type="text" class="ipt-text" id="groupName" /> \t\t\t\t\t\t\t\t\t<div class="tips" id="nameTip">1-20\u4e2a\u5b57\u7b26\uff0c\u652f\u6301\u4e2d\u82f1\u6587\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf</div> \t\t\t\t\t\t\t\t\t<span class="error" id="nameError"></span> \t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t<div class="choose-user"> \t\t\t\t\t\t\t\t\t<div class="user-list"> \t\t\t\t\t\t\t\t\t\t<div class="legend">\u7528\u6237\u5217\u8868</div> \t\t\t\t\t\t\t\t\t\t<div class="search"> \t\t\t\t\t\t\t\t\t\t\t<input type="text" placeholder="\u8f93\u5165\u7528\u6237\u540d\u6216\u90ae\u7bb1\u641c\u7d22" id="search" autocomplete="off" /> \t\t\t\t\t\t\t\t\t\t\t<span class="label icon icon-search" id="searchBtn"></span> \t\t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t\t<div class="choose-list" id="chooseList"> \t\t\t\t\t\t\t\t\t\t\t<div style="text-align:center;padding:20px;"><span class="icon icon-loading"></span>\u6b63\u5728\u52a0\u8f7d\u6570\u636e...</div> \t\t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t<div class="selected-user"> \t\t\t\t\t\t\t\t\t<div class="selected-user-action"> \t\t\t\t\t\t\t\t\t\t<a href="javascript:;" class="btn btn24 btn24-blue" id="clearSelectedUser">\u6e05\u7a7a\u5217\u8868</a> \t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t<div class="user-list"> \t\t\t\t\t\t\t\t\t\t<div class="legend">\u5df2\u6dfb\u52a0\u6210\u5458(<span id="hasAdded">0</span>)</div> \t\t\t\t\t\t\t\t\t\t<div class="selected-list" id="selectedList"> \t\t\t\t\t\t\t\t\t\t\t<ul> \t\t\t\t\t\t\t\t\t\t\t</ul> \t\t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t</div>',
width:692,closeButton:!0,onHide:function(){f.remove()}});f.addButton({text:"\u786e\u5b9a",onclick:function(){l=!0;o.trigger("blur");if(l){var m=[];_(c).each(function(a){m.push(a.id)});a.post("/Group!create.action",{GroupName:a.trim(o.val()),members:m.join(",")},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(f.remove(),Sbox.Success("\u521b\u5efa\u6210\u529f"),setTimeout(function(){location.reload()},1E3)):Sbox.Fail("\u521b\u5efa\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){f.remove()}});var e=f.body,o=e.find("#groupName"),j=e.find("#nameError"),k=e.find("#nameTip"),n=e.find("#chooseList"),q=e.find("#selectedList ul"),d=e.find("#search"),r=e.find("#searchBtn"),p=e.find("#hasAdded"),e=e.find("#clearSelectedUser"),l=!0;Sbox.placeholder(d);null===b?a.get("/Group!getGroupsContainMember.action?_t="+Math.random(),function(a){0!==
a.length&&(b=a,i=b[0].members,h())},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")}):h();o.on("keypress",function(a){13===a.keyCode&&f.getButton("\u786e\u5b9a")[0].trigger("click")}).on("focus",function(){k.show();j.hide()}).on("blur",function(){var m=a.trim(o.val());if(""===m)k.hide(),j.text("\u7fa4\u7ec4\u540d\u4e0d\u80fd\u4e3a\u7a7a").show(),l=!1;else if(20<m.length)k.hide(),j.text("\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc720\u4e2a\u5b57\u7b26").show(),
l=!1;else if(nameReg.test(m)){var d=!1;_(b).each(function(a){a.group_name.toLowerCase()===m.toLowerCase()&&(d=!0)});d&&(k.hide(),j.text("\u8be5\u7fa4\u7ec4\u5df2\u5b58\u5728").show(),l=!1)}else k.hide(),j.text("\u652f\u6301\u4e2d\u82f1\u6587\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf").show(),l=!1});n.on("mouseenter","li,dt",function(){a(this).addClass("hover")}).on("mouseleave","li,dt",function(){a(this).removeClass("hover")}).on("click","dt .icon",function(m){var d=a(this),b=d.parent().next();d.hasClass("icon-gopen")?
(b.hide(),d.removeClass("icon-gopen").addClass("icon-gclose")):d.hasClass("icon-gclose")&&(b.show(),d.removeClass("icon-gclose").addClass("icon-gopen"));m.stopImmediatePropagation()}).on("click","dt",function(){var m=a(this).attr("data-id"),d;_(b).each(function(a){a.id==m&&(d=a.members)});_(d).each(function(a){g(a)})}).on("click","li",function(){var d=a(this).attr("data-id"),b;_(i).each(function(a){a.id==d&&(b=a)});g(b)});q.on("click","li",function(d){var d=a(d.target||d.srcElement),b=a(this),l=b.attr("data-id");
d.is(".icon")&&(b.remove(),_(c).each(function(a,d){a.id==l&&c.splice(d,1)}),p.text(c.length))});e.on("click",function(){q.find(".icon-cancle2").trigger("click")});d.on("keyup",function(){var d=a(this).val(),b=[];_(i).each(function(a){(0<=a.nickName.toLowerCase().indexOf(d.toLowerCase())||0<=a.loginName.toLowerCase().indexOf(d.toLowerCase()))&&b.push(a)});var l=RegExp("("+d+")","gi");if(""===d||d===a(this).attr("placeholder"))n.find("dl").show(),n.find(".search-list").hide();else{n.find(".search-list")[0]||
n.append('<ul class="search-list"></ul>');var e=n.find(".search-list").show(),c="";_(b).each(function(a){c+='<li title="'+a.nickName+"<"+a.loginName+'>" data-id="'+a.id+'">'+replaceHtml(a.nickName).replace(l,"<b>$1</b>")+'<span class="u-email">&lt;'+a.loginName.replace(l,"<b>$1</b>")+"&gt;</span></li>"});e.html(c);n.find("dl").hide()}});r.on("click",function(){d.trigger("keyup")});return f};Sbox.AddUserToGroup=function(h){function g(){var a="";0===b.length?a+='<li style="padding:20px 0; text-align:center; cursor:default; background:#FFF!important; border:0;">\u6240\u6709\u6210\u5458\u90fd\u5df2\u5728\u8be5\u7ec4\u5185</li>':
_(b).each(function(d){a=a+('<li title="'+d.nickName+"<"+d.loginName+'>" data-id="'+d.id+'">'+replaceHtml(d.nickName)+'<span class="u-email">&lt;'+d.loginName+"&gt;</span></li>")});e.html(a)}var b=null,i=[],c=new Sbox.Views.Window({title:"\u6dfb\u52a0\u65b0\u6210\u5458",body:'<div class="group-dialog"> \t\t                <div class="choose-user"> \t\t                    <div class="search"> \t\t                        <input type="text" placeholder="\u8f93\u5165\u7528\u6237\u540d\u6216\u90ae\u7bb1\u641c\u7d22" id="search" autocomplete="off" /> \t\t                        <span class="label icon icon-search" id="searchBtn"></span> \t\t                    </div> \t\t                    <div class="user-list"> \t\t                        <div class="legend">\u672a\u6dfb\u52a0\u6210\u5458</div> \t\t                        <div class="choose-list" id="chooseList"> \t\t                            <ul> \t\t                            \t<li style="padding:20px 0; text-align:center; cursor:default; background:#FFF!important; border:0;"><span class="icon icon-loading"></span>\u6b63\u5728\u52a0\u8f7d...</li> \t\t                            </ul> \t\t                        </div> \t\t                    </div> \t\t                </div> \t\t                <div class="selected-user"> \t\t                    <div class="user-list"> \t\t                        <div class="legend">\u65b0\u6dfb\u52a0\u6210\u5458(<span id="hasAdded">0</span>)</div> \t\t                        <div class="selected-list" id="selectedList"> \t\t                            <ul> \t\t                            </ul> \t\t                        </div> \t\t                    </div> \t\t                </div> \t\t            </div>',
width:692,closeButton:!0,onHide:function(){c.remove()}});c.addButton({text:"\u786e\u5b9a",onclick:function(){var b=[];_(i).each(function(a){b.push(a.id)});var d=Sbox.Loading("\u6b63\u5728\u6dfb\u52a0");c.remove();a.post("/Group!addGroupMembers.action",{groupId:h,members:b.join(",")},function(a){d.remove();701===a.code||403===a.code?Sbox.Login():200===a.code?(Sbox.Success("\u6dfb\u52a0\u6210\u529f"),setTimeout(function(){location.reload()},1E3)):Sbox.Fail("\u6dfb\u52a0\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){c.remove()}});var f=c.body,e=f.find("#chooseList ul"),o=f.find("#selectedList ul"),j=f.find("#search"),k=f.find("#searchBtn"),n=f.find("#hasAdded");Sbox.placeholder(j);null===b?a.get("/Group!getGroupNotContainMember.action?groupId="+h+"&_t="+Math.random(),function(a){701===a.code||403===a.code?Sbox.Login():200===a.code&&(b=a.members,g())},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")}):g();e.on("mouseenter","li,dt",function(){a(this).addClass("hover")}).on("mouseleave","li,dt",function(){a(this).removeClass("hover")}).on("click","li",function(){var c=a(this).attr("data-id");if(c){var d;_(b).each(function(a){a.id==c&&(d=a)});var e=d,f=!1;_(i).each(function(a){a.id==e.id&&(f=!0)});if(!f){i.push(e);var l='<li class="hover" data-id="'+e.id+'">                         '+replaceHtml(e.nickName)+'<span class="u-email">&lt;'+
e.loginName+'&gt;</span>                         <a href="javascript:;" class="remove" title="\u79fb\u9664"><span class="icon icon-cancle2"></span></a>                     </li>';o.append(l);o.scrollTop(9999);n.text(i.length)}}});o.on("click","li",function(b){var b=a(b.target||b.srcElement),d=a(this),e=d.attr("data-id");b.is(".icon")&&(d.remove(),_(i).each(function(a,d){a.id==e&&i.splice(d,1)}),n.text(i.length))});j.on("keyup",function(){var c=a(this).val(),d,f=[];_(b).each(function(a){(0<=a.nickName.toLowerCase().indexOf(c.toLowerCase())||
0<=a.loginName.toLowerCase().indexOf(c.toLowerCase()))&&f.push(a)});d=f;var g=RegExp("("+c+")","gi");if(""===c||c===a(this).attr("placeholder"))d=b;var l="";_(d).each(function(a){l+='<li title="'+a.nickName+"<"+a.loginName+'>" data-id="'+a.id+'">'+replaceHtml(a.nickName).replace(g,"<b>$1</b>")+'<span class="u-email">&lt;'+a.loginName.replace(g,"<b>$1</b>")+"&gt;</span></li>"});e.html(l)});k.on("click",function(){j.trigger("keyup")});return c};Sbox.RemoveFromGroup=function(h,g,b){return Sbox.Warning({title:"\u79fb\u51fa\u6210\u5458",
message:"<p>\u60a8\u786e\u5b9a\u8981\u79fb\u51fa\u8be5\u6210\u5458\u5417\uff1f</p>",closeButton:!0,callback:function(i){if(i){var c=Sbox.Loading("\u6b63\u5728\u79fb\u51fa\u8bf7\u7a0d\u5019");a.post("/Group!deleteGroupMember.action",{groupId:g,userIds:h},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(c.remove(),Sbox.Success("\u5220\u9664\u6210\u529f"),b&&b.remove(),setTimeout(function(){location.reload()},1E3)):(c.remove(),Sbox.Fail("\u5220\u9664\u5931\u8d25"))},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}}})};Sbox.MoveToGroup=function(h,g,b){function i(){var a="";1===c.length?(Sbox.Error("\u6ca1\u6709\u5176\u4ed6\u7fa4\u7ec4\uff0c\u8bf7\u65b0\u5efa\u7fa4\u7ec4\u540e\u91cd\u8bd5"),f.remove()):_(c).each(function(b){b.id!==g&&(a+='<li><span class="icon icon-unchecked" data-id="'+b.id+'"></span> <span>'+replaceHtml(b.group_name)+"("+b.number+")</span></li>")});e.html(a)}var c=null,f=new Sbox.Views.Window({title:"\u79fb\u52a8\u5230\u7fa4\u7ec4",
body:'<div class="group-move-dialog"><ul id="groupList"><li style="padding:20px; text-align:center; border:0; cursor:default;"><span class="icon icon-loading"></span>\u6b63\u5728\u52a0\u8f7d...</li></ul></div>',width:440,closeButton:!0});f.addButton({text:"\u786e\u5b9a",onclick:function(){var c=[];e.find(".icon-checked").each(function(){c.push(a(this).attr("data-id"))});a.post("/Group!moveToGroups.action",{userId:h,rgId:g,groupIds:c.join(",")},function(a){701===a.code||403===a.code?Sbox.Login():200===
a.code?(Sbox.Success("\u79fb\u52a8\u6210\u529f"),f.remove(),b&&b.remove(),setTimeout(function(){location.reload()},1E3)):Sbox.Fail("\u79fb\u52a8\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){f.remove()}});var e=f.body.find("#groupList");null===c?a.get("/Group!getGroups.action?_t="+Math.random(),function(a){0!==a.length&&(c=a,
i())},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")}):i();e.on("click","li .icon",function(b){var c=a(this);c.attr("data-id");c.hasClass("icon-unchecked")?c.removeClass("icon-unchecked").addClass("icon-checked"):c.removeClass("icon-checked").addClass("icon-unchecked");b.stopImmediatePropagation()}).on("click","li",function(){a(this).find(".icon").trigger("click")});return f};Sbox.DeleteGroup=function(h,g){return Sbox.Warning({title:"\u5220\u9664\u7fa4\u7ec4",
message:'<p>\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8be5\u7fa4\u7ec4\u5417\uff1f</p><p class="tip">\u5220\u9664\u540e\u8be5\u7fa4\u7ec4\u4fe1\u606f\u5c06\u5f7b\u5e95\u5220\u9664\uff01</p>',closeButton:!0,callback:function(b){if(b){var i=Sbox.Loading("\u6b63\u5728\u5220\u9664\u8bf7\u7a0d\u5019");a.post("/Group!deleteGroups.action",{groupIds:h},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(i.remove(),Sbox.Success("\u5220\u9664\u6210\u529f"),g&&g.remove(),setTimeout(function(){location.reload()},
1E3)):Sbox.Fail("\u5220\u9664\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}}})};Sbox.RenameGroup=function(h,g){var b=new Sbox.Views.Window({title:"\u91cd\u547d\u540d\u7fa4\u7ec4",body:'<div class="rename-group-dialog"> \t\t\t\t\t\t<div class="field"> \t\t\t    \t\t\t<div class="label" style=>\u7fa4\u7ec4\u540d\uff1a</div> \t\t\t    \t\t\t<div class="ipt"> \t\t\t    \t\t\t\t<input type="text" class="ipt-text" value="'+
g+'" /> \t\t\t    \t\t\t</div> \t\t\t    \t\t\t<div class="tips"><span class="error"></span></div> \t\t\t    \t\t</div> \t\t\t\t\t\t<div class="field" style="margin-bottom:0; color:gray; line-height:1.5;"> \t\t\t    \t\t\t<div class="label" style=></div> \t\t\t    \t\t\t<div class="ipt"> \t\t\t    \t\t\t\t1-20\u4e2a\u5b57\u7b26\uff0c\u652f\u6301\u4e2d\u82f1\u6587\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf \t\t\t    \t\t\t</div> \t\t\t    \t\t</div> \t\t    \t\t</div>',width:450,closeButton:!0});b.addButton({text:"\u786e\u5b9a",
onclick:function(){var f=a.trim(c.val());e=!0;c.trigger("blur");e&&(f===g?(Sbox.Success("\u91cd\u547d\u540d\u6210\u529f"),b.remove()):a.post("/Group!renameGroup.action",{groupId:h,groupName:f},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(Sbox.Success("\u91cd\u547d\u540d\u6210\u529f"),b.remove(),setTimeout(function(){location.reload()},1E3)):302===a.code?Sbox.Fail("\u5df2\u5b58\u5728\u8be5\u7fa4\u7ec4"):Sbox.Fail("\u91cd\u547d\u540d\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")}))},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){b.remove()}});var i=b.body,c=i.find("input"),f=i.find(".tips span"),e=!0;c.on("keypress",function(a){13===a.keyCode&&b.getButton("\u786e\u5b9a")[0].trigger("click")}).on("focus",function(){f.empty()}).on("blur",function(){var b=a.trim(c.val());""===b?(f.text("\u7fa4\u7ec4\u540d\u4e0d\u80fd\u4e3a\u7a7a"),e=!1):20<b.length?(f.text("\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc720\u4e2a\u5b57\u7b26"),
e=!1):nameReg.test(b)||(f.text("\u652f\u6301\u4e2d\u82f1\u6587,\u6570\u5b57,\u4e0b\u5212\u7ebf"),e=!1)}).focus().select();return b}})(jQuery);
(function(){var a=null;Sbox.ChangeAdmin=function(){function h(){$.get("/ShareManager!getVisitors.action?_t="+Math.random(),function(c){701===c.code||403===c.code?(b.hide(),Sbox.Login(),a=[]):a=c},"json").error(function(){k++;10<k||setTimeout(function(){h()},500)})}function g(b){var c=[];if(""===b)return c=_.filter(a,function(a){return"g"!==a.type&&a.id!==userId});_(a).each(function(a){"p"===a.type&&(0<=a.loginName.toLowerCase().indexOf(b.toLowerCase())||0<=a.nickName.toLowerCase().indexOf(b.toLowerCase()))&&
a.id!==userId&&c.push(a)});return c}var b=new Sbox.Views.Window({title:"\u8f6c\u8ba9\u7ba1\u7406\u5458",body:'<div class="change-admin-dialog"><div class="field"> \t\t\t        \t\t\t<div class="label"></div> \t\t\t        \t\t\t<div class="ipt" style="font-size:14px;"> \t\t\t        \t\t\t\t\u9009\u62e9\u63a5\u53d7\u7ba1\u7406\u5458\u8eab\u4efd\u7684\u6210\u5458\u90ae\u7bb1\uff1a \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field field-user"> \t\t\t        \t\t\t<div class="label"></div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="text" class="ipt-text" id="email" autocomplete="off" /> \t\t\t        \t\t\t\t<div class="search-users" style="display:none;" id="searchList"> \t\t\t        \t\t\t\t\t<ul> \t\t\t        \t\t\t\t\t</ul> \t\t\t        \t\t\t\t</div> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t</div>',
width:550,closeButton:!0,onHide:function(){b.remove()}});b.addButton({text:"\u786e\u5b9a",onclick:function(){var e=c.val(),g;""===e?f.html('<span class="error">\u8bf7\u8f93\u5165\u90ae\u7bb1\u5730\u5740</span>'):mailReg.test(e)?(f.html('<span class="icon icon-loading"></span>'),a?(_(a).each(function(a){a.loginName===e&&(g=a.id)}),g?$.post("/User!switchAdmin.action",{newAdminId:g},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(b.remove(),Sbox.Alert({message:"\u7ba1\u7406\u5458\u8f6c\u8ba9\u6210\u529f\uff0c\u91cd\u65b0\u767b\u5f55\u540e\u751f\u6548",
onHide:function(){location.href="/Login!logout.action"}})):403===a.code?f.html('<span class="error">\u60a8\u6ca1\u6709\u64cd\u4f5c\u6743\u9650</span>'):404===a.code?f.html('<span class="error">\u60a8\u6ca1\u6709\u64cd\u4f5c\u6743\u9650</span>'):405===a.code&&f.html('<span class="error">\u8be5\u7528\u6237\u4e0d\u5b58\u5728</span>')},"json"):f.html('<span class="error">\u8be5\u7528\u6237\u4e0d\u5b58\u5728</span>')):10<k?Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5"):
setTimeout(function(){b.getButton("\u786e\u5b9a")[0].trigger("click")},500)):f.html('<span class="error">\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e</span>')},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){b.remove()}});var i=b.body,c=i.find("#email"),f=c.parent().next(),e=i.find("#searchList"),o=e.find("ul"),j,k=0;null===a&&h();c.on("keydown",function(b){if(a){var c=g(this.value);if(38===b.keyCode){var d=e.find("li.hover");if(d[0])if(d.eq(0).prev()[0]){d.removeClass("hover");
d.eq(0).prev().addClass("hover");var f=e.find("li").index(e.find("li.hover")),d=e.scrollTop();10<c.length&&24*f<d&&setTimeout(function(){e.scrollTop(24*f)},20)}else d.removeClass("hover"),e.find("li:last").addClass("hover"),setTimeout(function(){e.scrollTop(24*(c.length-9))},20);else e.find("li:last").addClass("hover");b.preventDefault()}else 40===b.keyCode?(d=e.find("li.hover"),d[0]?d.eq(0).next()[0]?(d.removeClass("hover"),d.eq(0).next().addClass("hover"),f=e.find("li").index(e.find("li.hover")),
d=e.scrollTop(),10<c.length&&24*(f-10)>=d&&setTimeout(function(){e.scrollTop(24*(f-9))},20)):(d.removeClass("hover"),e.find("li:first").addClass("hover"),setTimeout(function(){e.scrollTop(0)},20)):e.find("li:first").addClass("hover"),b.preventDefault()):13===b.keyCode&&(d=e.find("li.hover"),d[0]&&(d.trigger("click"),$(this).trigger("blur")),b.preventDefault())}}).on("focus",function(){$(this).trigger("keyup");f.empty()}).on("blur",function(){j=setTimeout(function(){e.hide()},150)}).on("keyup",function(b){if(a){var c=
this.value,d=g(c),f="",i=RegExp("("+c+")","gi");38===b.keyCode||(40===b.keyCode||13===b.keyCode)||(0===d.length?(o.empty(),e.hide()):(_(d).each(function(a,b){f+='<li class="'+(0===b?"hover":"")+'" data-id="'+a.id+'" data-email="'+a.loginName+'">'+replaceHtml(a.nickName).replace(i,"<b>$1</b>")+"<span>&lt;"+a.loginName.replace(i,"<b>$1</b>")+"&gt;</span></li>"}),o.html(f),10<d.length?e.height(240):e.height("auto"),e.scrollTop(0),e.show()))}});e.on("click","li",function(a){a=$(a.currentTarget);c.val(a.attr("data-email"));
e.hide()}).on("mouseenter","li",function(){e.find("li").removeClass("hover");$(this).addClass("hover")}).on("mouseleave","li",function(){}).on("focus",function(){clearTimeout(j);e.show()}).on("blur",function(){e.hide()});return b}})(jQuery);
jQuery(function(){function a(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(Sbox.Success("\u4e0a\u4f20\u6210\u529f"),setTimeout(function(){location.reload()},1E3)):601===a.code?b.html('<span class="error">\u6587\u4ef6\u8d85\u8fc7\u5927\u5c0f\u9650\u5236</span>'):b.html('<span class="error">\u4e0a\u4f20\u5931\u8d25</span>')}if(document.getElementById("settingLogo")){var h=$("#settingLogo"),g=h.find("#uploadLogoIpt"),b=h.find(".tips"),i=$("#uploadForm");g.on("change",function(){i.submit()});
i.on("submit",function(){var a=g.val();if(""===a)return b.html('<span class="error">\u8bf7\u9009\u62e9\u6587\u4ef6</span>'),!1;if(/\.(png)$/i.test(a))b.html('<span class="icon icon-loading"></span>\u6b63\u5728\u4e0a\u4f20,\u8bf7\u4e0d\u8981\u5173\u95ed\u6216\u5237\u65b0\u8be5\u9875\u9762');else return b.html('<span class="error">\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u683c\u5f0f</span>'),!1});window.uploadLogoCallback=a}});
jQuery(function(){if(document.getElementById("settingDomain")){var a=$("#settingDomain"),h=a.find("#domainIpt"),g=a.find("#domainBtn"),b=a.find(".tips"),i=1*a.find("input:hidden").val(),c=/^[a-z0-9][a-z0-9\-]+[a-z0-9]$/i;Sbox.placeholder(h);h.on("keypress",function(a){13===a.keyCode&&g.trigger("click")});g.on("click",function(){var a=$.trim(h.val());""===a||a===h.attr("placeholder")?b.html('<span class="error">\u8bf7\u8f93\u5165\u4e8c\u7ea7\u57df\u540d</span>'):5>a.length||20<a.length?(console.log(a),
b.html('<span class="error">\u8bf7\u8f93\u51655-20\u4e2a\u5b57\u7b26</span>')):c.test(a)?Sbox.Warning({title:"\u8bbe\u7f6e\u4e8c\u7ea7\u57df\u540d",message:'<p>\u60a8\u786e\u5b9a\u4fdd\u5b58\u8be5\u4e2a\u6027\u57df\u540d\u5417\uff1f</p><p class="tip">\u4e00\u51713\u6b21\u4fee\u6539\u673a\u4f1a\uff0c\u60a8\u8fd8\u80fd\u4fee\u6539'+(3-i-1)+"\u6b21\uff01</p>",closeButton:!0,callback:function(c){c&&(Sbox.Loading("\u6b63\u5728\u8bbe\u7f6e\u8bf7\u7a0d\u5019..."),$.post("/AccountManage!individSetting.action",
{individDomain:a.toLowerCase()},function(a){Sbox.Loading().remove();701===a.code||403===a.code?Sbox.Login():200===a.code?(Sbox.Success("\u8bbe\u7f6e\u6210\u529f"),setTimeout(function(){location.reload()},1E3)):302===a.code?b.html('<span class="error">\u8be5\u57df\u540d\u5df2\u88ab\u4f7f\u7528</span>'):b.html('<span class="error">\u8bbe\u7f6e\u5931\u8d25</span>')},"json"))}}):b.html('<span class="error">\u652f\u6301\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u8fde\u63a5\u7b26\u201c-\u201d</span>')})}});
jQuery(function(){if(document.getElementById("bindDomain")){var a=$("#iptDomain"),h=$("#tipDomail"),g=$("#smtDomain"),b=/^(http:\/\/|https:\/\/)?([a-zA-Z0-9][-a-zA-Z0-9]{0,62}\.)*[a-zA-Z0-9][-a-zA-Z0-9]{0,62}\.[a-zA-Z]{2,4}$/;g.on("click",function(){var g=$.trim(a.val());""===g?h.html('<span class="error">\u8bf7\u8f93\u5165\u72ec\u7acb\u57df\u540d</span>'):b.test(g)?(h.html('<span class="icon icon-loading"></span>'),$.post("/AccountManage!domainSet.action",{individDomain:g.toLowerCase()},function(a){console.log(a);
701===a.code||403===a.code?Sbox.Login():200===a.code?location.href="/individset3.jsp":302===a.code?h.html('<span class="error">\u57df\u540d\u5df2\u4f7f\u7528</span>'):h.html('<span class="error">\u8bbe\u7f6e\u5931\u8d25</span>')},"json")):h.html('<span class="error">\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u57df\u540d</span>')});a.on("keypress",function(a){13===a.keyCode&&g.trigger("click")})}});
jQuery(function(){document.getElementById("settingIpModule")&&($("#setIpRestrict").on("click",function(){Sbox.IpRestrict()}),$("#editIpRestrict").on("click",function(){Sbox.IpRestrict()}),$("#cancelIpRestrict").on("click",function(){Sbox.Warning({title:"\u53d6\u6d88IP\u9650\u5236",message:"<p>\u60a8\u786e\u5b9a\u8981\u53d6\u6d88IP\u9650\u5236\u5417\uff1f</p>",closeButton:!0,callback:function(a){if(a){var h=Sbox.Loading("\u6b63\u5728\u53d6\u6d88\u8bf7\u7a0d\u5019");$.post("/IpSetting!cancel.action",
function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(h.remove(),Sbox.Success("\u53d6\u6d88\u6210\u529f"),setTimeout(function(){location.reload()},1E3)):(h.remove(),Sbox.Fail("\u5220\u9664\u5931\u8d25"))},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}}})}))});
(function(a){Sbox.IpRestrict=function(){function h(){var a="";_(b).each(function(b){var d=b.members,c="";d&&_(d).each(function(a){c+='<li title="'+a.nickName+"<"+a.loginName+'>" data-id="'+a.id+'">'+replaceHtml(a.nickName)+'<span class="u-email">&lt;'+a.loginName+"&gt;</span></li>"});a+='<dl> \t                        <dt data-id="'+b.id+'" title="'+b.group_name+"("+b.members.length+')"> \t                            <span class="icon icon-gclose"></span><span style="width:200px;height:26px;overflow:hidden;">'+
replaceHtml(b.group_name)+" ("+b.members.length+')</span> \t                        </dt> \t                        <dd style="display:none;"> \t                            <ul>'+c+"</ul>\t                        </dd> \t                    </dl>"});j.html(a)}function g(a){var b=!1;_(c).each(function(d){d.id==a.id&&(b=!0)});if(!b){c.push(a);var e='<li data-id="'+a.id+'">                         '+replaceHtml(a.nickName)+'<span class="u-email">&lt;'+a.loginName+'&gt;</span>                         <a href="javascript:;" class="remove" title="\u79fb\u9664"><span class="icon icon-cancle2"></span></a>                     </li>';
k.append(e);k.scrollTop(9999);d.text(c.length)}}var b=null,i,c=[],f=new Sbox.Views.Window({title:"\u9650\u5236IP\u8bbe\u7f6e",body:'<div class="settingip-dialog"> \t\t\t\t\t\t\t<div class="ips"> \t\t\t\t\t\t\t\t<label>\u6307\u5b9a\u53ef\u767b\u5f55IP\u5730\u5740\uff1a</label> \t\t\t\t\t\t\t\t<input type="text" class="ipt-text" id="ipsIpt" placeholder="\u591a\u4e2aIP\u5730\u5740\u8bf7\u7528;\u5206\u9694" /> \t\t\t\t\t\t\t\t<span class="error" id="iptError"></span> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t<div class="ips"> \t\t\t\t\t\t\t\t<label>\u9009\u62e9\u4e0d\u53d7IP\u9650\u5236\u7528\u6237\u8303\u56f4\uff1a</label> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t<div class="choose-user"> \t\t\t\t\t\t\t\t<div class="user-list"> \t\t\t\t\t\t\t\t\t<div class="legend">\u7528\u6237\u5217\u8868</div> \t\t\t\t\t\t\t\t\t<div class="search"> \t\t\t\t\t\t\t\t\t\t<input type="text" placeholder="\u8f93\u5165\u7528\u6237\u540d\u6216\u90ae\u7bb1\u641c\u7d22" id="search" autocomplete="off" /> \t\t\t\t\t\t\t\t\t\t<span class="label icon icon-search" id="searchBtn"></span> \t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t<div class="choose-list" id="chooseList"> \t\t\t\t\t\t\t\t\t\t<div style="text-align:center;padding:20px;"><span class="icon icon-loading"></span>\u6b63\u5728\u52a0\u8f7d\u6570\u636e...</div> \t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t<div class="selected-user"> \t\t\t\t\t\t\t\t<div class="user-list"> \t\t\t\t\t\t\t\t\t<div class="legend"> \t\t\t\t\t\t\t\t\t\u5df2\u6dfb\u52a0\u6210\u5458(<span id="hasAdded">0</span>)  \t\t\t\t\t\t\t\t\t<a href="javascript:;" class="clear" id="clearSelectedUser">\u6e05\u7a7a\u5217\u8868</a> \t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t<div class="selected-list" id="selectedList"> \t\t\t\t\t\t\t\t\t\t<ul> \t\t\t\t\t\t\t\t\t\t</ul> \t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t</div>',
width:692,closeButton:!0,onHide:function(){f.remove()}});f.addButton({text:"\u786e\u5b9a",onclick:function(){p=!0;e.trigger("blur");if(p){var b=[];_(c).each(function(a){b.push(a.id)});Sbox.Loading("\u6b63\u5728\u8bbe\u7f6e\u8bf7\u7a0d\u5019...");a.post("/IpSetting!setIpSet.action",{ips:a.trim(e.val()),userIds:b.join(",")},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(f.remove(),Sbox.Loading().remove(),Sbox.Success("\u8bbe\u7f6e\u6210\u529f"),setTimeout(function(){location.reload()},
1E3)):Sbox.Fail("\u8bbe\u7f6e\u6210\u529f")},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){f.remove()}});var e=a("#ipsIpt"),o=a("#iptError"),j=a("#chooseList"),k=a("#selectedList ul"),n=a("#search"),q=a("#searchBtn"),d=a("#hasAdded"),r=a("#clearSelectedUser"),p=!0;Sbox.placeholder(n);Sbox.placeholder(e);null===b?a.get("/Group!getGroupsContainMember.action?_t="+
Math.random(),function(a){0!==a.length&&(b=a,i=b[0].members,h())},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")}):h();a.get("/IpSetting!getIpSetUsers.action?_t="+Math.random(),function(a){200===a.code?(c=a.users,e.val(a.ips.join(";")),k.empty(),_(c).each(function(a){a='<li data-id="'+a.id+'">                         '+replaceHtml(a.nickName)+'<span class="u-email">&lt;'+a.loginName+'&gt;</span>                         <a href="javascript:;" class="remove" title="\u79fb\u9664"><span class="icon icon-cancle2"></span></a>                     </li>';
k.append(a);k.scrollTop(9999)}),d.text(c.length)):(Sbox.Loading().remove(),f.remove(),Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5"))},"json").error(function(){Sbox.Loading().remove();f.remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")});e.on("keypress",function(a){13===a.keyCode&&f.getButton("\u786e\u5b9a")[0].trigger("click")}).on("focus",function(){o.hide()}).on("blur",function(){var b=a.trim(e.val()),d=/^(25[0-5]|2[0-4][0-9]|[1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$/;
if(""===b)o.text("\u8bf7\u8f93\u5165IP\u5730\u5740").show(),p=!1;else for(var b=b.split(";"),c=0,f=b.length;c<f;c++)if(""!==a.trim(b[c])&&!d.test(a.trim(b[c]))){p=!1;o.text("IP\u683c\u5f0f\u4e0d\u6b63\u786e").show();break}});j.on("mouseenter","li,dt",function(){a(this).addClass("hover")}).on("mouseleave","li,dt",function(){a(this).removeClass("hover")}).on("click","dt .icon",function(b){var c=a(this),d=c.parent().next();c.hasClass("icon-gopen")?(d.hide(),c.removeClass("icon-gopen").addClass("icon-gclose")):
c.hasClass("icon-gclose")&&(d.show(),c.removeClass("icon-gclose").addClass("icon-gopen"));b.stopImmediatePropagation()}).on("click","dt",function(){var c=a(this).attr("data-id"),d;_(b).each(function(a){a.id==c&&(d=a.members)});_(d).each(function(a){g(a)})}).on("click","li",function(){var b=a(this).attr("data-id"),c;_(i).each(function(a){a.id==b&&(c=a)});g(c)});k.on("click","li",function(b){var b=a(b.target||b.srcElement),e=a(this),f=e.attr("data-id");b.is(".icon")&&(e.remove(),_(c).each(function(a,
b){a.id==f&&c.splice(b,1)}),d.text(c.length))});r.on("click",function(){k.find(".icon-cancle2").trigger("click")});n.on("keyup",function(){var b=a(this).val(),c=[];_(i).each(function(a){(0<=a.nickName.toLowerCase().indexOf(b.toLowerCase())||0<=a.loginName.toLowerCase().indexOf(b.toLowerCase()))&&c.push(a)});var d=RegExp("("+b+")","gi");if(""===b||b===a(this).attr("placeholder"))j.find("dl").show(),j.find(".search-list").hide();else{j.find(".search-list")[0]||j.append('<ul class="search-list"></ul>');
var e=j.find(".search-list").show(),f="";_(c).each(function(a){f+='<li title="'+a.nickName+"<"+a.loginName+'>" data-id="'+a.id+'">'+replaceHtml(a.nickName).replace(d,"<b>$1</b>")+'<span class="u-email">&lt;'+a.loginName.replace(d,"<b>$1</b>")+"&gt;</span></li>"});e.html(f);j.find("dl").hide()}});q.on("click",function(){n.trigger("keyup")});return f}})(jQuery);
jQuery(function(){if(document.getElementById("manageEquipment"))$("#manageEquipment").find("table").on("click",".close",function(){var a=$(this).attr("data-id");Sbox.Warning({title:"\u7981\u7528\u8bbe\u5907",message:'<p>\u60a8\u786e\u5b9a\u8981\u7981\u7528\u8be5\u8bbe\u5907\u5417\uff1f</p><p class="tip">\u7981\u7528\u540e\u8be5\u8bbe\u5907\u5c06\u65e0\u6cd5\u767b\u5f55\u7f51\u76d8\uff01</p>',closeButton:!0,callback:function(h){if(h){var g=Sbox.Loading("\u6b63\u5728\u7981\u7528\u8bf7\u7a0d\u5019");
$.post("/DeviceManage!disabledDevice.action",{mac:a},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(g.remove(),Sbox.Success("\u7981\u7528\u6210\u529f"),setTimeout(function(){location.reload()},1E3)):Sbox.Fail("\u7981\u7528\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}}})}).on("click",".open",function(){var a=$(this).attr("data-id"),h=Sbox.Loading("\u6b63\u5728\u542f\u7528\u8bf7\u7a0d\u5019");
$.post("/DeviceManage!enabledDevice.action",{mac:a},function(a){701===a.code||403===a.code?Sbox.Login():200===a.code?(h.remove(),Sbox.Success("\u542f\u7528\u6210\u529f"),setTimeout(function(){location.reload()},1E3)):Sbox.Fail("\u542f\u7528\u5931\u8d25")},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})})});
