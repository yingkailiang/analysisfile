var Sbox={Models:{},Views:{},Controllers:{},Collections:{},Util:{}},MY_DISK_NAME="\u6211\u7684\u6587\u4ef6",PUBLIC_DISK_NAME="\u4f01\u4e1a\u5171\u4eab",SHARE_DISK_NAME="\u5171\u4eab\u6587\u4ef6",OUT_CHAIN="\u5916\u94fe\u7ba1\u7406",RECYCLE_BIN="\u56de\u6536\u7ad9",WEBSITE_NAME="\u641c\u72d0\u4f01\u4e1a\u7f51\u76d8",STATIC_DOMAIN="pan.cdn.sohusce.com",PREVIEW_URL="pan.sohu.net/img/";
location.href.match(/^https/i)?(STATIC_DOMAIN="https://"+STATIC_DOMAIN,PREVIEW_URL="https://"+PREVIEW_URL):(STATIC_DOMAIN="http://"+STATIC_DOMAIN,PREVIEW_URL="http://"+PREVIEW_URL);_.templateSettings={escape:/<#-([\s\S]+?)#>/g,evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g};
var mailReg=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z]{2,4})$/,notAllow=/[\\\/\:\*\?\"\<\>\|]/,zhReg=/[^\x00-\xff]/g,nameReg=/^[\u4E00-\u9FA5a-z0-9_]+$/i,imgType=/\.(jpg|jpeg|png|bmp|gif)$/i,previewFileType=/^(jpg|jpeg|png|bmp|gif|pdf|txt|css|csv|java|c|cpp|jsp|asp|php|py|as|sh|doc|docx|xls|xlsx|ppt|pps|pptx|wps|mp3|avi|swf|flv)$/,isPlaceholderSupport="placeholder"in document.createElement("input"),supportHtml5=window.File&&window.FileReader&&window.FileList&&window.Blob;
navigator.userAgent.split("Chrome/")[1]&&(supportHtml5=0<navigator.userAgent.indexOf("SE 2.X")?supportHtml5&&14<1*navigator.userAgent.split("Chrome/")[1].substring(0,2):supportHtml5&&11<=1*navigator.userAgent.split("Chrome/")[1].substring(0,2));
function formatbytes(b){if(b>=1024&&b<1048576)return Math.round(b/1024*100)/100+" KB";if(b>=1048576&&b<1073741824)return Math.round(b/1024/1024*100)/100+" MB";if(b>=0&&b<1024)return b+" B";if(b>=1073741824)return Math.round(b/1024/1024/1024*100)/100+" GB"}function getFileType(b){var d=b.lastIndexOf(".");if(d<0)return"unknow";b=b.substring(d+1);return/[^a-zA-Z0-9]/g.test(b)||b.length>4?"unknow":b.toLowerCase()}
function jsonToString(b){switch(typeof b){case "string":return'"'+b.replace(/(["\\])/g,"\\$1")+'"';case "array":return"["+b.map(this.jsonToString).join(",")+"]";case "object":if(b instanceof Array){for(var d=[],g=b.length,e=0;e<g;e++)d.push(this.jsonToString(b[e]));return"["+d.join(",")+"]"}if(b==null)return"null";d=[];for(g in b)d.push(this.jsonToString(g)+":"+this.jsonToString(b[g]));return"{"+d.join(",")+"}";case "number":return b;case false:return b}}
function replaceHtml(b){return b.replace("<","&lt;").replace(">","&gt;")}function checkFlash(){var b=true;if($.browser.msie)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(d){b=false}else navigator.plugins["Shockwave Flash"]||(b=false);return b}function getStrSize(b){return b.replace(zhReg,"**").length}function cutStr(b,d){if(getStrSize(b)<=d)return b;for(var g=b.length,e=Math.floor(d/2);e<g;e++)if(getStrSize(b.substr(0,e))>=d)return b.substr(0,e);return b}
function isPreviewImgFile(b,d){return imgType.test(b)&&d<10485760}(function(){if(!window.console)window.console={log:function(){}}})(jQuery);
(function(b){var d=1E3,g=null,e=null,c=null,f=null,h=null,a=null,k=null,i=document.compatMode!="BackCompat",j=(b.browser.msie?'<iframe width="100%" height="100%" frameBorder="0" src="javascript:false" style="position:absolute;top:0;left:0;z-index:1;"></iframe>':"")+'<table id="ui_dialog_container" style="width: 100%; height: 100%; position:relative; z-index:2;" class="pop_dialog_table"><tbody><tr><td class="pop_content" colspan="3"><div class="dialog_header" id="ui_dialog_header"><div id="ui_dialog_title" class="dialog_title"><#= title #></div><a id="ui_dialog_minimize" class="dialog_minimize" href="javascript:;" >\u6700\u5c0f\u5316</a><a id="ui_dialog_close" class="dialog_close" href="javascript:;" >\u5173\u95ed</a></div><div id="ui_dialog_body" class="dialog_body"><#= body #></div><div id="ui_dialog_footer" class="dialog_footer"><#= footer #></div></td></tr></tbody></table>';Sbox.Views.Overlay=
Backbone.View.extend({className:"overlay",template:_.template('<iframe width="100%" height="100%" frameBorder="0" src="javascript:false" style="position:absolute;top:0;left:0;z-index:1;"></iframe><div style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;"></div>'),opacity:0.3,initialize:function(){_.bindAll(this,"resize");b(window).bind("resize",this.resize);this.render()},render:function(){b(this.el).html(this.template()).css({position:"absolute",top:0,left:0,background:this.options.bgcolor||
"#000",opacity:this.options.opacity||this.opacity,"z-index":this.options.zIndex||d++}).appendTo(b("body"));b(this.el).find("div").css({background:this.options.bgcolor||"#000"});this.options.modal&&b("html,body").css("overflow","hidden");this.resize()},resize:function(){var a=b(this.el);setTimeout(function(){a.hide();var b=i?Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth):Math.max(document.body.scrollWidth,document.body.clientWidth),c=i?Math.max(document.documentElement.scrollHeight,
document.documentElement.clientHeight):Math.max(document.body.scrollHeight,document.body.clientHeight);a.css({width:b,height:c});a.show()},0)},enable:function(){this.remove();b(window).unbind("resize",this.resize);b(document.body).css("overflow","")}});Sbox.Views.Window=Backbone.View.extend({className:"dialog",template:_.template(j),initialize:function(){this._buttons=[];this.render()},render:function(){var a=this;this.zIndex=this.options.zIndex||d++;_.bindAll(this,"show","hide","remove","_escHide",
"_clickHide");b(this.el).html(this.template({title:this.options.title||"",body:this.options.body||"",footer:this.options.footer||""})).css({position:"absolute",top:-9999,left:-9999,"z-index":this.zIndex,width:this.options.width||400,height:this.options.height||"auto"}).appendTo(b("body"));this.dialogContainer=b("#ui_dialog_container").removeAttr("id");this.header=b("#ui_dialog_header").removeAttr("id");this.title=b("#ui_dialog_title").removeAttr("id");this.body=b("#ui_dialog_body").removeAttr("id");
this.footer=b("#ui_dialog_footer").removeAttr("id");this.minimizeButton=b("#ui_dialog_minimize").removeAttr("id");this.closeButton=b("#ui_dialog_close").removeAttr("id");this.header.hide=function(){b(this).hide();return a};this.footer.hide=function(){b(this).hide();return a};this.options.minimize?this.options.onMinimize?b(this.minimizeButton).bind("click",this.options.onMinimize):b(this.minimizeButton).bind("click",this.hide):b(this.minimizeButton).hide();this.options.closeButton?this.options.onClose?
b(this.closeButton).bind("click",this.options.onClose):b(this.closeButton).bind("click",this.hide):b(this.closeButton).hide();this.options.esc!==false&&b(document).bind("keyup",this._escHide);b(this.el).drag("start",function(){b(a.el).find("input").trigger("blur")}).drag(function(a,n){b(this).css({top:n.offsetY,left:n.offsetX})},{handle:this.header,drop:false});this.show()},show:function(){var a,c,f,d,h=this;this.$el.css({left:-9999,top:-9999}).show();f=i?document.documentElement.clientWidth:document.body.clientWidth;
d=i?document.documentElement.clientHeight:document.body.clientHeight;a=this.options.left||Math.max(parseInt((f-b(this.el).width())/2),0)+b(document).scrollLeft();c=this.options.top||Math.max(parseInt((d-b(this.el).height())/2),0)+b(document).scrollTop();if(this.options.overlay!==false)this.overlay=new Sbox.Views.Overlay({zIndex:this.zIndex-1,modal:this.options.modal});setTimeout(function(){h.moveTo(a,c)},20);this.options.onShow&&this.options.onShow();return this},hide:function(){if(b(this.el).is(":visible")){this.options.onHide&&
this.options.onHide();this.$el.hide();this.overlay&&this.overlay.enable();return this}},remove:function(){this.options.onRemove&&this.options.onRemove();b(this.el).remove();this.overlay&&this.overlay.enable();b(document).unbind("keyup",this._escHide);b(document).unbind("click",this._clickHide);return this},_escHide:function(b){b.keyCode==27&&this.hide()},_clickHide:function(b){b.button==0&&this.hide()},moveTo:function(a,c){var f=b(this.el);(a||a===0)&&f.css("left",a);(c||c===0)&&f.css("top",c);return this},
resizeTo:function(a,c){var f=b(this.el);a&&f.css("width",a);c&&f.css("height",c);return this},addStyle:function(a){b(this.el).addClass(a);return this},setTitle:function(b){this.title.html(b);return this},setBody:function(b){this.body.html(b);return this},setFooter:function(b){this.footer.html(b);this._buttons=[];return this},addButton:function(a){var c=_.template('<a href="javascript:;" class="btn btn24 btn24-gray <#= className #>"><#= text #></a>'),c=b(c({className:a.className||"",text:a.text||"\u786e\u5b9a"}));
c.bind("click",a.onclick);this.footer.append(c);this._buttons.push(c);return this},getButton:function(b){var a=[];_(this._buttons).each(function(c){c.text()==b&&a.push(c)});return a},delButton:function(b){this._buttons=_(this.getButton(b)).chain().each(function(b){b.remove()}).reject(function(a){return a.text()==b}).value();return this}});Sbox.Alert=function(b){g&&g.remove();var a={};typeof b==="string"?_.extend(a,{message:b}):_.extend(a,b);var c=(new Sbox.Views.Window({title:a.title||"\u63d0\u793a",
body:a.message||"",overlay:a.overlay,width:a.width||300,clickHide:false,esc:false,closeButton:true,onHide:a.onHide,onShow:a.onShow,onRemove:a.onRemove})).addButton({text:a.yes||"\u786e\u5b9a",className:"confirm",onclick:function(){a.callback&&a.callback();c.hide()}}).addStyle("dialog-alert");setTimeout(function(){c.getButton(a.yes||"\u786e\u5b9a")[0].focus()},20);return g=c};Sbox.Confirm=function(b,a){e&&e.remove();var c={};typeof b==="string"?_.extend(c,{message:b,callback:a}):_.extend(c,b);var f=
(new Sbox.Views.Window({title:c.title||"\u63d0\u793a",body:c.message||"",width:c.width||300,height:c.height||"auto",overlay:c.overlay,clickHide:false,closeButton:c.closeButton||true,onHide:c.onHide,onShow:c.onShow,onRemove:c.onRemove})).addButton({text:c.yes||"\u786e\u5b9a",className:"confirm",onclick:function(){c.callback&&c.callback(true);f.hide()}}).addButton({text:c.no||"\u53d6\u6d88",className:"cancle",onclick:function(){c.callback&&c.callback(false);f.hide()}}).addStyle("dialog-confirm");e=
f;setTimeout(function(){f.getButton(c.yes||"\u786e\u5b9a")[0].focus()},20);return f};Sbox.Error=function(b){f&&f.remove();var a={};typeof b==="string"?_.extend(a,{message:b}):_.extend(a,b);a.message='<div class="er-msg">'+a.message+"</div>";var c=(new Sbox.Views.Window({title:a.title||"\u63d0\u793a",body:a.message||"",overlay:a.overlay,width:a.width||440,height:a.height||"auto",overlay:a.overlay,clickHide:false,closeButton:a.closeButton||true,onHide:a.onHide,onShow:a.onShow,onRemove:a.onRemove})).addButton({text:a.yes||
"\u786e\u5b9a",className:"confirm",onclick:function(){a.callback&&a.callback();c.hide();return false}}).addStyle("dialog-error");setTimeout(function(){c.getButton(a.yes||"\u786e\u5b9a")[0].focus()},20);return f=c};Sbox.Warning=function(b,a){h&&h.remove();var c={};typeof b==="string"?_.extend(c,{message:b,callback:a}):_.extend(c,b);c.message='<div class="wn-msg">'+c.message+"</div>";var f=(new Sbox.Views.Window({title:c.title||"\u63d0\u793a",body:c.message||"",width:c.width||560,height:c.height||"auto",
overlay:c.overlay,clickHide:false,closeButton:c.closeButton||true,onHide:c.onHide,onShow:c.onShow,onRemove:c.onRemove})).addButton({text:c.yes||"\u786e\u5b9a",className:"confirm",onclick:function(){c.callback&&c.callback(true);c.preventHide||f.hide()}}).addButton({text:c.no||"\u53d6\u6d88",className:"cancle",onclick:function(){c.callback&&c.callback(false);f.hide()}}).addStyle("dialog-warning");setTimeout(function(){f.getButton(c.yes||"\u786e\u5b9a")[0].focus()},20);return h=f};Sbox.Loading=function(b){c&&
c.remove();return c=b=(new Sbox.Views.Window({body:'<p class="progress"><span class="icon icon-loading"></span> '+b+"</p>",width:300,clickHide:false,esc:false,closeButton:false})).header.hide().footer.hide().addStyle("dialog_loading")};Sbox.Success=function(b,c){a&&a.remove();var c=c||(b.length>10?2:1),f=(new Sbox.Views.Window({body:'<p class="success"><span></span> '+b+"</p>",width:b.length>10?350:300,clickHide:false,closeButton:false})).header.hide().footer.hide().addStyle("dialog_success");a=f;
setTimeout(function(){f.remove()},c*1E3);return f};Sbox.Fail=function(b,a){k&&k.remove();var a=a||(b.length>10?2:1),c=(new Sbox.Views.Window({body:'<p class="fail"><span></span> '+b+"</p>",width:b.length>10?350:300,clickHide:false,closeButton:false})).header.hide().footer.hide().addStyle("dialog_fail");k=c;setTimeout(function(){c.remove()},a*1E3);return c};Sbox.Views.Tips=Backbone.View.extend({className:"tips",template:_.template(""),initialize:function(){},render:function(){},show:function(){}});
Sbox.Views.Pager=Backbone.View.extend({className:"page",template:_.template('<#     var pageCount = Math.ceil(total / pagesize);#><# if(pageCount <= 1){ #><#} else{ #><ul>    <# if(curpage == 1) {#>    <li class="prev-page" style="display:none;"><span>\u4e0a\u4e00\u9875</span></li>    <#} else {#>    <li class="prev-page"><a href="javascript:;">\u4e0a\u4e00\u9875</a></li>    <#}#>    <# if(curpage == 1) {#>    <li  class="cur-page" _page="1"><a href="javascript:;">1</a></li>    <#} else {#>    <li _page="1"><a href="javascript:;">1</a></li>    <#}#>    <# if( curpage - (middleCount - 1) / 2 >= 4 ){ #>    <li><span>...</span></li>    <# } #>    <#        var start=2,end=pageCount-1,left = Math.floor((middleCount-1) / 2),right = (middleCount%2)? (middleCount-1)/2 : middleCount / 2;        if(curpage - left > start + 1){                start = curpage - left;        }        if(curpage + right < end - 1){                end = curpage + right        }     #>    <# for(;start<=end;start++){ #>    <li<# if(start===curpage){ #> class="cur-page"<# } #> _page="<#= start #>"><a href="javascript:;"><#= start #></a></li>    <# } #>    <# if( curpage + (middleCount - 1) / 2 <= pageCount - 3 ){ #>    <li><span>...</span></li>    <# } #>    <# if(curpage == pageCount) {#>    <li  class="cur-page" _page="<#= pageCount #>"><a href="javascript:;"><#= pageCount #></a></li>    <#} else {#>    <li _page="<#= pageCount #>"><a href="javascript:;"><#= pageCount #></a></li>    <#}#>    <# if(curpage === pageCount){ #>    <li class="next-page" style="display:none;"><span>\u4e0b\u4e00\u9875</span></li>    <# }else{ #>    <li class="next-page"><a href="javascript:;">\u4e0b\u4e00\u9875</a></li>    <# } #></ul><# } #>'),
events:{"click li":"go"},initialize:function(){var a=new Sbox.Models.Pager;this.options.curpage&&a.set({curpage:this.options.curpage},{silent:true});this.options.total&&a.set({total:this.options.total},{silent:true});this.options.pagesize&&a.set({pagesize:this.options.pagesize},{silent:true});this.options.middleCount&&a.set({middleCount:this.options.middleCount},{silent:true});this.model=a;_.bindAll(this,"render");this.model.bind("change",this.render);this.container=typeof this.options.container===
"string"?b("#"+this.options.container):b(this.options.container);this.container.append(this.render().el)},render:function(){b(this.el).html(this.template(this.model.toJSON()));return this},go:function(a){a=b(a.currentTarget);curpage=a.hasClass("prev-page")&&a.find("a")[0]?this.model.get("curpage")-1:a.hasClass("next-page")&&a.find("a")[0]?this.model.get("curpage")+1:parseInt(a.attr("_page"));this.goToPage(curpage)},goToPage:function(a){var b=this.model.getPapeCount(),a=parseInt(a);if(!(a===this.model.get("curpage")||
isNaN(a))){a>b&&(a=b);a<=0&&(a=1);this.model.set({curpage:a});this.options.callback(this.model)}},resetTotal:function(a){this.model.set({total:a})},resetCurpage:function(a){this.model.set({curpage:a})}});Sbox.makeSelector=function(a){var a=typeof a==="string"?b("#"+a):a,c=b('<div class="selector"><span class="value"></span><span class="handle arrow-down"></span><ul class="values"></ul></div>'),f=c.find(".value"),d=c.find(".handle"),h=c.find(".values"),i=a.find("option");_(i).each(function(a){a=b(a);
a=b('<li data-value="'+a.val()+'">'+a.text()+"</li>");h.append(a)});c.width(a.width());a.after(c).hide();f.text(a.find("option:selected").text());c.on("click",".value,.handle",function(){if(h.is(":hidden")){if(h.height()>200){h.height(200);h.css("overflow","auto")}h.show()}else h.hide()});h.on("click","li",function(){var c=b(this),d=c.attr("data-value"),c=c.text();f.text(c);a.find('option:[value="'+d+'"]').attr("selected",true);a.trigger("change");h.hide()}).on("mouseenter","li",function(){b(this).addClass("hover")}).on("mouseleave",
"li",function(){b(this).removeClass("hover")});b(document).on("click",function(a){a=b(a.target);!a.is(f)&&(!a.is(d)&&!a.is(h))&&h.hide()});return c};Sbox.Util.makeSelector=Sbox.makeSelector;Sbox.placeholder=function(a){var a=typeof a==="string"?b("#"+a):a,c=a.attr("placeholder");if(!isPlaceholderSupport){if(a.val()===""){a.css("color","#A9A9A9");a.val(c)}a.on("focus",function(){if(a.val()===c){a.val("");a.css("color","#333")}}).on("blur",function(){if(a.val()===""){a.val(c);a.css("color","#A9A9A9")}})}};
Sbox.Util.placeholder=Sbox.placeholder;Sbox.Util.selectUser=function(a){function c(){b.get("/ShareManager!getVisitors.action?_t="+Math.random(),function(a){i=a.code===701||a.code===403?[]:a},"json").error(function(){etime++;etime>d||setTimeout(function(){c()},500)})}function f(a){var b=[];if(a==="")return b=_.filter(i,function(a){return a.type!=="g"});_(i).each(function(c){c.type==="p"&&(c.loginName.toLowerCase().indexOf(a.toLowerCase())>=0||c.nickName.toLowerCase().indexOf(a.toLowerCase())>=0)&&
b.push(c)});return b}var a=typeof a==="string"?b("#"+a):a,h,d=10,i=null;if(a.is("input")){var e=b('<div class="select-users-search" style="display:none;"></div>'),g=b("<ul></ul>");e.append(g).appendTo(b("body"));c();a.on("keydown",function(a){if(i){var c=f(this.value);if(a.keyCode===38){var h=e.find("li.hover");if(h[0])if(h.eq(0).prev()[0]){h.removeClass("hover");h.eq(0).prev().addClass("hover");var d=e.find("li").index(e.find("li.hover")),h=e.scrollTop();c.length>10&&d*24<h&&setTimeout(function(){e.scrollTop(24*
d)},20)}else{h.removeClass("hover");e.find("li:last").addClass("hover");setTimeout(function(){e.scrollTop(24*(c.length-9))},20)}else e.find("li:last").addClass("hover");a.preventDefault()}else if(a.keyCode===40){h=e.find("li.hover");if(h[0])if(h.eq(0).next()[0]){h.removeClass("hover");h.eq(0).next().addClass("hover");d=e.find("li").index(e.find("li.hover"));h=e.scrollTop();c.length>10&&(d-10)*24>=h&&setTimeout(function(){e.scrollTop(24*(d-9))},20)}else{h.removeClass("hover");e.find("li:first").addClass("hover");
setTimeout(function(){e.scrollTop(0)},20)}else e.find("li:first").addClass("hover");a.preventDefault()}else if(a.keyCode===13){h=e.find("li.hover");if(h[0]){h.trigger("click");b(this).trigger("blur")}a.preventDefault()}}}).on("focus",function(){b(this).trigger("keyup")}).on("blur",function(){h=setTimeout(function(){e.hide()},150)}).on("keyup",function(b){if(i){var c=a.offset(),h=a.outerHeight(),d=a.outerWidth(),k=this.value,j=f(k),x="",l=RegExp("("+k+")","gi");if(!(b.keyCode===38||b.keyCode===40||
b.keyCode===13))if(j.length===0){g.empty();e.hide()}else{_(j).each(function(a,b){x=x+('<li class="'+(b===0?"hover":"")+'" data-id="'+a.id+'" data-email="'+a.loginName+'">'+replaceHtml(a.nickName).replace(l,"<b>$1</b>")+"<span>&lt;"+a.loginName.replace(l,"<b>$1</b>")+"&gt;</span></li>")});g.html(x);j.length>10?e.height(240):e.height("auto");e.scrollTop(0);e.css({top:c.top+h,left:c.left,width:d-8});e.show()}}});e.on("click","li",function(c){c=b(c.currentTarget);a.val(c.attr("data-email"));e.hide()}).on("mouseenter",
"li",function(){e.find("li").removeClass("hover");b(this).addClass("hover")}).on("mouseleave","li",function(){}).on("focus",function(){clearTimeout(h);e.show()}).on("blur",function(){e.hide()})}}})(jQuery);
(function(){Sbox.DeleteFile=function(b,d){return Sbox.Warning({title:"\u5220\u9664\u6587\u4ef6",message:'<p>\u60a8\u786e\u5b9a\u8981\u5220\u9664\u6240\u9009\u6587\u4ef6\u5417\uff1f</p><p class="tip">\u6587\u4ef6\u5220\u9664\u540e\u4f1a\u79fb\u52a8\u5230\u56de\u6536\u7ad9\u3002</p>',closeButton:true,callback:function(g){g&&b.deleteFiles(d)}})}})(jQuery);
(function(){Sbox.EmptyRecyclebin=function(b){return Sbox.Warning({title:"\u6e05\u7a7a\u56de\u6536\u7ad9",message:'<p>\u60a8\u786e\u5b9a\u8981\u6e05\u7a7a\u56de\u6536\u7ad9\u5417?</p><p class="tip">\u6e05\u7a7a\u540e\u6587\u4ef6\u5c06\u65e0\u6cd5\u627e\u56de\uff01</p>',closeButton:true,callback:function(d){d&&b.empty()}})}})(jQuery);
(function(b){Sbox.SetSize=function(d){function g(){b.get("/User!freeSpace.action?_t="+Math.random(),function(a){if(a.code===701||a.code===403)Sbox.Login();else if(a.code===200){n=a.freeSpace;d.get("size")>0&&(n=n+d.get("size"));k.html(formatbytes(n))}else{k.html('<span class="error">\u83b7\u53d6\u5931\u8d25\uff0c<a href="javascript:;">\u91cd\u65b0\u83b7\u53d6</a></span>');k.find("a").click(function(){k.html('<span class="icon icon-loading"></span>');g()})}},"json").error(function(){k.html('<span class="error">\u83b7\u53d6\u5931\u8d25\uff0c<a href="javascript:;">\u91cd\u65b0\u83b7\u53d6</a></span>');
k.find("a").click(function(){k.html('<span class="icon icon-loading"></span>');g()})})}var e=new Sbox.Views.Window({title:"\u7a7a\u95f4\u5206\u914d",body:'<div class="setsize-dialog"> \t\t\t\t    \t\t<div class="field"> \t\t\t\t    \t\t\t<div class="label">\u5171\u4eab\u6587\u4ef6\u5939\u7a7a\u95f4\u5206\u914d\uff1a</div> \t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t    \t\t\t\t<input type="text" class="ipt-text" /> MB \t\t\t\t    \t\t\t</div> \t\t\t\t    \t\t\t<div class="tips"></div> \t\t\t\t    \t\t</div> \t\t\t\t    \t\t<div class="field" style="margin-bottom:0; color:gray; line-height:1.5;"> \t\t\t\t    \t\t\t<div class="label"></div> \t\t\t\t    \t\t\t<div class="ipt">\u8be5\u6587\u4ef6\u5939\u5927\u5c0f\uff1a<em id="usedSpace"></em> <br />\u5269\u4f59\u53ef\u5206\u914d\u7a7a\u95f4\uff1a<em id="freeSpace"></em></div> \t\t\t\t    \t\t</div> \t\t\t\t    \t</div>',
closeButton:true,width:500,onHide:function(){e.remove()}});e.addButton({text:"\u786e\u5b9a",onclick:function(){i=true;f.trigger("blur");if(i){e.remove();d.trigger("setsize.begin");d.setsize(b.trim(f.val()))}},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){e.remove()},className:"cancle"});var c=e.body,f=c.find("input"),h=c.find(".tips"),a=c.find("#usedSpace"),k=c.find("#freeSpace"),i=true,j=d.get("usedSpace"),n;d.get("size")>0&&f.val(parseInt(d.get("size"))/1024/1024);f.focus();
a.html(formatbytes(j));g();f.on("keypress",function(a){a.keyCode===13&&e.getButton("\u786e\u5b9a")[0].trigger("click")}).on("focus",function(){h.empty()}).on("blur",function(){var a=b.trim(f.val());if(!(b.isNumeric(a)&&a*1>0)||(a+"").indexOf(".")>=0){h.html('<span class="error">\u5fc5\u987b\u662f\u5927\u4e8e0\u7684\u6574\u6570</span>');i=false}else if(a*1048576<j){h.html('<span class="error">\u5c0f\u4e8e\u6587\u4ef6\u5939\u5b9e\u9645\u5927\u5c0f</span>');i=false}else if(n&&a*1048576>n){h.html('<span class="error">\u5269\u4f59\u53ef\u5206\u914d\u7a7a\u95f4\u4e0d\u8db3</span>');
i=false}});return e}})(jQuery);
(function(b){var d=null;Sbox.Share=function(g){function e(){var a="";_(d).each(function(b){b.type==="g"?a=a+('<li _id="'+b.id+'" title="'+b.group_name+'"  class="share-group"><span class="icon icon-group"></span><span class="name">'+replaceHtml(b.group_name)+"</span></li>"):b.type==="p"&&b.id!==userId&&(a=a+('<li _id="'+b.id+'" title="'+b.nickName+"<"+b.loginName+'>" class="share-user"><span class="icon icon-user"></span><span class="name">'+replaceHtml(b.nickName)+'<span class="u-mail">&lt;'+b.loginName+
"&gt;</span></span></li>"))});n.html(a)}function c(c){var f,h;if(c.isOutDomain!==1)if(c.type==="g"){h=c.group_name;f=getStrSize(c.group_name)>20?cutStr(c.group_name,20)+"...":c.group_name}else{h=c.nickName;f=getStrSize(c.nickName)>20?cutStr(c.nickName,20)+"...":c.nickName}else{h=c.nickName+"("+c.email+")";f=getStrSize(h)>16?cutStr(h,16)+"...":h}var d='<li _id="'+c.id+'" class="'+(c.type==="g"?"share-group":"share-user")+'"> \t\t\t\t\t\t<div class="to"> \t\t\t\t\t\t\t<span class="icon '+(c.type===
"g"?"icon-group":c.isOutDomain===1&&c.effective===1?"icon-user-unaccepted":"icon-user")+'"></span> \t    \t\t\t\t\t<span class="user" title="'+h+'">'+f+'</span> \t    \t\t\t\t\t<a class="delete" href="javascript:;"> <span class="icon icon-deletex"></span></a> \t    \t\t\t\t\t'+(c.isOutDomain===1&&c.effective===1?'<a href="javascript:;" class="invite">\u91cd\u65b0\u9080\u8bf7</a><span></span>':"")+' \t    \t\t\t\t</div> \t\t                <div class="power-select"> \t\t                    <select style="width:100px;"> \t\t\t\t\t\t\t\t<option value="4" '+
(c.aclCode===4?'selected="selected"':"")+'>\u4ec5\u9884\u89c8</option> \t\t\t\t\t\t\t\t<option value="5" '+(c.aclCode===5?'selected="selected"':"")+'>\u4ec5\u4e0a\u4f20</option> \t\t\t\t\t\t\t\t<option value="6" '+(c.aclCode===6?'selected="selected"':"")+'>\u53ef\u9884\u89c8\u4e0a\u4f20</option> \t\t\t\t\t\t\t\t<option value="1" '+(c.aclCode===1?'selected="selected"':"")+'>\u53ef\u67e5\u770b</option> \t\t\t\t\t\t\t\t<option value="2" '+(c.aclCode===2?'selected="selected"':"")+'>\u53ef\u67e5\u770b\u4e0a\u4f20</option> \t\t\t\t\t\t\t\t<option value="3" '+
(c.aclCode===3?'selected="selected"':"")+">\u53ef\u7f16\u8f91</option> \t\t                    </select> \t\t                </div>\t\t\t\t\t</li>",d=b(d),e=Sbox.makeSelector(d.find("select"));e.on("mouseenter",function(){var a=b(".shared-body"),c=a.scrollTop(),f=a.find("li.share-group,li.share-user"),h=e.parent().parent(),d=h.outerHeight(),f=f.index(h);c+a.height()-f*d<180&&e.find(".values").addClass("up");e.addClass("selector-hover")}).on("mouseleave",function(){e.find(".values").removeClass("up").hide();
e.removeClass("selector-hover")});d.on("change","select",function(){var f=c.id,h=c.type,e=b(this).val();_(a).each(function(a){if(a.type===h&&a.id===f)a.aclCode=e*1});d.find(".invite").remove()});d.on("click",".invite",function(){var a=b(this),f=a.next();a.hide();f.html('<span class="icon icon-loading"></span>');b.post("/OutDomainShare!reSendEmail.action",{userId:c.id,dirId:g.get("id")},function(c){c.code===701||c.code===403?Sbox.Login():c.code===200?Sbox.Success("\u9080\u8bf7\u5df2\u91cd\u65b0\u53d1\u9001"):
Sbox.Fail("\u53d1\u9001\u5931\u8d25");a.show();f.empty()},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})});return d}function f(c,b){var f=false;_(a).each(function(a){a.type===b&&a.id===c&&(f=true)});return f}function h(a){var c=[];if(a==="")return d;_(d).each(function(b){b.type==="g"?b.group_name.toLowerCase().indexOf(a.toLowerCase())>=0&&c.push(b):b.type==="p"&&(b.loginName.toLowerCase().indexOf(a.toLowerCase())>=
0||b.nickName.toLowerCase().indexOf(a.toLowerCase())>=0)&&b.id!==userId&&c.push(b)});return c}var a=[],k=null,i=new Sbox.Views.Window({title:"\u5171\u4eab\u6587\u4ef6\u5939",body:'<div class="share-dialog clearfix"> \t\t                <div class="choose-user"> \t\t                    <div class="user-list"> \t\t                        <div class="legend">\u57df\u5185\u7528\u6237\u5171\u4eab</div> \t\t                        <div class="search"> \t\t                            <input type="text" placeholder="\u8f93\u5165\u7fa4\u7ec4\u540d\u3001\u7528\u6237\u540d\u6216\u90ae\u7bb1\u641c\u7d22" /> \t\t                            <span class="label icon icon-search" id="searchBtn" style="cursor:pointer;"> </span> \t\t                        </div> \t\t                        <div class="u-list"> \t\t                            <ul> \t\t                                <li style="padding:20px 0; text-align:center; cursor:default; background:#FFF!important; border:0;"><span class="icon icon-loading"></span>\u6b63\u5728\u52a0\u8f7d...</li> \t\t                            </ul> \t\t                        </div> \t\t                    </div> \t\t                    <div class="add-user"> \t\t                        <div class="legend">\u57df\u5916\u7528\u6237\u5171\u4eab</div> \t\t                        <div class="add-field"> \t\t                            <input type="text" id="addUserIpt" class="ipt-text" placeholder="\u8bf7\u8f93\u5165\u5e10\u53f7\u90ae\u7bb1" /> \t\t                            <a class="btn btn24 btn24-blue" id="addUserBtn" href="javascript:;">\u6dfb\u52a0</a> \t\t                        </div> \t\t                        <div class="tips" id="addUserTip"></div> \t\t                    </div> \t\t                </div> \t\t                <div class="sharelist"> \t\t                    <div class="shared"> \t\t                        <div class="shared-head"> \t\t                            <div class="to">\u5171\u4eab\u7ed9</div> \t\t                            <div class="clearlist"> \t\t                                <a href="javascript:;" class="clear"><span>\u6e05\u7a7a\u5217\u8868</span></a> \t\t                            </div> \t\t                            <div class="share-tip"> \t\t                                <span class="icon icon-tip"> </span> \t\t                                <div class="tip-content"> </div> \t\t                            </div> \t\t                        </div> \t\t                        <div class="shared-body"> \t\t                        \t<ul> \t\t                        \t\t<li style="padding:20px 0; text-align:center; cursor:default; background:#FFF!important; border:0;"><span class="icon icon-loading"></span>\u6b63\u5728\u52a0\u8f7d...</li> \t\t                        \t</ul> \t\t                        </div> \t\t                    </div> \t\t                </div> \t\t            </div>',
width:692,closeButton:true,onHide:function(){i.remove()}});i.addStyle("dialog-share").addButton({text:"\u786e\u5b9a",onclick:function(){k=Sbox.Loading("\u6b63\u5728\u8bbe\u7f6e\u8bf7\u7a0d\u5019...");b.post("/ShareDir!share.action",{dirId:g.get("id"),acl:jsonToString(a)},function(c){if(c.code===701||c.code===403)Sbox.Login();else if(c.code===200){k.remove();Sbox.Success("\u5171\u4eab\u8bbe\u7f6e\u6210\u529f");a.length!==0?g.set({shareFlag:1}):g.set({shareFlag:0,size:-1})}},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")});i.remove()},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){i.remove()},className:"cancle"});var j=i.body,n=j.find(".u-list ul"),l=j.find(".shared-body"),o=j.find(".shared-body ul"),m=j.find(".search input"),p=j.find("#searchBtn"),q=j.find(".clear"),r=j.find(".share-tip"),v=j.find("#addUserIpt"),y=j.find("#addUserBtn"),t=j.find("#addUserTip");Sbox.placeholder(m);Sbox.placeholder(v);d===null?
b.get("/ShareManager!getVisitors.action?_t="+Math.random(),function(a){if(a.code===701||a.code===403){i.hide();Sbox.Login();d=[]}else{d=a;e()}},"json").error(function(){Sbox.Loading().remove();i.remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")}):e();b.get("/GetShareUserList!getService.action?resourceId="+g.get("id")+"&_t="+Math.random(),function(b){a=b;o.empty();_(a).each(function(a){a=c(a);o.append(a)})},"json").error(function(){Sbox.Loading().remove();i.remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")});n.on("click","li",function(){var h=b(this),e=parseInt(h.attr("_id")),i=h.hasClass("share-group")?"g":"p";if(e&&!f(e,i)){var g;_(d).each(function(a){a.type===i&&a.id===e&&(g=a)});h=g;a.push(_.extend(h,{aclCode:4,isOutDomain:0,effective:-1}));h=c(h);o.append(h);l.scrollTop(9999)}}).on("mouseenter","li",function(){b(this).addClass("hover")}).on("mouseleave","li",function(){b(this).removeClass("hover")});o.on("click","li",
function(c){var f=b(this),h=parseInt(f.attr("_id")),d=f.hasClass("share-group")?"g":"p";if(b(c.target||c.srcElement).hasClass("icon-deletex")){f.remove();_(a).each(function(c,b){c.type===d&&c.id===h&&a.splice(b,1)})}});q.on("click",function(){o.find("li .icon-deletex").trigger("click")});m.on("keyup",function(){var a=b(this).val()===b(this).attr("placeholder")?"":b(this).val(),c=h(a),f=RegExp("("+a+")","gi"),d="";n.empty();_(c).each(function(a){a.id!==userId&&(a.type==="g"?d=d+('<li _id="'+a.id+'" class="share-group" title="'+
a.group_name+'"><span class="icon icon-group"></span><span class="name">'+replaceHtml(a.group_name).replace(f,"<b>$1</b>")+"</span></li>"):a.type==="p"&&(d=d+('<li _id="'+a.id+'" class="share-user" title="'+a.nickName+"<"+a.loginName+'>"><span class="icon icon-user"></span><span class="name">'+replaceHtml(a.nickName).replace(f,"<b>$1</b>")+'<span class="u-mail">&lt;'+a.loginName.replace(f,'<b style="color:#333;">$1</b>')+"&gt;</span></span></li>")))});n.append(b(d))}).on("keypress",function(a){a.keyCode===
13&&b(this).trigger("keyup")});p.on("click",function(){m.trigger("keyup")});v.on("keypress",function(a){a.keyCode===13&&y.trigger("click")}).on("keyup",function(){t.empty()});y.on("click",function(){var d=b.trim(v.val());if(d==="")t.html('<span class="error">\u8bf7\u8f93\u5165\u5e10\u53f7\u90ae\u7bb1</span>');else if(mailReg.test(d))if(h(d).length!==0)t.html('<span class="error">\u8be5\u7528\u6237\u4e3a\u57df\u5185\u7528\u6237</span>');else{t.html('<span class="icon icon-loading"></span>');b.post("/User!isExists.action",
{email:d},function(b){t.empty();if(b.code===200){b=b.userInfo;b={id:b.id,aclCode:4,email:b.email,nickName:b.nickName,isOutDomain:1,effective:-1,type:"p"};if(f(b.id,b.type))t.html('<span class="error">\u5df2\u6dfb\u52a0\u8be5\u7528\u6237</span>');else if(b.id===userId)t.html('<span class="error">\u4e0d\u80fd\u5171\u4eab\u7ed9\u81ea\u5df1</span>');else{a.push(b);b=c(b);o.append(b);l.scrollTop(9999)}}else b.code===303?t.html('<span class="error">\u4e0d\u80fd\u5171\u4eab\u7ed9\u81ea\u5df1</span>'):b.code===
404?t.html('<span class="error">\u8be5\u7528\u6237\u4e0d\u5b58\u5728</span>'):t.html('<span class="error">\u6dfb\u52a0\u51fa\u9519</span>')},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}else t.html('<span class="error">\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e</span>')});r.on("mouseenter",".icon-tip",function(){r.find(".tip-content").css("opacity",0.8).show()}).on("mouseleave",".icon-tip",function(){r.find(".tip-content").hide()});
return i};Sbox.CancleShare=function(d){d.get("shareFlag")&&Sbox.Warning({title:"\u89e3\u9664\u5171\u4eab",message:'<p>\u60a8\u786e\u5b9a\u8981\u89e3\u9664\u6240\u9009\u6587\u4ef6\u5939\u5171\u4eab\u5417\uff1f</p><p class="tip">\u89e3\u9664\u540e\u6240\u6709\u5171\u4eab\u6210\u5458\u5c06\u9000\u51fa\u5171\u4eab\u8be5\u6587\u4ef6\u5939\uff01</p>',callback:function(e){if(e){loading=Sbox.Loading("\u6b63\u5728\u53d6\u6d88\u8bf7\u7a0d\u5019...");b.post("/ShareDir!share.action",{dirId:d.get("id"),acl:"[]"},
function(c){if(c.code===701||c.code===403)Sbox.Login();else if(c.code===200){loading.remove();Sbox.Success("\u53d6\u6d88\u5171\u4eab\u6210\u529f");d.set({shareFlag:0,size:-1})}},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}}})};Sbox.ViewShareMember=function(d){var e=(new Sbox.Views.Window({title:"\u67e5\u770b\u5171\u4eab\u6210\u5458",body:'<div class="sharemember-dialog"> \t\t                <div class="member-hd"> \t\t                    <span class="member-user">\u5171\u4eab\u8005</span> \t\t                    <span class="member-power">\u6743\u9650 \t\t\t    \t\t\t\t<div class="share-tip"> \t\t\t    \t\t\t\t\t<span class="icon icon-tip"></span> \t\t\t    \t\t\t\t\t<div class="tip-content"></div> \t\t\t    \t\t\t\t</div> \t\t                    </span> \t\t                </div> \t\t                <div class="member-list"> \t\t                    <ul> \t\t                    \t<li style="text-align:center; padding:20px; border-bottom:0;"><span class="icon icon-loading"></span>\u6b63\u5728\u83b7\u53d6\u5217\u8868...</li> \t\t                    </ul> \t\t                </div> \t\t            </div>',
width:560,closeButton:true})).addStyle("dialog-sharemember");e.addButton({text:"\u5173\u95ed",onclick:function(){e.remove()},className:"cancle"});var c=e.body,f=c.find("ul"),h=c.find(".share-tip");b.get("/GetShareUserList!getService.action?resourceId="+d.get("id")+"&_t="+Math.random(),function(a){sharedUsers=a;var c="",c=c+('<li>                             <div class="member-user"><span class="member-sign"><span class="icon icon-user"></span></span><span class="member-name">'+d.get("shareUserName")+
'</span><span class="member-mail">&lt;'+d.get("shareMail")+'&gt;</span></div>                             <div class="member-power"><span class="power-info">\u6240\u6709\u8005</span></div>                         </li>'),b=["\u53ef\u67e5\u770b","\u53ef\u67e5\u770b\u4e0a\u4f20","\u53ef\u7f16\u8f91","\u4ec5\u9884\u89c8","\u4ec5\u4e0a\u4f20","\u53ef\u9884\u89c8\u4e0a\u4f20"];_(sharedUsers).each(function(a){if(a.type==="g")c=c+('<li> \t\t                            <div class="member-user"><span class="member-sign"><span class="icon icon-group"></span></span><span class="member-name">'+
replaceHtml(a.group_name)+'</span></div> \t\t                            <div class="member-power"><span class="power-info">'+b[a.aclCode-1]+"</span></div> \t\t                        </li>");else if(a.type==="p"&&(a.isOutDomain===0||a.isOutDomain===1&&a.effective===0))c=c+('<li> \t\t\t                            <div class="member-user"><span class="member-sign"><span class="icon icon-user"></span></span><span class="member-name">'+replaceHtml(a.nickName)+'</span><span class="member-mail">&lt;'+
a.email+'&gt;</span></div> \t\t\t                            <div class="member-power"><span class="power-info">'+b[a.aclCode-1]+"</span></div> \t\t\t                        </li>")});f.empty().append(c)},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")});h.on("mouseenter",".icon-tip",function(){h.find(".tip-content").css("opacity",0.8).show()}).on("mouseleave",".icon-tip",function(){h.find(".tip-content").hide()})}})(jQuery);
(function(b){var d='<div class="outchain-dialog"> \t\t\t\t\t\t\t\t<div id="fileInfo" class="file-info"></div> \t\t\t\t\t    \t\t<div class="field"> \t\t\t\t\t    \t\t\t<div class="label">\u8bbf\u95ee\u6743\u9650\uff1a</div> \t\t\t\t\t    \t\t\t<div class="ipt "> \t\t\t\t\t    \t\t\t\t<input type="radio" name="sharePrivilege" value="1" id="sharePrivilege1" /><label for="sharePrivilege1">\u4ec5\u9884\u89c8</label> \t\t\t\t\t    \t\t\t\t<input type="radio" checked="checked" name="sharePrivilege" value="2" id="sharePrivilege2" /><label for="sharePrivilege2">\u53ef\u9884\u89c8\u4e0b\u8f7d</label>  \t\t\t\t\t    \t\t\t</div> \t\t\t\t\t    \t\t\t<div class="tips"></div> \t\t\t\t\t    \t\t</div> \t\t\t\t\t    \t\t<div class="field"> \t\t\t\t\t    \t\t\t<div class="label">\u8bed\u8a00\u8bbe\u7f6e\uff1a</div> \t\t\t\t\t    \t\t\t<div class="ipt "> \t\t\t\t\t    \t\t\t\t<input type="radio" checked="checked" name="language" value="0" id="language0" /><label for="language0">\u4e2d\u6587</label>  \t\t\t\t\t    \t\t\t\t<input type="radio" name="language" value="1" id="language1" /><label for="language1">\u82f1\u6587</label>  \t\t\t\t\t    \t\t\t</div> \t\t\t\t\t    \t\t\t<div class="tips"></div> \t\t\t\t\t    \t\t</div> \t\t\t\t\t    \t\t<div class="field"> \t\t\t\t\t    \t\t\t<div class="label">\u8bbf\u95ee\u5bc6\u7801\uff1a</div> \t\t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t\t    \t\t\t\t<div class="switch"> \t\t\t\t\t    \t\t\t\t\t<a href="javascript:;" class="off" hidefocus="true"><span>\u5f00/\u5173</span></a> \t\t\t\t\t    \t\t\t\t\t<input id="needPass" type="hidden" value="0" /> \t\t\t\t\t    \t\t\t\t</div> \t\t\t\t\t    \t\t\t\t<div class="pass" id="passwords" style="display:none;"> \t\t\t\t\t    \t\t\t\t\t<p>\u8f93\u5165\u5bc6\u7801\uff1a<input class="ipt-text" type="password" onpaste="return false;" /> <span class="tips"></span></p> \t\t\t\t\t    \t\t\t\t\t<p>\u786e\u8ba4\u5bc6\u7801\uff1a<input class="ipt-text" type="password" onpaste="return false;" /> <span class="tips"></span></p> \t\t\t\t\t    \t\t\t\t</div> \t\t\t\t\t    \t\t\t</div> \t\t\t\t\t    \t\t</div> \t\t\t\t\t    \t\t<div class="field"> \t\t\t\t\t    \t\t\t<div class="label">\u5931\u6548\u65f6\u95f4\uff1a</div> \t\t\t\t\t    \t\t\t<div class="ipt "> \t\t\t\t\t    \t\t\t\t<div class="datepicker"> \t\t\t\t\t\t    \t\t\t\t<input class="ipt-text" type="text" readonly="readonly" id="datePicker" onclick="WdatePicker({minDate:\'%y-%M-{%d}\'});" /> \t\t\t\t\t\t    \t\t\t\t<span class="icon icon-date" onclick="WdatePicker({el:\'datePicker\',minDate:\'%y-%M-{%d}\'})"></span> \t\t\t\t\t\t    \t\t\t</div>&nbsp; \t\t\t\t\t\t    \t\t\t<select id="hours" style="width:70px;"> \t\t\t\t\t                    </select> \t\t\t\t\t    \t\t\t</div> \t\t\t\t\t    \t\t\t<div class="tips" id="dateTip"></div> \t\t\t\t\t    \t\t</div> \t\t\t\t\t    \t\t<div class="field desc" style="display:none;"> \t\t\t\t\t    \t\t\t<div class="label">\u5916\u94fe\u8bf4\u660e\uff1a</div> \t\t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t\t    \t\t\t\t<textarea class="ipt-text" id="outchainNote"></textarea> \t\t\t\t\t    \t\t\t</div> \t\t\t\t\t    \t\t\t<div class="tips" id="noteTip" style="margin-left:80px;"></div> \t\t\t\t\t    \t\t</div> \t\t\t\t\t    \t</div>';
Sbox.CreateOutChain=function(g){function e(){var f=!g.get("outlink"),h=g.get("hasPassword")*1,a=g.get("sharePrivilege"),e=g.get("language");c=new Sbox.Views.Window({title:f?"\u5916\u94fe\u5206\u4eab":"\u5916\u94fe\u8bbe\u7f6e",body:d,width:500,closeButton:true,onHide:function(){c.remove()}});var i=c.body,j=i.find("#fileInfo"),n=i.find("#needPass"),l=i.find("#passwords"),o=l.find("input").eq(0),m=l.find("input").eq(1),p=l.find(".tips").eq(0),q=l.find(".tips").eq(1),r=i.find("#datePicker"),v=i.find("#hours"),
y=i.find("#dateTip"),t=i.find("#outchainNote"),u=i.find("#noteTip"),w=typeof g.get("parentDir")!=="undefined",s=g.get("name"),z=g.get("size"),x=w?"folder":getFileType(s),B=previewFileType.test(x);if(x==="rar"||x==="zip")z>=104857600&&(B=false);if(w||x==="unknow")z=getStrSize(s)>38?cutStr(s,38)+"...":s;else{z=s.substring(0,s.lastIndexOf("."));z=getStrSize(z)>38?cutStr(z,38)+"...":z+"."+s.substring(s.lastIndexOf(".")+1)}j.html('<span class="file-type '+x+'"></span><span class="file-name" title="'+s+
'">'+z+"</span>");j="";for(s=0;s<24;s++){x=s<10?"0"+s:""+s;x=x+":00";j=j+('<option value="'+x+'">'+x+"</option>")}v.html(j);if(!f){if(h){l.show();p.empty().html('<span class="tip">\u4e0d\u4fee\u6539\u5bc6\u7801\u8bf7\u4fdd\u6301\u4e3a\u7a7a</span>');n.val(1);i.find(".switch a").removeClass("off").addClass("on")}b("#sharePrivilege"+a).attr("checked",true);b("#language"+e).attr("checked",true)}if(!w&&!B){b("#sharePrivilege1").attr("disabled",true);b("#sharePrivilege1").next().css("color","#CCC")}var a=
new Date((new Date).valueOf()+2592E6),A=g.get("expiredate")||a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 00:00:00",A=A.indexOf(" ")>0?A.split(" "):[A,"00:00:00"];r.val(A[0]);t.val(g.get("memo"));setTimeout(function(){v.find('option[value="'+A[1].split(":")[0]+':00"]').attr("selected",true);Sbox.makeSelector(v)},50);o.on("blur",function(){o.val().length>16?p.html('<span class="error">\u5bc6\u7801\u957f\u5ea6\u4e0d\u5f97\u8d85\u8fc716\u4f4d</span>'):p.empty();o.val()===m.val()&&q.empty()});
m.on("blur",function(){o.val()!==m.val()?q.html('<span class="error">\u4e24\u6b21\u8f93\u5165\u5bc6\u7801\u4e0d\u4e00\u81f4</span>'):q.empty()});r.on("click",function(){y.empty()});c.addButton({text:f?"\u751f\u6210\u5916\u94fe":"\u786e\u5b9a",onclick:function(){var a=true;i.find(".tips").empty();if(n.val()==="1")if(!h&&o.val()===""){p.empty().html('<span class="error">\u8bf7\u8f93\u5165\u5bc6\u7801</span>');a=false}else if(o.val().length!==b.trim(o.val()).length){p.empty().html('<span class="error">\u9996\u5c3e\u4e0d\u80fd\u542b\u6709\u7a7a\u683c</span>');
a=false}else if(o.val().length>16){p.html('<span class="error">\u5bc6\u7801\u957f\u5ea6\u4e0d\u5f97\u8d85\u8fc716\u4f4d</span>');a=false}else if(o.val()!==m.val()){q.html('<span class="error">\u4e24\u6b21\u8f93\u5165\u5bc6\u7801\u4e0d\u4e00\u81f4</span>');a=false}if(r.val()===""){y.html('<span class="error">\u8bf7\u9009\u62e9\u5931\u6548\u65f6\u95f4</span>');a=false}else{var f=r.val(),d=v.val()+":00",d=f.split("-").concat(d.split(":"));if(new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5])<new Date){y.html('<span class="error">\u5931\u6548\u65f6\u95f4\u5e94\u5927\u4e8e\u5f53\u524d\u65f6\u95f4</span>');
a=false}}if(t.val().length>200){u.html('<span class="error">\u4e0d\u80fd\u8d85\u8fc7200\u5b57</span>');a=false}if(a){var a=n.val()==="1"?o.val():"",d=r.val()+" "+v.val()+":00",f=t.val(),e=b('input[name="sharePrivilege"]:checked').val(),k=b('input[name="language"]:checked').val();g.createOutChain(parseInt(n.val()),a,d,f,e,k);c.remove()}},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){c.remove()},className:"cancle"});c.body.on("click",".switch a",function(){var a=c.body,f=a.find(".pass"),
a=a.find(".switch input");if(b(this).hasClass("on")){f.hide();a.val(0);b(this).removeClass("on").addClass("off")}else if(b(this).hasClass("off")){f.show();a.val(1);b(this).removeClass("off").addClass("on");h&&p.empty().html('<span class="tip">\u4e0d\u4fee\u6539\u5bc6\u7801\u8bf7\u4fdd\u6301\u4e3a\u7a7a</span>')}})}var c=null;typeof WdatePicker==="undefined"?b.getScript(STATIC_DOMAIN+"/js/libs/datepicker/WdatePicker.js",function(){e()}):e();return c};Sbox.ShowOutChain=function(d){function e(){var a=
new ZeroClipboard.Client;a.setText("");a.setHandCursor(true);b("#outchainCopy span").html(a.getHTML(24,26));a.addEventListener("mouseOver",function(){a.setText(f.val())});a.addEventListener("mouseDown",function(){jQuery.browser.msie&&setTimeout(function(){document.title=WEBSITE_NAME},50)});a.addEventListener("complete",function(){Sbox.Success("\u590d\u5236\u6210\u529f\uff01")});jQuery.browser.msie&&setTimeout(function(){document.title=WEBSITE_NAME},50)}var c=new Sbox.Views.Window({title:"\u67e5\u770b\u5916\u94fe",
body:'<div class="outchain-dialog"> \t\t\t\t\t\t\t<div id="fileInfo" class="file-info"></div> \t\t\t\t    \t\t<div class="field link"> \t\t\t\t    \t\t\t<div class="label">\u5916\u94fe\u5730\u5740\uff1a</div> \t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t    \t\t\t\t<input class="ipt-text" type="text" id="outchainIpt" value="" readonly="readonly" /> <span id="outchainCopy" class="copy">\u590d\u5236<span></span></span> | <a id="outchainCheck" href="#" target="_blank">\u67e5\u770b</a> \t\t\t\t    \t\t\t</div> \t\t\t\t    \t\t</div> \t\t\t\t    \t\t<div class="field link"> \t\t\t\t    \t\t\t<div class="label"></div> \t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t    \t\t\t\t<span class="tip">\u60a8\u53ef\u4ee5\u590d\u5236\u94fe\u63a5\u5730\u5740\uff0c\u901a\u8fc7QQ\u3001msn\u53d1\u7ed9\u540c\u4e8b\u3001\u5408\u4f5c\u4f19\u4f34</span> \t\t\t\t    \t\t\t</div> \t\t\t\t    \t\t</div> \t\t\t\t    \t</div>',
width:500,closeButton:true,onHide:function(){c.remove()},onRemove:function(){jQuery.browser.msie&&setTimeout(function(){document.title=WEBSITE_NAME},50)}});c.addButton({text:"\u5173\u95ed",onclick:function(){c.remove()}});var f=c.body.find("#outchainIpt"),h=b("#fileInfo"),a=typeof d.get("parentDir")!=="undefined",k=d.get("name"),i=a?"folder":getFileType(k);if(a||i==="unknow")a=getStrSize(k)>38?cutStr(k,38)+"...":k;else{a=k.substring(0,k.lastIndexOf("."));a=getStrSize(a)>38?cutStr(a,38)+"...":a+"."+
k.substring(k.lastIndexOf(".")+1)}h.html('<span class="file-type '+i+'"></span><span class="file-name" title="'+k+'">'+a+"</span>");f.val(d.get("outlink"));f.on("click",function(){b(this).select()});c.body.find("#outchainCheck").attr("href",d.get("outlink"));typeof ZeroClipboard==="undefined"?b.getScript(STATIC_DOMAIN+"/js/libs/zeroclipboard/ZeroClipboard.js",function(){e()}):e();return c};Sbox.SendOutChain=function(d){var e=new Sbox.Views.Window({title:"\u90ae\u4ef6\u53d1\u9001",body:'<div class="sendoutchain-dialog"> \t\t\t\t\t\t\t<div id="fileInfo" class="file-info"></div> \t\t\t\t\t    \t\t<div class="field"> \t\t\t\t\t    \t\t\t<div class="label">\u6536\u4ef6\u4eba\uff1a</div> \t\t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t\t    \t\t\t\t<span class="error">\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u68c0\u67e5\u3002</span> \t\t\t\t\t    \t\t\t\t<input id="sendTo" type="text" class="ipt-text" placeholder="\u591a\u4e2a\u90ae\u7bb1\u8bf7\u7528;\u5206\u9694" /> \t\t\t\t\t    \t\t\t</div> \t\t\t\t\t    \t\t</div> \t\t\t\t\t    \t\t<div class="field"> \t\t\t\t\t    \t\t\t<div class="label">\u7559\u8a00\uff1a</div> \t\t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t\t    \t\t\t\t<textarea id="sendContent" class="ipt-text"></textarea> \t\t\t\t\t    \t\t\t</div> \t\t\t\t\t    \t\t</div> \t\t\t\t\t    \t</div>',
width:520,closeButton:true,onHide:function(){e.remove()}}),c=e.body.find("#sendTo"),f=c.attr("placeholder"),h=c.prev(),a=e.body.find("#sendContent"),k=b("#fileInfo"),i=typeof d.get("parentDir")!=="undefined",j=d.get("name"),n=i?"folder":getFileType(j);if(i||n==="unknow")i=getStrSize(j)>38?cutStr(j,38)+"...":j;else{i=j.substring(0,j.lastIndexOf("."));i=getStrSize(i)>38?cutStr(i,38)+"...":i+"."+j.substring(j.lastIndexOf(".")+1)}k.html('<span class="file-type '+n+'"></span><span class="file-name" title="'+
j+'">'+i+"</span>");var l=true;e.addButton({text:"\u53d1\u9001",onclick:function(){c.trigger("blur");var b=c.val(),f=a.val(),b=b.split(";");if(l){d.sendOutChain(b,f);e.remove()}else h.show()},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){e.remove()},className:"cancle"});c.on("blur",function(){l=true;if(c.val()===f||b.trim(c.val())==="")l=false;var d=c.val();a.val();d=d.split(";");_(d).each(function(a){a=b.trim(a);a!==""&&(mailReg.test(a)||(l=false))});l||h.show()}).on("focus",
function(){h.hide()});Sbox.placeholder(c);return e};Sbox.EditOutChain=function(b){Sbox.CreateOutChain(b)};Sbox.DeleteOutChain=function(b,d){Sbox.Warning({title:"\u53d6\u6d88\u5916\u94fe",message:'<p>\u60a8\u786e\u5b9a\u8981\u53d6\u6d88\u6240\u9009\u5916\u94fe\u5417\uff1f</p><p class="tip">\u53d6\u6d88\u540e\u5916\u94fe\u5730\u5740\u5c06\u5931\u6548\uff01</p>',closeButton:true,callback:function(c){c&&d.deleteOutchains(b)}})}})(jQuery);
(function(b){function d(b){var c=typeof b.get("parentDir")!=="undefined",b=b.get("name"),f=c?"folder":getFileType(b);previewFileType.test(f);if(c||f==="unknow")c=getStrSize(b)>38?cutStr(b,38)+"...":b;else{c=b.substring(0,b.lastIndexOf("."));c=getStrSize(c)>38?cutStr(c,38)+"...":c+"."+b.substring(b.lastIndexOf(".")+1)}return'<span class="file-type '+f+'"></span><span class="file-name" title="'+b+'">'+c+"</span>"}var g='<div class="outchain-dialog"> \t\t\t\t\t                <div id="fileInfo" class="file-info"> \t\t\t\t\t                    <span class="file-type folder"></span><span class="file-name" title="\u6211\u7684\u56fe\u7247">\u6211\u7684\u56fe\u7247</span> \t\t\t\t\t                </div> \t\t\t\t\t                <div class="field"> \t\t\t\t\t                    <div class="label">\u4e0a\u4f20\u5bc6\u7801\uff1a</div> \t\t\t\t\t                    <div class="ipt"> \t\t\t\t\t                        <div class="pass" id="passwords"> \t\t\t\t\t                            <p style="margin-top:0;">\u8f93\u5165\u5bc6\u7801\uff1a<input class="ipt-text" type="password" onpaste="return false;"><span class="tips"></span></p> \t\t\t\t\t                            <p>\u786e\u8ba4\u5bc6\u7801\uff1a<input class="ipt-text" type="password" onpaste="return false;"><span class="tips"></span></p> \t\t\t\t\t                        </div> \t\t\t\t\t                    </div> \t\t\t\t\t                </div> \t\t\t\t\t                <div class="field"> \t\t\t\t\t                    <div class="label">\u5931\u6548\u65f6\u95f4\uff1a</div> \t\t\t\t\t                    <div class="ipt "> \t\t\t\t\t                        <div class="datepicker"> \t\t\t\t\t                            <input class="ipt-text" type="text" readonly="readonly" id="datePicker" onclick="WdatePicker({minDate:\'%y-%M-{%d}\'});"> \t\t\t\t\t                            <span class="icon icon-date" onclick="WdatePicker({el:\'datePicker\',minDate:\'%y-%M-{%d}\'})"></span> \t\t\t\t\t                        </div>&nbsp; \t\t\t\t\t                        <select id="hours" style="width: 70px;"></select> \t\t\t\t\t                    </div> \t\t\t\t\t                    <div class="tips" id="dateTip"></div> \t\t\t\t\t                </div> \t\t\t\t\t            </div>';
Sbox.CreateUploadLink=function(e){function c(){var c=!e.get("uploadlink");f=new Sbox.Views.Window({title:c?"\u5f00\u542f\u533f\u540d\u4e0a\u4f20":"\u533f\u540d\u4e0a\u4f20\u8bbe\u7f6e",body:g,width:500,closeButton:true,onHide:function(){f.remove()}});var a=f.body,k=a.find("#fileInfo"),i=a.find("#passwords"),j=i.find("input").eq(0),n=i.find("input").eq(1),l=i.find(".tips").eq(0),o=i.find(".tips").eq(1),m=a.find("#datePicker"),p=a.find("#hours"),q=a.find("#dateTip");k.html(d(e));k="";for(i=0;i<24;i++)var r=
i<10?"0"+i:""+i,r=r+":00",k=k+('<option value="'+r+'">'+r+"</option>");p.html(k);c||l.empty().html('<span class="tip">\u4e0d\u4fee\u6539\u5bc6\u7801\u8bf7\u4fdd\u6301\u4e3a\u7a7a</span>');var k=new Date((new Date).valueOf()+6048E5),v=e.get("expiredate")||k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate()+" 00:00:00",v=v.indexOf(" ")>0?v.split(" "):[v,"00:00:00"];m.val(v[0]);setTimeout(function(){p.find('option[value="'+v[1].split(":")[0]+':00"]').attr("selected",true);Sbox.makeSelector(p)},50);
j.on("blur",function(){j.val().length>16?l.html('<span class="error">\u5bc6\u7801\u957f\u5ea6\u4e0d\u5f97\u8d85\u8fc716\u4f4d</span>'):l.empty();j.val()===n.val()&&o.empty()});n.on("blur",function(){j.val()!==n.val()?o.html('<span class="error">\u4e24\u6b21\u8f93\u5165\u5bc6\u7801\u4e0d\u4e00\u81f4</span>'):o.empty()});m.on("click",function(){q.empty()});f.addButton({text:"\u786e\u5b9a",onclick:function(){var d=true;a.find(".tips").empty();passVal=j.val();if(c&&passVal===""){l.empty().html('<span class="error">\u8bf7\u8f93\u5165\u5bc6\u7801</span>');
d=false}else if(passVal.length!==b.trim(passVal).length){l.empty().html('<span class="error">\u9996\u5c3e\u4e0d\u80fd\u542b\u6709\u7a7a\u683c</span>');d=false}else if(passVal.length>16){l.html('<span class="error">\u5bc6\u7801\u957f\u5ea6\u4e0d\u5f97\u8d85\u8fc716\u4f4d</span>');d=false}else if(passVal!==n.val()){o.html('<span class="error">\u4e24\u6b21\u8f93\u5165\u5bc6\u7801\u4e0d\u4e00\u81f4</span>');d=false}if(m.val()===""){q.html('<span class="error">\u8bf7\u9009\u62e9\u5931\u6548\u65f6\u95f4</span>');
d=false}else{var i=m.val(),k=p.val()+":00",k=i.split("-").concat(k.split(":"));if(new Date(k[0],k[1]-1,k[2],k[3],k[4],k[5])<new Date){q.html('<span class="error">\u5931\u6548\u65f6\u95f4\u5e94\u5927\u4e8e\u5f53\u524d\u65f6\u95f4</span>');d=false}}if(d){d=j.val();k=m.val()+" "+p.val()+":00";e.createUploadLink({password:d,time:k});f.remove()}},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){f.remove()},className:"cancle"})}var f=null;typeof WdatePicker==="undefined"?b.getScript(STATIC_DOMAIN+
"/js/libs/datepicker/WdatePicker.js",function(){c()}):c();return f};Sbox.ShowUploadLink=function(e){function c(){var a=new ZeroClipboard.Client;a.setText("");a.setHandCursor(true);b("#outchainCopy span").html(a.getHTML(24,26));a.addEventListener("mouseOver",function(){a.setText(h.val())});a.addEventListener("mouseDown",function(){jQuery.browser.msie&&setTimeout(function(){document.title=WEBSITE_NAME},50)});a.addEventListener("complete",function(){Sbox.Success("\u590d\u5236\u6210\u529f\uff01")});jQuery.browser.msie&&
setTimeout(function(){document.title=WEBSITE_NAME},50)}var f=new Sbox.Views.Window({title:"\u67e5\u770b\u533f\u540d\u4e0a\u4f20\u94fe\u63a5",body:'<div class="outchain-dialog"> \t\t\t\t\t\t\t\t<div id="fileInfo" class="file-info"></div> \t\t\t\t\t    \t\t<div class="field link"> \t\t\t\t\t    \t\t\t<div class="label">\u4e0a\u4f20\u94fe\u63a5\uff1a</div> \t\t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t\t    \t\t\t\t<input class="ipt-text" type="text" id="outchainIpt" value="" readonly="readonly" /> <span id="outchainCopy" class="copy">\u590d\u5236<span></span></span> | <a id="outchainCheck" href="#" target="_blank">\u67e5\u770b</a> \t\t\t\t\t    \t\t\t</div> \t\t\t\t\t    \t\t</div> \t\t\t\t\t    \t\t<div class="field link"> \t\t\t\t\t    \t\t\t<div class="label"></div> \t\t\t\t\t    \t\t\t<div class="ipt"> \t\t\t\t\t    \t\t\t\t<span class="tip">\u533f\u540d\u7528\u6237\u8bbf\u95ee\u4e0a\u4f20\u94fe\u63a5\u5373\u53ef\u4e0a\u4f20300M\u6587\u4ef6\u5230\u8be5\u6587\u4ef6\u5939\u4e0b</span> \t\t\t\t\t    \t\t\t</div> \t\t\t\t\t    \t\t</div> \t\t\t\t\t    \t</div>',
width:500,closeButton:true,onHide:function(){f.remove()},onRemove:function(){jQuery.browser.msie&&setTimeout(function(){document.title=WEBSITE_NAME},50)}});f.addButton({text:"\u5173\u95ed",onclick:function(){f.remove()}});var h=f.body.find("#outchainIpt");b("#fileInfo").html(d(e));h.val(e.get("uploadlink"));h.on("click",function(){b(this).select()});f.body.find("#outchainCheck").attr("href",e.get("uploadlink"));typeof ZeroClipboard==="undefined"?b.getScript(STATIC_DOMAIN+"/js/libs/zeroclipboard/ZeroClipboard.js",
function(){c()}):c();return f};Sbox.EditUploadLink=function(b){Sbox.CreateUploadLink(b)};Sbox.DeleteUploadLink=function(b,c){Sbox.Warning({title:"\u5173\u95ed\u533f\u540d\u4e0a\u4f20",message:'<p>\u60a8\u786e\u5b9a\u8981\u5173\u95ed\u8be5\u6587\u4ef6\u5939\u533f\u540d\u4e0a\u4f20\u5417\uff1f</p><p class="tip">\u5173\u95ed\u540e\u4e0a\u4f20\u94fe\u63a5\u5730\u5740\u5c06\u5931\u6548\uff01</p>',closeButton:true,callback:function(f){f&&c.deleteUploadLinks(b)}})}})(jQuery);
(function(){Sbox.Lock=function(b){b.get("lock")?b.unlock():b.lock()}})(jQuery);(function(b){Sbox.EditRemark=function(d){var d=b("#"+d.get("id")).find(".file-remark"),g=d.find("input");d.addClass("active");setTimeout(function(){g.focus();g.select()},20)}})(jQuery);
(function(b){Sbox.ReName=function(d){var g=b("#"+d.get("id")).find(".file-name"),e=g.find("input");g.addClass("active");setTimeout(function(){var b=d.get("name"),f=0,f=d.get("parentDir")||d.isNew()||getFileType(b)==="unknow"?b.length:b.lastIndexOf(".")>=0?b.lastIndexOf("."):b.length;if(e[0].createTextRange){b=e[0].createTextRange();b.moveStart("character",-1);b.moveStart("character",-1);b.collapse();b.moveStart("character",0);b.moveEnd("character",f);b.select()}else{e[0].setSelectionRange(0,f);e[0].focus()}},
20)}})(jQuery);
(function(b){var d=null,g={id:"root"};Sbox.Move=function(e,c,f,h,a){c=c||false;showPublic=h==="mine"||h==="restore"?false:true;if(d===null){var k=function(){var a=420;i.find(".treenode_bg").each(function(){var c=b(this),f=c.find("a"),c=parseInt(c.css("paddingLeft"))+18+f.width();c>a&&(a=c)});i.height()>i.parent().height()&&a==420&&(a=a-20);i.width(a)};d=new Sbox.Views.Window({title:a?"\u8fd8\u539f":c?"\u590d\u5236":"\u79fb\u52a8",body:'<div class="folds myfile cur"> \t\t\t\t\t<span class="fold '+(userPublicAcl===
3?"close":"open")+'"></span> \t\t\t\t\t<a href="javascript:;" hidefocus="true" data-id="root"><span class="ico-folder '+(userPublicAcl===3?"folder-close":"folder-open")+'"></span>\u6211\u7684\u6587\u4ef6</a> \t\t\t\t</div> \t\t\t\t<ul id="copyAndMoveTreeToMine" class="ztree" style="'+(userPublicAcl===3?"display:none;":"")+'"><li style="padding:20px;text-align:center;" class="tree-loading"><span class="icon icon-loading"></span></li></ul> \t\t\t\t<div class="folds publicfile" style="'+(userPublicAcl===
3?"":"display:none;")+'"> \t\t\t\t\t<span class="fold close"></span> \t\t\t\t\t<a href="javascript:;" hidefocus="true" data-id="public"><span class="ico-folder folder-close"></span>\u4f01\u4e1a\u5171\u4eab</a> \t\t\t\t</div> \t\t\t\t<ul id="copyAndMoveTreeToPublic" class="ztree" style="display:none;"><li style="padding:20px;text-align:center;" class="tree-loading"><span class="icon icon-loading"></span></li></ul> \t\t\t\t<div class="folds sharefile" style="display:none;"> \t\t\t\t\t<span class="fold close"></span> \t\t\t\t\t<a href="javascript:;"><span class="ico-folder folder-close"></span>\u6211\u6536\u5230\u7684\u5171\u4eab\u6587\u4ef6</a> \t\t\t\t</div> \t\t\t\t<ul style="display:none;" id="copyAndMoveTreeToShare" class="ztree" style=""><li style="padding:20px;text-align:center;"><span class="icon icon-loading"></span></li></ul>',
closeButton:true,height:355,width:440});var i=d.body.find("#copyAndMoveTreeToMine");d.body.find("#copyAndMoveTreeToShare");var j=d.body.find("#copyAndMoveTreeToPublic"),h={view:{autoCancelSelected:false,dblClickExpand:false,expandSpeed:"fast",nameIsHTML:true,selectedMulti:false,showIcon:true,showLine:false,showTitle:true},data:{keep:{leaf:false,parent:false}},async:{autoParam:["id"],dataFilter:function(a,b,c){var f=[];if(c.code===701||c.code===403){d.hide();Sbox.Login()}else _(c).each(function(a){var b=
{};b.id=a.id;b.name=a.name;b.isParent=a.hasSon||a.hsaSon?true:false;f.push(b)});return f},enable:true,type:"get",url:"/GetPublicNodeList!getAllnode.action?_t="+(new Date).valueOf()},callback:{onClick:function(a,b,c){d.body.find(".folds").removeClass("cur");c.zAsync?l.expandNode(c,true,true,true):l.reAsyncChildNodes(c,"refresh",false);g=c;n.cancelSelectedNode()},onAsyncSuccess:function(a,b,c){if(c&&c.children.length===0){c.isParent=false;l.updateNode(c)}k();j.find("li.tree-loading").remove()},onExpand:function(){k()}}},
n=b.fn.zTree.init(i,{view:{autoCancelSelected:false,dblClickExpand:false,expandSpeed:"fast",nameIsHTML:true,selectedMulti:false,showIcon:true,showLine:false,showTitle:true},data:{keep:{leaf:false,parent:false}},async:{autoParam:["id"],dataFilter:function(a,b,c){var f=[];if(c.code===701||c.code===403){d.hide();Sbox.Login()}else _(c).each(function(a){var b={};b.id=a.id;b.name=a.name;b.isParent=a.hasSon||a.hsaSon?true:false;f.push(b)});return f},enable:true,type:"get",url:"/GetService!getService.action?_t="+
(new Date).valueOf()},callback:{onClick:function(a,b,c){d.body.find(".folds").removeClass("cur");c.zAsync?n.expandNode(c,true,true,true):n.reAsyncChildNodes(c,"refresh",false);g=c;l.cancelSelectedNode()},onAsyncSuccess:function(a,b,c){if(c&&c.children.length===0){c.isParent=false;n.updateNode(c)}k();i.find("li.tree-loading").remove()},onExpand:function(){k()}}}),l=b.fn.zTree.init(j,h);d.addButton({text:"\u786e\u5b9a",className:"confirm"}).addButton({text:"\u53d6\u6d88",className:"cancle",onclick:function(){d.hide()}}).addStyle("dialog-tree");
d.body.find(".folds").on("click"," a",function(){if(!b(this).parent().hasClass("sharefile")){d.body.find(".folds").removeClass("cur");b(this).parent().addClass("cur");g={id:b(this).attr("data-id")};n.cancelSelectedNode();l.cancelSelectedNode()}}).on("click",".fold",function(){var a=b(this),c=a.parent(),f=c.find(".ico-folder"),c=c.next();a.hasClass("open")?c.slideUp(100,function(){f.removeClass("folder-open").addClass("folder-close");a.removeClass("open").addClass("close")}):c.slideDown(100,function(){f.removeClass("folder-close").addClass("folder-open");
a.removeClass("close").addClass("open")})});Sbox.addTree({type:"mine",tree:n});Sbox.addTree({type:"public",tree:l})}else{d.show();d.setTitle(a?"\u8fd8\u539f":c?"\u590d\u5236":"\u79fb\u52a8")}if(showPublic){d.body.find(".publicfile").show();d.body.find(".publicfile .fold").hasClass("close")?d.body.find("#copyAndMoveTreeToPublic").hide():d.body.find("#copyAndMoveTreeToPublic").show()}else d.body.find(".publicfile,#copyAndMoveTreeToPublic").hide();d.footer.off("click");d.footer.on("click",".confirm",
function(){parentId=e[0].get("belongDir")||e[0].get("parentDir");parentId=parentId==userId?"root":parentId;!a&&parentId==g.id?Sbox.Fail("\u60a8\u8981"+(c?"\u590d\u5236":"\u79fb\u52a8")+"\u7684\u6587\u4ef6\u5df2\u5b58\u5728\u76ee\u6807\u76ee\u5f55\u4e0b",2):f.moveFiles(e,c,g.id,a);d.hide()})}})(jQuery);
(function(b){var d;Sbox.Download=function(g){var e=[],c;d||(d=b('<form method="post" action="/GetFiles!getFiles.action" style="display:none;"><input type="hidden" name="ids" /><input type="hidden" name="firstName" /></form>').appendTo(b("body")));if(g.length===1&&!g[0].get("parentDir"))window.open("/GetFile!getFile.action?resourceId="+g[0].get("id")+"&length="+g[0].get("size"));else{c=g[0].get("name");_(g).each(function(b){e.push({resourceId:b.get("id"),flag:b.get("parentDir")?0:1})});d.find("input").eq(0).val(jsonToString(e));
d.find("input").eq(1).val(c);d.submit()}}})(jQuery);
(function(b){var d=[];Sbox.addTree=function(b){d.push(b)};Sbox.addNodeToTree=function(b,e,c,f){var h=[],b=b===userId?"root":b;_(e).each(function(a){var b={};if(a.get("email")){b.id="";b.uid=a.get("id");b.name=a.get("nickName");b.isParent=true;b.acl=1;h.push(b)}else if(a.get("parentDir")){b.uid="";b.id=a.get("id");b.name=a.get("name");b.isParent=a.get("hasSon")||a.get("hsaSon")?true:false;if(a.get("acl"))b.acl=a.get("acl");h.push(b)}});h.length!==0&&_(d).each(function(a){var d=a.type,e=a.tree;if(b===
"root"||b==="public")c==="mine"&&d==="mine"&&b==="root"||c==="public"&&d==="public"&&b==="public"?_(h).each(function(a){if(e.getNodeByParam("id",a.id,null)){if(f==="update"){var b=e.getNodeByParam("id",a.id,null);if(b.name!==a.name){b.name=a.name;e.updateNode(b)}}}else e.addNodes(null,[a])}):c==="share"&&d==="share"&&_(h).each(function(a){e.getNodeByParam("uid",a.uid,null)||e.addNodes(null,[a])});else{var j=e.getNodeByParam("id",b,null)||e.getNodeByParam("uid",b,null);if(j&&j.zAsync&&(!j.children||
!(j.children.length===0&&h.length===0))&&h.length!==0){j.isParent=true;e.updateNode(j);j.acl&&_(h).each(function(a){a.acl=a.acl||j.acl});_(h).each(function(a){if(e.getNodeByParam("id",a.id,null)){if(f==="update"){var b=e.getNodeByParam("id",a.id,null);if(b.name!==a.name){b.name=a.name;e.updateNode(b)}if(b.acl!==a.acl){b.acl=a.acl;e.updateNode(b)}}}else e.addNodes(j,[a])})}}})};Sbox.renameNodeToTree=function(b,e){_(d).each(function(c){var c=c.tree,f=c.getNodeByParam("id",b,null);if(f){f.name=e.get("name");
c.updateNode(f)}})};Sbox.deleteNodeToTree=function(b){_(d).each(function(d){var c=d.tree;_(b).each(function(b){b=c.getNodeByParam("id",b.get("id"),null);c.removeNode(b)})})};Sbox.reduceToTree=function(g){g.shift();_(d).each(function(d){function c(){var b=k.shift();if(b){var d=_(b).keys()[0],b=b[d],h=a.getNodeByParam("id",d,null)||a.getNodeByParam("uid",d,null);if(h){if(h.zAsync){f=h;c()}}else{if(f){f.isParent=true;a.updateNode(f)}a.addNodes(f,{id:d,name:b,isParent:true})}}}var f=null,h=d.type,a=d.tree,
k=_(g).clone();if(k.length!==0){var d=_(k[0]).keys()[0],i=!(a.getNodeByParam("id",d,null)||a.getNodeByParam("uid",d,null));(!i||i&&!b.isNumeric(d)&&(h==="mine"||h==="move"||h==="public"))&&c()}})}})(jQuery);
(function(b){Sbox.HTMLUpload=function(c){this.dirId=c.dirId||null;this.fileId=c.fileId||null;this.path=c.path;this.fileList=c.fileList;this.el=c.el||b("#"+c.id)||null;this.onuploadstart=c.onuploadstart||function(){};this.onprogress=c.onprogress||function(){};this.onuploaded=c.onuploaded||function(){};this.onerror=c.onerror||function(){};this.block=c.block||1048576;this.uploadNum=c.num||3;this.init()};Sbox.HTMLUpload.prototype={init:function(){var c=this,d=b('<input type="file" multiple size="1" />'),
a=b('<span class="u-btn"></span>');this.el.replaceWith(d);this.el=d;this.el.after(a);this.fr=new FileReader;this.queryFiles={};this.uploadQuery=[];this.isUploadingNum=0;var e=this.onerror;this.onerror=function(a,b){if(b){var d=c.uploadQuery[b],h=d.file;c.queryFiles[d.dirId+h.name+h.size]=false}e(a,b)};a.click(function(){c.el.trigger("click")});this.el.on("change",function(){if(this.value!==""){c.selectFile(this.files);this.value="";var a=b("<form>");c.el.before(a);c.el.appendTo(a);a[0].reset();a.after(c.el);
a.remove()}})},selectFile:function(b){var c=this,a=this.uploadQuery,d=this.queryFiles,e=this.path?this.path.get("pathId"):this.dirId;if(b.length<=100){_(b).each(function(b){var f=isPreviewImgFile(b.name,b.size)?b.size:c.block;if(!d[e+b.name+b.size]){var g=a.length;a[g]={file:b,dirId:e,block:f,status:"waiting"};c.onuploadstart(g,b.name,b.size);d[e+b.name+b.size]=true}});c.manageQuery()}else c.onerror("\u540c\u65f6\u4e0a\u4f20\u6587\u4ef6\u4e0d\u5f97\u8d85\u8fc7100\u4e2a")},update:function(b,c){this.path=
b;this.fileList=c},manageQuery:function(){for(var b=this.uploadQuery,c=0,a=b.length;c<a;c++)if(this.isUploadingNum<3){if(b[c]&&b[c].status==="waiting"){this.getUploadId(c);this.isUploadingNum++}}else break},getUploadId:function(c){var d=this,a=this.uploadQuery[c],e=a.file,i=a.dirId;a.status="uploading";b.post("/UploadInitialization!initialization.action",{Length:e.size,DirId:i,FileId:this.fileId,FileName:e.name,ModifyTime:e.lastModifiedDate||new Date,CreateTime:e.lastModifiedDate||new Date},function(b){var g=
b.split(":");if(b.indexOf('"code"')>0)Sbox.Login();else if(g[0]==="200"){a.uploadId=g[1];a.uniqueFileSign=g[2];a.start=g[3]*1;if(a.start===e.size)d.completeUpload(c);else if(!(a.status==="stopped"||a.status==="waiting"||a.status==="cancled")){d.onprogress(c,a.start,e.size);d.upload(c)}}else{if(g[0]==="501")d.onerror("\u7a7a\u95f4\u5927\u5c0f\u4e0d\u8db3",c);else if(g[0]==="503")d.onerror("\u8be5\u6587\u4ef6\u88ab\u9501\u5b9a",c);else if(g[0]==="505")d.onerror("\u6ca1\u6709\u6743\u9650",c);else if(g[0]===
"506")d.onerror("\u5b58\u5728\u540c\u540d\u6587\u4ef6",c);else if(g[0]==="701")Sbox.Login();else d.onerror("\u670d\u52a1\u5668\u9519\u8bef",c);a.status="fail";delete d.uploadQuery[c];delete d.queryFiles[i+e.name+e.size];d.isUploadingNum--;d.manageQuery()}},"text").error(function(){Sbox.Loading().remove();d.onerror("\u670d\u52a1\u5668\u9519\u8bef",c);a.status="fail";delete d.uploadQuery[c];delete d.queryFiles[i+e.name+e.size];d.isUploadingNum--;d.manageQuery()})},upload:function(c){var d=this;if(this.uploadQuery[c]){var a=
this.uploadQuery[c],e=a.dirId,i=a.file,g=a.start,n=a.block,l=i.size>g+n?g+n:i.size,o=i.size>g+n?n:i.size-g,n=g/n,m=new XMLHttpRequest,p;a.fr=a.fr||new FileReader;if(!(a.status==="stopped"||a.status==="waiting"&&a.status==="cancled"))if(o===0)d.completeUpload(c);else{a.status="uploading";i.mozSlice?p=i.mozSlice(g,l):i.webkitSlice?p=i.webkitSlice(g,l):i.slice?p=i.slice(g,l):Sbox.Error("\u4e0d\u652f\u6301HTML5\u65b9\u5f0f\u4e0a\u4f20");m.open("POST","/UploadRange!range.action",true);m.setRequestHeader("Content-Type",
"application/octet-stream");m.setRequestHeader("dirid",e);m.setRequestHeader("filename",encodeURIComponent(i.name));m.setRequestHeader("pos",g);m.setRequestHeader("totalsize",o);m.setRequestHeader("index",n);m.setRequestHeader("uploadid",a.uploadId);m.onreadystatechange=function(){if(m.readyState===4&&m.status===200)if(m.responseText.indexOf("701")>=0)Sbox.Login();else if(m.responseText===""){d.onerror("\u4e0a\u4f20\u9519\u8bef",c);a.status="fail";delete d.uploadQuery[c];delete d.queryFiles[e+i.name+
i.size];d.isUploadingNum--;d.manageQuery()}else{var g;try{g=b.parseJSON(m.responseText)}catch(j){g={code:-1}}m=null;a.isUploading=false;if(g.code===701||g.code===403)Sbox.Login();else if(g.code===200){if(a.status!=="stopped"&&a.status!=="waiting"&&a.status!=="cancled")d.onprogress(c,l,i.size);a.start=l;a.start===i.size?d.completeUpload(c):d.upload(c)}else{d.onerror("\u4e0a\u4f20\u9519\u8bef",c);a.status="fail";delete d.uploadQuery[c];delete d.queryFiles[e+i.name+i.size];d.isUploadingNum--;d.manageQuery()}}else if(m.readyState===
4&&m.status===500){d.onerror("\u4e0a\u4f20\u9519\u8bef",c);a.status="fail";delete d.uploadQuery[c];delete d.queryFiles[e+i.name+i.size];d.isUploadingNum--;d.manageQuery()}};a.isUploading=true;m.send(p)}}},completeUpload:function(c){var d=this,a=this.uploadQuery[c];if(a){var e=a.dirId,i=a.file;if(a.status!=="stopped"){a.isUploading=true;b.post("/UploadRange!complete.action",{uniqueFileSign:a.uniqueFileSign,filename:i.name,uploadId:a.uploadId,dirId:e},function(b){clearTimeout(a.ct);a.isUploading=false;
if(b.code===701||b.code===403)Sbox.Login();else if(b.code===200||b.code===201){a.status="complete";d.onuploaded(c,e,d.path,d.fileList)}else if(b.code===501){a.status="fail";d.onerror("\u7a7a\u95f4\u4e0d\u8db3",c)}else{a.status="fail";d.onerror("\u5b58\u50a8\u9519\u8bef",c)}delete d.uploadQuery[c];delete d.queryFiles[e+i.name+i.size];d.isUploadingNum--;d.manageQuery()},"json").error(function(){d.onerror("\u5b58\u50a8\u9519\u8bef",c);a.status="fail";delete d.uploadQuery[c];delete d.queryFiles[e+i.name+
i.size];d.isUploadingNum--;d.manageQuery()})}}},pauseUpload:function(c){var d=this.uploadQuery[c];clearTimeout(d.ct);d.uploadId&&b.post("/UploadRange!cancel.action",{uploadId:d.uploadId,uniqueFileSign:d.uniqueFileSign},function(){d.isCancling=false},"json").error(function(){d.isCancling=false});d.status==="uploading"&&this.isUploadingNum--;d.status="stopped";this.manageQuery()},startUpload:function(b){var c=this,a=this.uploadQuery[b];if(a.isUploading||a.isCancling)a.ct=setTimeout(function(){c.startUpload(b)},
50);else{a.status="waiting";this.manageQuery()}},cancle:function(c){var d=this,a=this.uploadQuery[c],e=a.dirId,i=a.file;clearTimeout(a.ct);if(!a.isCancling&&a.uploadId){a.isCancling=true;b.post("/UploadRange!cancel.action",{uploadId:a.uploadId,uniqueFileSign:a.uniqueFileSign},function(){a.isCancling=false},"json").error(function(){a.isCancling=false})}a.status==="uploading"&&this.isUploadingNum--;a.status="cancled";delete this.uploadQuery[c];delete this.queryFiles[e+i.name+i.size];setTimeout(function(){d.manageQuery()},
50)}};var d=null,g=null,e=null,c='<div class="upload-dialog2" id="uploadContainer"> \t\t\t\t\t<div class="opts"><div id="uploadBtn" class="upload-btn"></div></div> \t\t\t\t\t<div class="upload-head"> \t                    <ul> \t                        <li class="name">\u6587\u4ef6\u540d</li> \t                        <li class="percent">\u8fdb\u5ea6</li> \t                        <li class="size">\u5927\u5c0f</li> \t                        <li class="op">\u64cd\u4f5c</li> \t                    </ul> \t                </div> \t                <div class="upload-body" id="uploadBody"> \t\t    \t        <div class="upload-tip"> \t\t\t                '+
(supportHtml5?"<p>\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u65e0\u9650\u5236\uff0c\u652f\u6301\u6587\u4ef6\u62d6\u62fd\u4e0a\u4f20</p><p>\u6309\u4f4fShift\u6216Ctrl\u952e\u53ef\u4ee5\u9009\u62e9\u591a\u4e2a\u6587\u4ef6\uff0c\u4e00\u6b21\u6700\u591a\u9009\u62e9100\u4e2a</p>":"<p>\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u9650\u5236300 MB\uff0c\u5efa\u8bae\u4f7f\u7528\u652f\u6301HTML5\u4e0a\u4f20\u5927\u5c0f\u65e0\u9650\u5236\u7684\u6d4f\u89c8\u5668\uff0c\u5982\uff1a\u6700\u65b0\u7248\u7684Chrome\u3001Firefox\u3001\u641c\u72d7\u6d4f\u89c8\u5668(\u9ad8\u901f\u6a21\u5f0f)\u7b49</p>")+
" \t\t    \t        </div> \t    \t        </div>     \t\t\t</div>";Sbox.Upload=function(f,h,a,k){function i(){if(jQuery.browser.msie)document.title=WEBSITE_NAME}function j(){if(supportHtml5){if(y.length===0){d.remove();return}}else if(e){if(e.getStats().files_queued===0){e.destroy();setTimeout(function(){d.remove()},30);return}}else{setTimeout(function(){d.remove()},30);return}Sbox.Warning({message:"<p>\u60a8\u786e\u5b9a\u8981\u53d6\u6d88\u6b63\u5728\u4e0a\u4f20\u7684\u6587\u4ef6\u5417\uff1f</p>",
callback:function(a){if(a){supportHtml5?_(y).each(function(a){e.cancle(a)}):e.destroy();window.onbeforeunload=null;setTimeout(function(){d.remove()},30)}}})}function n(a,c,f){if(!u.find("dl")[0]){u.find(".upload-tip").hide();u.append("<dl>")}d.getButton("\u5b8c\u6210")[0]&&d.getButton("\u5b8c\u6210")[0].text("\u53d6\u6d88");var h=u.find("dl");y.push(a);var i='<dd id="upload_'+a+'"> \t\t\t\t\t\t<div class="progress"></div>                         <ul>                             <li class="name" title="'+
c+'">'+c+'</li>                             <li class="percent"><span class="waiting">\u7b49\u5f85\u4e0a\u4f20</span></li>                             <li class="size">'+formatbytes(f)+'</li>                             <li class="oprator">                                     <a class="stop" href="javascript:;"><span class="icon icon-stop2"> </span></a>&nbsp;<a class="cancle" href="javascript:;"><span class="icon icon-cancle2"> </span></a>                             </li>                         </ul>                     </dd>',
i=b(i);isPreviewImgFile(c,f)&&i.find(".stop").css("opacity",0.3).addClass("disabled");h.append(i);w[a]={status:"uploading"};i.on("click",".stop",function(c){var d=b(c.currentTarget);if(!d.hasClass("disabled")){e.pauseUpload(a);i.find(".percent").empty().html('<span class="stopped">\u6682\u505c\u4e0a\u4f20</span>');d.attr("class","start");d.html('<span class="icon icon-start2"></span>').css("opacity",0.3).addClass("disabled");setTimeout(function(){d.css("opacity","").removeClass("disabled")},1E3);
clearInterval(w[a].st);w[a].status="stopped"}}).on("click",".start",function(c){c=b(c.currentTarget);if(!c.hasClass("disabled")){e.startUpload(a);i.find(".percent").empty().html('<span class="waiting">\u7b49\u5f85\u4e0a\u4f20</span>');c.attr("class","stop");c.html('<span class="icon icon-stop2"></span>');w[a].status="uploading"}}).on("click",".cancle",function(){e.cancle(a);i.find(".percent").empty().html('<span class="fail">\u53d6\u6d88\u4e0a\u4f20</span>');i.find(".progress").remove();i.find(".oprator").empty();
clearInterval(w[a].st);w[a].status="cancled";m(a);q()});jQuery.browser.msie&&setTimeout(function(){document.title=WEBSITE_NAME},50);window.onbeforeunload=function(){return"\u60a8\u6709\u6587\u4ef6\u6b63\u5728\u4e0a\u4f20\uff0c\u7ee7\u7eed\u64cd\u4f5c\u4f1a\u4e2d\u65ad\u4e0a\u4f20\uff0c\u8981\u7ee7\u7eed\u5417\uff1f"}}function l(a,c,d){c>d&&(c=d);var f=b("#upload_"+a),e=f.find(".progress"),h=f.find(".percent"),i=f.find(".name").attr("title"),g=f.data("date"),k=f.data("size"),n=131072,i=isPreviewImgFile(i,
d)?d:1048576,j=(new Date).valueOf();if(k||k===0){n=parseInt((c-k)/(j-g)*1E5)/100;i=c-k}i=Math.min(i,d-c);f.data("date",j).data("size",c);clearInterval(w[a].st);if(!h.find(".stopped,.fail")[0]){if(f.data("progress"))h.text(f.data("progress"));else{g=parseInt(c/d*1E4)/100+"%";e.css("width",g);h.text(g);f.data("progress",g)}if(c>=d){f.find(".percent").empty().html('<span class="saving">99.99%</span>');e.animate({width:"100%"},300)}else if(w[a].status==="uploading"){var l=b("#upload_"+a),m=l.find(".progress"),
o=l.find(".percent");i>d&&(i=d);var p=0,r=o.text().replace("%","")*1,t=parseInt((c+i)/d*1E4)/100,u=1/Math.ceil(i/n*10)*(t-r),s=r;w[a].st=setInterval(function(){p++;s=parseInt((r+u*p)*100)/100;if(s<t){m.css("width",s+"%");o.text(s+"%");l.data("progress",s+"%");q()}else clearInterval(w[a].st)},100)}}}function o(a,c,d,f){var e=b("#upload_"+a);e.find(".percent").empty().html('<span class="success">\u4e0a\u4f20\u6210\u529f</span>');e.find(".progress").remove();e.find(".oprator").empty();m(a);c==userId&&
(c="root");f&&c===d.get("pathId")&&f.trigger("reload");Sbox.RefreshUsage();q()}function m(a){u.find("dl");var c=b("#upload_"+a);u.find(".upload-tip");c.removeAttr("id");y.splice(_(y).indexOf(a),1);if(y.length===0){window.onbeforeunload=null;setTimeout(function(){d.getButton("\u53d6\u6d88")[0]&&d.getButton("\u53d6\u6d88")[0].text("\u5b8c\u6210")},30)}}function p(a,c){if(c||c===0){a.length>6&&(a="\u4e0a\u4f20\u9519\u8bef");var d=b("#upload_"+c);d.find(".percent").empty().html('<span class="fail">'+
a+"</span>");d.find(".progress").remove();d.find(".oprator").empty();m(c)}else Sbox.Error(a);w[c]&&w[c].st&&clearInterval(w[c].st)}function q(){if(g){var a=u.find("dd"),c=0,d=0;_(a).each(function(a){var f=b(a).find(".percent");if(!f.find(".fail,.cancled")[0])if(f.find(".success,.saving")[0]){c++;d=d+100}else if(f.find(".waiting")[0])c++;else{a=b(a).data("progress")?b(a).data("progress").replace("%","")*1:0;c++;d=d+a}});a=c===0?"":parseInt(d/c*100)/100+"%";g.find(".per").text(a);g.find(".cur").css("width",
a);a==="100%"?g.find(".um-hd").text("\u4e0a\u4f20\u5b8c\u6210"):g.find(".um-hd").text("\u6587\u4ef6\u4e0a\u4f20\u4e2d")}}function r(a,c){var d=b("#upload_"+a.id);d.find(".percent").empty().html('<span class="fail">'+c+"</span>");d.find(".progress").remove();d.find(".oprator").empty();d.removeAttr("id")}var v={flash_url:"/assets/swf/swfu-v2.swf",upload_url:"/UploadRange!upload.action",post_params:{},file_size_limit:"300 MB",file_types:"*.*",file_types_description:"All Files",file_upload_limit:100,
file_queue_limit:0,custom_settings:{},debug:false,button_image_url:STATIC_DOMAIN+"/img/upload-v2.png",button_width:"97",button_height:"31",button_placeholder_id:"uploadHandler",button_cursor:-2,button_window_mode:"transparent",swfupload_loaded_handler:function(){i();t.find("#uploadBtn").css({position:"",left:0,top:0})},file_dialog_start_handler:i,file_queued_handler:function(a){var c=this;a.name=decodeURIComponent(a.name);this.addFileParam(a.id,"dirId",e.getSetting("path").get("pathId"));this.addFileParam(a.id,
"length",a.size);if(!u.find("dl")[0]){u.find(".upload-tip").hide();u.append("<dl>")}d.getButton("\u5b8c\u6210")[0]&&d.getButton("\u5b8c\u6210")[0].text("\u53d6\u6d88");var f=u.find("dl"),h='<dd id="upload_'+a.id+'"> \t\t\t\t\t\t<div class="progress"></div> \t\t\t\t\t\t<ul> \t\t\t\t\t\t\t<li class="name" title="'+a.name+'">'+a.name+'</li> \t\t\t\t\t\t\t<li class="percent"><span class="waiting">\u7b49\u5f85\u4e0a\u4f20</span></li> \t\t\t\t\t\t\t<li class="size">'+formatbytes(a.size)+'</li> \t\t\t\t\t\t\t<li class="oprator"> \t\t\t\t\t\t\t\t<a class="cancle" href="javascript:;" title="\u53d6\u6d88"><span class="icon icon-cancle2"> </span></a>&nbsp; \t\t\t\t\t\t\t</li> \t\t\t\t\t\t</ul> \t\t\t\t\t</dd>',
h=b(h);f.append(h);var i=h.find(".progress"),g=h.find(".percent"),k=h.find(".oprator");h.on("click",".cancle",function(){c.cancelUpload(a.id);i.remove();k.empty();g.html('<span class="cancled">\u53d6\u6d88\u4e0a\u4f20</span>');q()});window.onbeforeunload=function(){return"\u60a8\u6709\u6587\u4ef6\u6b63\u5728\u4e0a\u4f20\uff0c\u7ee7\u7eed\u64cd\u4f5c\u4f1a\u4e2d\u65ad\u4e0a\u4f20\uff0c\u8981\u7ee7\u7eed\u5417\uff1f"}},file_queue_error_handler:function(a,c){if(c===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED)Sbox.Error("\u540c\u65f6\u4e0a\u4f20\u6587\u4ef6\u4e0d\u5f97\u8d85\u8fc7100\u4e2a");
else{this.addFileParam(a.id,"dirId",f);if(!u.find("dl")[0]){u.find(".upload-tip").hide();u.append("<dl>")}if(typeof a.size==="undefined"){c=SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT;size="\u672a\u77e5\u5927\u5c0f"}else size=formatbytes(a.size);d.getButton("\u5b8c\u6210")[0]&&d.getButton("\u5b8c\u6210")[0].text("\u53d6\u6d88");var e=u.find("dl"),h='<dd id="upload_'+a.id+'"> \t\t\t\t\t\t<div class="progress"></div> \t\t\t\t\t\t<ul> \t\t\t\t\t\t\t<li class="name" title="'+a.name+'">'+a.name+'</li> \t\t\t\t\t\t\t<li class="percent"><span class="waiting">\u7b49\u5f85\u4e0a\u4f20</span></li> \t\t\t\t\t\t\t<li class="size">'+
size+'</li> \t\t\t\t\t\t\t<li class="oprator"> \t\t\t\t\t\t\t\t<a class="cancle" href="javascript:;" title="\u53d6\u6d88"><span class="icon icon-cancle2"> </span></a>&nbsp; \t\t\t\t\t\t\t</li> \t\t\t\t\t\t</ul> \t\t\t\t\t</dd>',h=b(h);e.append(h);h.find(".percent");h.find(".oprator").empty();switch(c){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:r(a,"\u8d85\u8fc7\u5927\u5c0f\u9650\u5236");break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:r(a,"\u6587\u4ef6\u4e3a\u7a7a");break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:r(a,
"\u6587\u4ef6\u7c7b\u578b\u9519\u8bef");break;default:a!==null&&r(a,"\u672a\u77e5\u9519\u8bef")}}},file_dialog_complete_handler:function(){this.startUpload();i()},upload_start_handler:function(){},upload_progress_handler:function(a,c,d){var c=Math.ceil(c/d*1E4)/100,a=b("#upload_"+a.id),d=a.find(".progress"),f=a.find(".percent"),e=a.find(".oprator");d.css("width",c+"%");a.data("progress",c+"%");if(c===100){f.html('<span class="saving"><span class="icon icon-loading"></span>\u6b63\u5728\u5b58\u50a8</span>');
e.empty()}else f.html(c+"%");q()},upload_error_handler:function(a,c,d){console.log(c);var f=b("#upload_"+a.id);f.find(".progress");f.find(".percent");switch(c){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:r(a,'\u4e0a\u4f20\u9519\u8bef<em style="color:white">'+SWFUpload.UPLOAD_ERROR.HTTP_ERROR+"</em>");this.debug("Error Code: HTTP Error, File name: "+a.name+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:r(a,"\u4e0a\u4f20\u5931\u8d25");this.debug("Error Code: Upload Failed, File name: "+
a.name+", File size: "+a.size+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:r(a,"\u670d\u52a1\u5668\u9519\u8bef");this.debug("Error Code: IO Error, File name: "+a.name+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:r(a,'\u4e0a\u4f20\u9519\u8bef<em style="color:white">'+SWFUpload.UPLOAD_ERROR.SECURITY_ERROR+"</em>");this.debug("Error Code: Security Error, File name: "+a.name+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:r(a,"\u7a7a\u95f4\u4e0d\u8db3");
this.debug("Error Code: Upload Limit Exceeded, File name: "+a.name+", File size: "+a.size+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:r(a,'\u4e0a\u4f20\u9519\u8bef<em style="color:white">'+SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED+"</em>");this.debug("Error Code: File Validation Failed, File name: "+a.name+", File size: "+a.size+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:r(a,"\u53d6\u6d88\u4e0a\u4f20");break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:r(a,
'\u4e0a\u4f20\u9519\u8bef<em style="color:white">'+SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED+"</em>");break;default:r(a,"\u4e0a\u4f20\u9519\u8bef");this.debug("Error Code: "+c+", File name: "+a.name+", File size: "+a.size+", Message: "+d)}},upload_success_handler:function(a,c){var d=b("#upload_"+a.id),f=d.find(".progress"),h=d.find(".percent"),d=d.find(".oprator");f.remove();d.empty();if(c.indexOf("701:")>=0)Sbox.Login();else{c=jQuery.parseJSON(c);if(c.code===200){h.html('<span class="success">\u4e0a\u4f20\u6210\u529f</span>');
e.getSetting("fileList")&&a.post.dirId===e.getSetting("path").get("pathId")&&e.getSetting("fileList").trigger("reload")}else c.code===501?h.html('<span class="fail">\u7a7a\u95f4\u5927\u5c0f\u4e0d\u8db3</span>'):c.code===503?h.html('<span class="fail">\u8be5\u6587\u4ef6\u88ab\u9501\u5b9a</span>'):c.code===505?h.html('<span class="fail">\u6ca1\u6709\u6743\u9650</span>'):c.code===506?h.html('<span class="fail">\u5b58\u5728\u540c\u540d\u6587\u4ef6</span>'):h.html('<span class="fail">\u4e0a\u4f20\u5931\u8d25</span>')}Sbox.RefreshUsage()},
upload_complete_handler:function(){if(this.getStats().files_queued===0){window.onbeforeunload=null;d.getButton("\u53d6\u6d88")[0]&&d.getButton("\u53d6\u6d88")[0].text("\u5b8c\u6210")}},queue_complete_handler:function(){if(this.getStats().files_queued===0){window.onbeforeunload=null;d.getButton("\u53d6\u6d88")[0]&&d.getButton("\u53d6\u6d88")[0].text("\u5b8c\u6210")}}},y=[],t=null,u=null,w={};if(typeof f!=="string")var s=f,f=s.get("pathId");if(d){d.show();g.hide();if(supportHtml5){e.update(s,a);k&&
e.selectFile(k)}else if(e){e.addSetting("path",s);e.addSetting("fileList",a)}}else{d=(new Sbox.Views.Window({title:"\u4e0a\u4f20\u6587\u4ef6",body:c,width:700,minimize:true,closeButton:true,esc:false,onShow:function(){},onClose:function(){j()},onMinimize:function(){d.moveTo(-9999,-9999);d.overlay.remove();g.show()},onRemove:function(){g.remove();g=e=d=null;i()}})).addStyle("dialog-upload");d.addButton({text:"\u53d6\u6d88",onclick:function(){j()}});t=d.body.find("#uploadContainer");u=t.find("#uploadBody");
t.find("#uploadBtn").html('<div id="uploadHandler">\u6dfb\u52a0\u6587\u4ef6</div>');if(supportHtml5){e=new Sbox.HTMLUpload({dirId:h==="upload"?f:null,fileId:h==="upgrade"?f:null,path:s,fileList:a,id:"uploadHandler",onuploadstart:n,onprogress:l,onuploaded:o,onerror:p});k&&e.selectFile(k);try{u[0].addEventListener("dragleave",function(a){a.preventDefault();a.stopPropagation()});u[0].addEventListener("dragenter",function(a){a.preventDefault();a.stopPropagation()});u[0].addEventListener("dragover",function(a){a.stopPropagation();
a.preventDefault()});u[0].addEventListener("drop",function(a){a.preventDefault();a.stopPropagation();e.selectFile(a.dataTransfer.files)})}catch(z){}}else if(checkFlash()){t.find("#uploadBtn").css({position:"relative",left:-9999,top:-9999});if(typeof SWFUpload==="undefined")b.getScript(STATIC_DOMAIN+"/js/libs/swfupload.js",function(){e=new SWFUpload(v);e.addSetting("path",s);e.addSetting("fileList",a)});else{e=new SWFUpload(v);e.addSetting("path",s);e.addSetting("fileList",a)}}else t.find("#uploadBtn").html('<span style="color:#E65455;">\u4e0a\u4f20\u9700\u8981flash\u652f\u6301\uff0c\u8bf7\u4e0b\u8f7d\u5b89\u88c5\u540e\u91cd\u8bd5\uff0c<a target="_blank" href="http://get.adobe.com/cn/flashplayer/">\u4e0b\u8f7d\u5730\u5740</a></span>');
g=b('<div class="upload-minimize"> \t\t\t    \t    <div class="um-hd">\u6587\u4ef6\u4e0a\u4f20\u4e2d</div> \t\t\t    \t    <div class="um-act"> \t\t\t    \t        <a href="javascript:;" class="maxmize"><span class="icon icon-maxmize"></span></a> \t\t\t    \t        <a href="javascript:;" class="close"><span class="icon icon-close"></span></a> \t\t\t    \t    </div> \t\t\t    \t    <div class="um-bd"> \t\t\t    \t        <div class="um-progress"> \t\t\t    \t        \t<div class="per"></div> \t\t\t    \t            <div class="cur"></div> \t\t\t    \t        </div> \t\t\t    \t    </div> \t\t\t    \t</div>').appendTo(b("body")).hide();
g.on("click",".maxmize",function(){b("#main").find(".my-file:visible .main-op .upload,.share-file:visible .main-op .upload,.public-file:visible .main-op .upload").trigger("click")}).on("click",".close",function(){j()})}}})(jQuery);(function(){Sbox.Restore=function(b,d){Sbox.Move(b,false,d,"restore",true)}})(jQuery);
(function(){Sbox.CompleteDelete=function(b,d){Sbox.Warning({title:"\u5f7b\u5e95\u5220\u9664",message:'<p>\u60a8\u786e\u5b9a\u8981\u5f7b\u5e95\u5220\u9664\u6240\u9009\u6587\u4ef6\u5417\uff1f </p><p class="tip">\u6587\u4ef6\u5220\u9664\u540e\u5c06\u65e0\u6cd5\u627e\u56de\uff01</p>',callback:function(g){g&&d.completeDelete(b)}})}})(jQuery);
(function(b){window.userPublicAcl=null;Sbox.RefreshUsage=function(){if(b("#sidebar .usage")[0]){var d=b("#sidebar .usage"),g=d.find(".cur"),e=d.find(".used"),c=d.find(".total");b.get("/User!getSpace.action?_t="+Math.random(),function(b){if(b.code===200){g.css("width",Math.max(b.userUsedSpace/b.allSpace*100,1)+"%");e.text(formatbytes(b.userUsedSpace));c.text(formatbytes(b.allSpace));window.userPublicAcl=b.acl}},"json")}}})(jQuery);
(function(b){Sbox.getMsgInfo=function(){var d=b("#msgTip"),g=d.find(".msg-num");b.get("/MessageAction!count.action?_t="+Math.random(),function(b){if(b.code===200&&b.count>0){g.html("<em>"+b.count+"</em>").show();d.find("a").attr("href","/message/"+(b.sCount?0:1))}},"json")};jQuery(function(){if(document.getElementById("msgTip")){Sbox.getMsgInfo();setInterval(function(){Sbox.getMsgInfo()},3E4)}})})(jQuery);
(function(){Sbox.Login=function(){Sbox.Error({message:"\u767b\u5f55\u8d85\u65f6,\u8bf7\u91cd\u65b0\u767b\u5f55\u3002",onHide:function(){location.href="/login"}})}})(jQuery);(function(b){if(b.browser.msie){b('a[href="javascript:;"]').click(function(b){b.preventDefault()});b(document).on("click",'a[href="javascript:;"]',function(b){b.preventDefault()})}})(jQuery);
(function(b){function d(){b(window).width()<1E3?b("body").width(1E3):b("html,body").width("100%")}b(window).bind("resize",function(){d()});jQuery(function(){d()})})(jQuery);
(function(b){Sbox.Guide=function(d){function g(){h.hide();h.eq(l).show();f.find(".cur").removeClass("cur");k.eq(l).addClass("cur")}var e=(new Sbox.Views.Window({body:'<div class="guide-dialog"> \t\t\t<ul class="guide-detail" id="guideDetail"> \t\t\t\t<li><img src="'+STATIC_DOMAIN+'/img/guide/step1_v2.jpg" /></li> \t\t\t\t<li style="display:none;"><img src="'+STATIC_DOMAIN+'/img/guide/step2_v2.jpg" /></li> \t\t\t\t<li style="display:none;"><img src="'+STATIC_DOMAIN+'/img/guide/step3_v2.jpg" /></li> \t\t\t\t<li style="display:none;"><img src="'+
STATIC_DOMAIN+'/img/guide/step4_v2.jpg" /></li> \t\t\t\t'+(d?'<li style="display:none;"><img src="'+STATIC_DOMAIN+'/img/guide/step5_v2.jpg" /></li>':"")+'\t\t\t</ul> \t\t\t<div class="guide-page" id="guidePage"> \t\t\t\t<span class="cur"></span> \t\t\t\t<span></span> \t\t\t\t<span></span> \t\t\t\t<span></span> \t\t\t\t'+(d?"<span></span>":"")+' \t\t\t</div> \t\t\t<div class="guide-control" id="guideControl"> \t\t\t\t<a href="javascript:;" class="prev-guide btn btn24 btn24-gray" style="display:none;">\u4e0a\u4e00\u9875</a> \t\t\t\t<a href="javascript:;" class="next-guide btn btn24 btn24-gray">\u4e0b\u4e00\u9875</a> \t\t\t\t<a href="javascript:;" class="quite-guide">\u8df3\u8fc7</a> \t\t\t</div> \t\t</div>',
width:657,esc:false})).header.hide().footer.hide().addStyle("dialog-guide"),c=e.body,d=c.find("#guideDetail"),f=c.find("#guidePage"),c=c.find("#guideControl"),h=d.find("li"),a=h.length,k=f.find("span"),i=c.find(".prev-guide"),j=c.find(".next-guide"),n=c.find(".quite-guide"),l=0;c.on("click",".prev-guide",function(){l--;l===0&&i.hide();j.text("\u4e0b\u4e00\u9875");n.show();g()}).on("click",".next-guide",function(){if(l===a-1){b.get("/User!updateGuideStatus.action?_t="+Math.random(),{guideStatus:1});
e.remove()}else{l++;if(l===a-1){j.text("\u5b8c\u6210");n.hide()}}i.show();g()}).on("click",".quite-guide",function(){b.get("/User!updateGuideStatus.action?_t="+Math.random(),{guideStatus:1});e.remove()});return e}})(jQuery);
(function(b){Sbox.Notice=function(){function d(){setTimeout(function(){f--;c.text(f);f<=0?g.remove():d()},1E3)}if(!b.cookie("notice")){var g=(new Sbox.Views.Window({title:"\u901a\u77e5",body:'<div class="notice-content"> \t\t\t\t\t\t\t<p class="tips">\u641c\u72d0\u4f01\u4e1a\u7f51\u76d8\u5c06\u4e8e <span class="time">2014\u5e741\u670818\u65e5 18:00</span> \u81f3 <span class="time">19\u65e5 0:00</span> \u8fdb\u884c<span class="thing">\u7cfb\u7edf\u5347\u7ea7</span>\uff0c</br>\u671f\u95f4\u5c06\u4e0d\u80fd\u8bbf\u95ee\u7f51\u76d8\u7684\u6240\u6709\u670d\u52a1\uff0c\u4e0d\u4fbf\u4e4b\u5904\u656c\u8bf7\u8c05\u89e3</p> \t\t\t\t\t\t\t<p class="cd"><span>10</span>\u79d2\u5185\u81ea\u52a8\u5173\u95ed......</p> \t\t\t\t\t\t\t<p class="action"><button class="btn btn32 btn32-green">\u4e0d\u518d\u63d0\u793a</button></p> \t\t\t\t\t\t</div>',width:660,
esc:false,closeButton:true})).footer.hide().addStyle("dialog-notice"),e=g.body,c=e.find(".cd span"),e=e.find(".action button"),f=c.text()*1;d();e.on("click",function(){b.cookie("notice",1);g.remove()});return g}}})(jQuery);
(function(b){var d;Sbox.Views.ImgPreview=d=function(c){this.imgs=c.imgs||[];this.index=c.index||0;this.downloadable=typeof c.downloadable==="undefined"?true:c.downloadable;this.load=false;this.currentRnd=0;this._winWidth=b(window).width();this._winHeight=b(window).height();this._spaceHeight=36;this.thumbCache={};this.init()};d.URL=PREVIEW_URL;d.DOWNLOAD_URL="/GetFile!getFile.action";d.PREVIEW_SIZE="w800";d.THUMB_SIZE="s80";d.DEFAULT_IMG=STATIC_DOMAIN+"/img/filetype/preview/p-picture.png";d.ERROR_IMG=
STATIC_DOMAIN+"/img/img-error.png";d.THUMB_WIDTH=104;d.KEY={LEFT:37,RIGHT:39,ESC:27};var g=document.createElement("div");style=g.style;cssArr=["transform","MozTransform","webkitTransform","OTransform","msTramsform"];len=cssArr.length;for(var e=0;e<len;e++)if(cssArr[e]in style){d.SUPPORT=cssArr[e];break}if("filters"in g)d.SUPPORT="filter";d.resize=function(c,b,d,a,e){c.stop();if(b/d>a/e){b=Math.min(d,e);d=b*(a/e);c.animate({height:b,width:d})}else{d=Math.min(b,a);b=d*(e/a);c.animate({width:d,height:b})}c.data("cursize",
d+"|"+b)};d.getRealSize=function(c,f){var e=new Image,a=b('<div style="visibility:hidden; position:absolute; left:-9999em; top:-9999em;"></div>').appendTo(b("body")).append(e);e.onload=function(){f({key:c,width:a.width(),height:a.height()},true);a.remove()};e.onerror=function(){f({key:c,width:194,height:175},false)};e.src=d.URL+c+"_"+d.PREVIEW_SIZE};d.getMatrix=function(c,b,d){var a=Math.cos(c),c=Math.sin(c),d=d||1;return{m11:a*(b||1),m12:-c*d,m21:c*b,m22:a*d}};b.extend(d.prototype,{init:function(){this._buildDOM();
this.buildThumbs(this.index);this.initEvent();this.show()},_buildDOM:function(){var c=this.el=b('<div class="preview-container"> \t\t\t\t\t        <div class="preview-close"> \t\t\t\t\t            <a href="javascript:;" title="\u5173\u95ed" hidefocus="true"><span>\u5173\u95ed</span></a> \t\t\t\t\t        </div> \t\t\t\t\t        <div class="preview-panel"> \t\t\t\t\t            <div class="preview-control"> \t\t\t\t\t                <a href="javascript:;" class="rotate-left " title="\u5411\u5de6\u65cb\u8f6c" hidefocus="true"><span>\u5411\u5de6\u65cb\u8f6c</span></a> \t\t\t\t\t                <a href="javascript:;" class="rotate-right" title="\u5411\u53f3\u65cb\u8f6c" hidefocus="true"><span>\u5411\u53f3\u65cb\u8f6c</span></a> \t\t\t\t\t                <a href="javascript:;" class="original-img" target="_blank" title="\u67e5\u770b\u539f\u56fe" hidefocus="true"><span>\u67e5\u770b\u539f\u56fe</span></a> \t\t\t\t\t                <a href="javascript:;" class="download-img" title="\u4e0b\u8f7d\u56fe\u7247" hidefocus="true"><span>\u4e0b\u8f7d\u56fe\u7247</span></a> \t\t\t\t\t            </div> \t\t\t\t\t        </div> \t\t\t\t\t        <div class="preview-content"> \t\t\t\t\t            <div class="preview-prev"> \t\t\t\t\t                <a href="javascript:;" hidefocus="true" title="\u4e0a\u4e00\u5f20"><span>\u4e0a\u4e00\u5f20</span></a> \t\t\t\t\t            </div> \t\t\t\t\t            <div class="preview-next"> \t\t\t\t\t                <a href="javascript:;" hidefocus="true" title="\u4e0b\u4e00\u5f20"><span>\u4e0b\u4e00\u5f20</span></a> \t\t\t\t\t            </div> \t\t\t\t\t            <div class="preview-photo"> \t\t\t\t\t                <table> \t\t\t\t\t                    <tr> \t\t\t\t\t                        <td valign="middle"> \t\t\t\t\t                        \t<img style="width:68px;height:68px;" src="'+
d.DEFAULT_IMG+'" /> \t\t\t\t\t                        </td> \t\t\t\t\t                    </tr> \t\t\t\t\t                </table> \t\t\t\t\t            </div> \t\t\t\t\t            <div class="preview-info"> \t\t\t\t\t                <span class="file-name"></span> \t\t\t\t\t                <span class="file-index"></span> \t\t\t\t\t            </div> \t\t\t\t\t        </div> \t\t\t\t\t        <div class="preview-thumbs"> \t\t\t\t\t            <ul></ul> \t\t\t\t\t        </div> \t\t\t\t\t    </div>').appendTo(b("body"));
this.previewContent=c.find(".preview-content");this.previewPanel=c.find(".preview-panel");this.previewControl=c.find(".preview-control");this.previewThumbs=c.find(".preview-thumbs");this.previewInfo=c.find(".preview-info");this.previewPrev=c.find(".preview-prev");this.previewNext=c.find(".preview-next");this.previewClose=c.find(".preview-close a");this.previewName=c.find(".file-name");this.previewIndex=c.find(".file-index");this.previewPhoto=c.find(".preview-photo img");this._panelHeight=this.previewPanel.height();
this._thumbsHeight=this.previewThumbs.height();this._infoHeight=this.previewInfo.height();this.previewContent.height(this._winHeight-this._panelHeight-this._thumbsHeight-this._infoHeight-this._spaceHeight);this.el.width(this._winWidth);typeof outLinkInfo!=="undefined"&&outLinkInfo.sharePrivilege==1&&this.previewControl.find(".download-img").remove()},buildThumbs:function(c){var e=typeof c==="undefined";this.downloadable?this.previewControl.find(".download-img").show():this.previewControl.find(".download-img").hide();
var h=this.previewThumbs.find("ul"),a=parseInt(this._winWidth/d.THUMB_WIDTH),g=h.find("li").length,i=this.imgs,j=i.length,n=this.thumbCache,c=!e?parseInt(c):this.index,a=a%2?a:a-1,l=parseInt(a/2),o;if(g===0){for(var g="",m=0;m<a;m++){o=c+m-l;g=m<l&&l-m>c||m>l&&m-(l-c)>=j?g+'<li class="tmp"></li>':g+('<li><a href="javascript:;" '+(m===l?'class="cur"':"")+' hidefocus="true" data-pos="'+o+'" data-key="'+i[o].key+'"><img src="'+d.URL+i[o].key+"_"+d.THUMB_SIZE+'" /></a></li>')}g=b(g);g.find("img").on("load",
function(){n[b(this).attr("src")]=true});g.find("img").on("error",function(){b(this).attr("src",d.ERROR_IMG)});h.append(g)}else{var p=c-this.index;h.find(".cur").removeClass("cur");h.find("li:eq("+(l+p)+")").find("a").addClass("cur");if(p>0){h.find("li:lt("+p+")").remove();a="";for(m=0;m<p;m++)if(this.index+l+m+1<j){o=this.index+l+m+1;a=a+('<li><a href="javascript:;" hidefocus="true" data-pos="'+o+'" data-key="'+i[o].key+'"><img src="'+d.URL+i[o].key+"_"+d.THUMB_SIZE+'" /></a></li>')}else a=a+'<li class="tmp"></li>';
a=b(a);a.find("img").on("load",function(){n[b(this).attr("src")]=true});a.find("img").on("error",function(){b(this).attr("src",d.ERROR_IMG)});h.append(a)}else if(p<0){p=-p;h.find("li:gt("+(g-p-1)+")").remove();for(var q="",m=0;m<p;m++)if(this.index-l-m-1>=0){o=this.index-l-m-1;q='<li><a href="javascript:;" hidefocus="true" data-pos="'+o+'" data-key="'+i[o].key+'"><img src="'+d.URL+i[o].key+"_"+d.THUMB_SIZE+'" /></a></li>'+q}else q='<li class="tmp"></li>'+q;q=b(q);q.find("img").on("load",function(){n[b(this).attr("src")]=
true});q.find("img").on("error",function(){b(this).attr("src",d.ERROR_IMG)});h.prepend(q)}else if(g>a){i=(g-a)/2;h.find("li:lt("+i+"),li:gt("+(g-i-1)+")").remove()}else if(g<a){p=(a-g)/2;a=q="";for(m=0;m<p;m++){if(l-m>c)q=q+'<li class="tmp"></li>';else{o=c+m-l;q=q+('<li><a href="javascript:;" hidefocus="true" data-pos="'+o+'" data-key="'+i[o].key+'"><img src="'+d.URL+i[o].key+"_"+d.THUMB_SIZE+'" /></a></li>')}if(g+m+p-(l-c)<j){o=c+(g+m+p)-l;a=a+('<li><a href="javascript:;" hidefocus="true" data-pos="'+
o+'" data-key="'+i[o].key+'"><img src="'+d.URL+i[o].key+"_"+d.THUMB_SIZE+'" /></a></li>')}else a=a+'<li class="tmp"></li>'}a=b(a);q=b(q);a.find("img").on("load",function(){n[b(this).attr("src")]=true});a.find("img").on("error",function(){b(this).attr("src",d.ERROR_IMG)});q.find("img").on("load",function(){n[b(this).attr("src")]=true});q.find("img").on("error",function(){b(this).attr("src",d.ERROR_IMG)});h.prepend(q).append(a)}}this.index=c;if(!e){this.load=false;this.currentRnd=0;this.showDetail()}return this},
showDetail:function(){var c=this,b=this.imgs[this.index],e=this.imgs.length,a=this.previewPhoto;a.attr("src",d.URL+b.key+"_"+d.THUMB_SIZE);if(d.SUPPORT!=="filter")a[0].style[d.SUPPORT]="";else{a[0].style.filter="";a.css({left:0,top:0})}d.getRealSize(b.key,function(e,h){if(e.key===c.imgs[c.index].key){h?a.attr("src",d.URL+b.key+"_"+d.PREVIEW_SIZE):a.attr("src",d.ERROR_IMG);a.attr("data-realsize",e.width+"|"+e.height);var g=c._winWidth,n=c.previewContent.height();d.resize(a,g,n,e.width,e.height);c.load=
true}});this.index+1<e&&d.getRealSize(this.imgs[this.index+1].key,function(){});this.index+2<e&&d.getRealSize(this.imgs[this.index+2].key,function(){});this.previewName.html(b.name);this.previewIndex.html("("+(this.index+1)+"/"+this.imgs.length+")");this.previewControl.find(".original-img").attr("href",d.URL+b.key);this.previewControl.find(".download-img").attr("href",d.DOWNLOAD_URL+"?resourceId="+b.id+"&length="+b.size)},initEvent:function(){var c=this;this.el.on("click",function(c){c.stopImmediatePropagation()});
b(window).bind("resize",function(){c._winWidth=b(window).width();c._winHeight=b(window).height();c.previewContent.height(c._winHeight-c._panelHeight-c._thumbsHeight-c._infoHeight-c._spaceHeight);c.el.width(c._winWidth);var e=c._winWidth,h=c.previewContent.height(),a=(c.previewPhoto.attr("data-realsize")||"68|68").split("|");d.resize(c.previewPhoto,e,h,a[0],a[1]);c.buildThumbs()});this.previewControl.on("click",".rotate-left ",function(){c.doRotate(-Math.PI/2)}).on("click",".rotate-right",function(){c.doRotate(Math.PI/
2)});this.previewClose.on("click",function(){c.hide()});this.previewPrev.on("click",function(){c.index-1<0||c.buildThumbs(c.index-1)}).on("mouseenter",function(){b(this).find("a").addClass("hover").show()}).on("mouseleave",function(){b(this).find("a").hide()});this.previewNext.on("click",function(){c.index+1>=c.imgs.length||c.buildThumbs(c.index+1)}).on("mouseenter",function(){b(this).find("a").addClass("hover").show()}).on("mouseleave",function(){b(this).find("a").hide()});this._scrollEvent=function(d){c.isHidden||
(b.browser.mozilla?d.originalEvent.detail>0?c.previewNext.trigger("click"):c.previewPrev.trigger("click"):d.originalEvent.wheelDelta<0?c.previewNext.trigger("click"):c.previewPrev.trigger("click"))};b.browser.mozilla?b(document).bind("DOMMouseScroll",this._scrollEvent):b(document).bind("mousewheel",this._scrollEvent);this._keyEvent=function(b){if(!c.isHidden){b.keyCode===d.KEY.ESC&&c.hide();b.keyCode===d.KEY.LEFT&&c.previewPrev.trigger("click");b.keyCode===d.KEY.RIGHT&&c.previewNext.trigger("click")}};
b(document).bind("keydown",this._keyEvent);this.previewThumbs.on("click","a",function(){var d=b(this).attr("data-pos");c.buildThumbs(d)})},rotate:function(c,e,h){this.load=false;var e=h=Math.min(e,h,1),a=d.getMatrix(c,e,h),g=this.previewPhoto,i=g.width(),j=g.height();if(d.SUPPORT!=="filter")g[0].style[d.SUPPORT]="matrix("+[a.m11.toFixed(20),a.m21.toFixed(20),a.m12.toFixed(20),a.m22.toFixed(20)].join()+", "+e+", "+h+" )";else{g[0].style.filter="";if(b.browser.version==="8.0"&&navigator.userAgent.indexOf("Trident")>
0){if(parseInt(c/Math.PI)==c/Math.PI)i=a=0;else{a=(i-j*h)/2;i=(j-i*e)/2}g.css({left:a,top:i})}c=Math.abs(parseInt(c*2/Math.PI));g[0].style.filter="progid:DXImageTransform.Microsoft.BasicImage(rotation="+c+")";g.css({width:g.data("cursize").split("|")[0]*e+c,height:g.data("cursize").split("|")[1]*h+c})}this.load=true},doRotate:function(c){if(this.load){var b,d;b=d=1;c=this.currentRnd=this.currentRnd+c;if(Math.abs(c)>=2*Math.PI)c=this.currentRnd=0;var a=this.previewContent.height(),e=this.previewPhoto.attr("data-realsize").split("|"),
g=this._winWidth,j=this.previewPhoto.width(),n=this.previewPhoto.height();if(parseInt(c/Math.PI)!=c/Math.PI){a<j||Math.min(a/j,Math.min(g,e[1])/n);b=g<n?d=g/n:d=Math.min(g/n,Math.min(a,e[0])/j)}this.rotate(c,b,d)}},rebuild:function(c){this.imgs=c.imgs||[];this.index=c.index||0;this.downloadable=typeof c.downloadable==="undefined"?true:c.downloadable;this.buildThumbs(this.index);this.show()},show:function(){this._overlay=this._overlay||new Sbox.Views.Overlay({opacity:0.85,bgcolor:"#cdcdcd",modal:true});
this.el.show();this.isHidden=false;return this},hide:function(){this.el.hide();this._overlay.remove();this._overlay=null;this.isHidden=true;this.previewThumbs.find("ul").empty();this.previewPhoto.css({width:68,height:68,left:0,top:0}).attr("src",d.DEFAULT_IMG);d.SUPPORT!=="filter"?this.previewPhoto[0].style[d.SUPPORT]="":this.previewPhoto[0].style.filter="";return this},remove:function(){b(document).unbind("keydown",this._keyEvent);b.browser.mozilla?b(document).unbind("DOMMouseScroll",this._scrollEvent):
b(document).unbind("mousewheel",this._scrollEvent);this.el.remove()}});Sbox.Preview=function(c,b){var d=0,a,e=[];b.each(function(b){if(isPreviewImgFile(b.get("name"),b.get("size"))){e.push({id:b.get("id"),name:b.get("name"),key:b.get("thumbnailsKey"),size:b.get("size")});c.get("id")===b.get("id")&&(a=d);d++}});window.imgPreviewHandle?window.imgPreviewHandle.rebuild({index:a,imgs:e,downloadable:!c.get("power")||c.get("power")<4}):window.imgPreviewHandle=new Sbox.Views.ImgPreview({index:a,imgs:e,downloadable:!c.get("power")||
c.get("power")<4})}})(jQuery);
(function(b){Sbox.SetDeletePassword=function(d){var g=new Sbox.Views.Window({title:"\u8bbe\u7f6e\u56de\u6536\u7ad9\u5bc6\u7801",body:'<form><div class="recyclebin-password-dialog"> \t\t\t        \t\t<div class="field"> \t\t\t        \t\t\t<div class="label">\u7f51\u76d8\u767b\u5f55\u5bc6\u7801\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="password" class="ipt-text" name="loginPassword" id="loginPassword" onpaste="return false;" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field"> \t\t\t        \t\t\t<div class="label">\u8bbe\u7f6e\u56de\u6536\u7ad9\u5bc6\u7801\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="password" class="ipt-text" name="deletePassword" id="deletePassword" onpaste="return false;" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field"> \t\t\t        \t\t\t<div class="label">\u786e\u8ba4\u56de\u6536\u7ad9\u5bc6\u7801\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="password" class="ipt-text" name="rdeletePassword" id="rdeletePassword" onpaste="return false;" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t</div></form>',width:560,
closeButton:true});g.addButton({text:"\u786e\u5b9a",onclick:function(){j=true;g.body.find("input").blur();if(j){a.html('<span class="icon icon-loading"></span>');b.post("/User!setDeletePassword.action",g.body.find("form").serialize(),function(b){if(b.code===701||b.code===403)Sbox.Login();else if(b.code===200){Sbox.Success("\u8bbe\u7f6e\u6210\u529f");g.remove();d&&d()}else b.code===302&&a.html('<span class="error">\u767b\u5f55\u5bc6\u7801\u9519\u8bef</span>')},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){g.remove()}});var e=g.body,c=e.find("#loginPassword"),f=e.find("#deletePassword"),h=e.find("#rdeletePassword"),a=c.parent().next(),k=f.parent().next(),i=h.parent().next(),j=true;e.find("form").on("submit",function(){g.getButton("\u786e\u5b9a")[0].trigger("click");return false});e.find("input").on("keypress",function(a){a.keyCode===13&&g.getButton("\u786e\u5b9a")[0].trigger("click")});
c.on("blur",function(){var c=b(this).val();if(c===""){a.html('<span class="error">\u8bf7\u8f93\u5165\u767b\u5f55\u5bc6\u7801</span>');j=false}else if(c.length>16||c.length<6){a.html('<span class="error">\u957f\u5ea6\u4e3a6-16\u4e2a\u5b57\u7b26</span>');j=false}}).on("focus",function(){a.empty()});f.on("blur",function(){var a=b(this).val();if(a===""){k.html('<span class="error">\u8bf7\u8f93\u5165\u56de\u6536\u7ad9\u5bc6\u7801</span>');j=false}else if(a.length>16||a.length<6){k.html('<span class="error">\u957f\u5ea6\u4e3a6-16\u4e2a\u5b57\u7b26</span>');
j=false}if(a===h.val())i.empty();else{i.html('<span class="error">\u4e24\u6b21\u8f93\u5165\u5bc6\u7801\u4e0d\u4e00\u81f4</span>');j=false}}).on("focus",function(){k.empty()});h.on("blur",function(){var a=b(this).val(),c=f.val();if(a===""){i.html('<span class="error">\u8bf7\u786e\u8ba4\u5bc6\u7801</span>');j=false}else if(c!==""&&a!==c){i.html('<span class="error">\u4e24\u6b21\u8f93\u5165\u5bc6\u7801\u4e0d\u4e00\u81f4</span>');j=false}}).on("focus",function(){i.empty()})};Sbox.ChangeDeletePassword=
function(d){var g=new Sbox.Views.Window({title:"\u4fee\u6539\u56de\u6536\u7ad9\u5bc6\u7801",body:'<form><div class="recyclebin-password-dialog"> \t\t\t        \t\t<div class="field"> \t\t\t        \t\t\t<div class="label">\u539f\u56de\u6536\u7ad9\u5bc6\u7801\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="password" tabindex="1" class="ipt-text" name="sdeletePassword" id="sdeletePassword" onpaste="return false;" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field" style="margin:-10px 0 0 0;"> \t\t\t        \t\t\t<div class="label"></div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<a href="javascript:;" id="forgetPassword" style="color:#337FD4">\u5fd8\u8bb0\u56de\u6536\u7ad9\u5bc6\u7801\uff1f</a> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field"> \t\t\t        \t\t\t<div class="label">\u65b0\u56de\u6536\u7ad9\u5bc6\u7801\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="password" tabindex="2" class="ipt-text" name="deletePassword" id="deletePassword" onpaste="return false;" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field"> \t\t\t        \t\t\t<div class="label">\u786e\u8ba4\u5bc6\u7801\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="password" tabindex="3" class="ipt-text" name="rdeletePassword" id="rdeletePassword" onpaste="return false;" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t</div></form>',
width:560,closeButton:true});g.addButton({text:"\u786e\u5b9a",onclick:function(){j=true;g.body.find("input").blur();if(j){a.html('<span class="icon icon-loading"></span>');b.post("/User!updateDeletePassword.action",g.body.find("form").serialize(),function(b){if(b.code===701||b.code===403)Sbox.Login();else if(b.code===200){Sbox.Success("\u4fee\u6539\u6210\u529f");g.remove();d&&d()}else b.code===302&&a.html('<span class="error">\u65e7\u5bc6\u7801\u9519\u8bef</span>')},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){g.remove()}});var e=g.body,c=e.find("#sdeletePassword"),f=e.find("#deletePassword"),h=e.find("#rdeletePassword"),a=c.parent().next(),k=f.parent().next(),i=h.parent().next(),j=true;e.find("form").on("submit",function(){g.getButton("\u786e\u5b9a")[0].trigger("click");return false});e.find("input").on("keypress",function(a){a.keyCode===13&&g.getButton("\u786e\u5b9a")[0].trigger("click")});
c.on("blur",function(){var c=b(this).val();if(c===""){a.html('<span class="error">\u8bf7\u8f93\u5165\u539f\u56de\u6536\u7ad9\u5bc6\u7801</span>');j=false}else if(c.length>16||c.length<6){a.html('<span class="error">\u957f\u5ea6\u4e3a6-16\u4e2a\u5b57\u7b26</span>');j=false}}).on("focus",function(){a.html("")});e.find("#forgetPassword").on("click",function(){Sbox.ResetDeletePassword()});f.on("blur",function(){var a=b(this).val();if(a===""){k.html('<span class="error">\u8bf7\u8f93\u5165\u65b0\u56de\u6536\u7ad9\u5bc6\u7801</span>');
j=false}else if(a.length>16||a.length<6){k.html('<span class="error">\u957f\u5ea6\u4e3a6-16\u4e2a\u5b57\u7b26</span>');j=false}if(a===h.val())i.empty();else{i.html('<span class="error">\u4e24\u6b21\u8f93\u5165\u5bc6\u7801\u4e0d\u4e00\u81f4</span>');j=false}}).on("focus",function(){k.empty()});h.on("blur",function(){var a=b(this).val(),c=f.val();if(a===""){i.html('<span class="error">\u8bf7\u786e\u8ba4\u5bc6\u7801</span>');j=false}else if(c!==""&&a!==c){i.html('<span class="error">\u4e24\u6b21\u8f93\u5165\u5bc6\u7801\u4e0d\u4e00\u81f4</span>');
j=false}}).on("focus",function(){i.empty()})};Sbox.CancelDeletePassword=function(d){var g=(new Sbox.Views.Window({title:"\u53d6\u6d88\u56de\u6536\u7ad9\u5bc6\u7801",body:'<form><div class="wn-msg" style="margin-left:80px;"><p>\u60a8\u786e\u8ba4\u53d6\u6d88\u56de\u6536\u7ad9\u5bc6\u7801\u5417\uff1f</p> \t\t\t\t\t\t\t\t<p class="tip">\u53d6\u6d88\u56de\u6536\u7ad9\u5bc6\u7801\u540e\uff0c\u60a8\u7684\u56de\u6536\u7ad9\u6570\u636e\u4e0d\u518d\u53d7\u4fdd\u62a4\uff01</p> \t\t\t\t        \t\t<div class="field" style="margin-top:10px;"> \t\t\t\t        \t\t\t<div class="label">\u56de\u6536\u7ad9\u5bc6\u7801\uff1a</div> \t\t\t\t        \t\t\t<div class="ipt"> \t\t\t\t        \t\t\t\t&nbsp;<input type="password" class="ipt-text" style="width:100px;" name="deletePassword" id="deletePassword" onpaste="return false;" /> \t\t\t\t        \t\t\t</div> \t\t\t\t        \t\t\t<div class="tips" style="font-size:12px; vertical-align:top;"> \t\t\t\t        \t\t\t</div> \t\t\t\t        \t\t</div> \t\t\t\t\t\t\t\t</div></form>',
width:560,closeButton:true})).addStyle("dialog-warning");g.addButton({text:"\u786e\u5b9a",onclick:function(){h=true;g.body.find("input").blur();if(h){f.html('<span class="icon icon-loading"></span>');b.post("/User!cancelDeletePassword.action",g.body.find("form").serialize(),function(a){if(a.code===701||a.code===403)Sbox.Login();else if(a.code===200){Sbox.Success("\u53d6\u6d88\u6210\u529f");g.remove();d&&d()}else a.code===302&&f.html('<span class="error">\u5bc6\u7801\u9519\u8bef</span>')},"json").error(function(){Sbox.Loading().remove();
Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}},className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){g.remove()}});var e=g.body,c=e.find("#deletePassword"),f=c.parent().next(),h=true;e.find("form").on("submit",function(){g.getButton("\u786e\u5b9a")[0].trigger("click");return false});e.find("input").on("keypress",function(a){a.keyCode===13&&g.getButton("\u786e\u5b9a")[0].trigger("click")});c.on("blur",function(){var a=b(this).val();if(a===""){f.html('<span class="error">\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a</span>');
h=false}else if(a.length>16||a.length<6){f.html('<span class="error">\u957f\u5ea6\u4e3a6-16\u4e2a\u5b57\u7b26</span>');h=false}}).on("focus",function(){f.empty()})};Sbox.ResetDeletePassword=function(){Sbox.Warning("<p>\u60a8\u786e\u8ba4\u91cd\u7f6e\u56de\u6536\u7ad9\u5bc6\u7801\u5417\uff1f</p>",function(d){d&&b.post("/User!forgetDeletePassword.action?_t="+Math.random(),function(b){b.code===701||b.code===403?Sbox.Login():b.code===200?Sbox.Alert({message:'<div class="reset-dp-success"><p>\u56de\u6536\u7ad9\u5bc6\u7801\u91cd\u7f6e\u6210\u529f\uff01</p><p class="tip">\u5df2\u5c06\u65b0\u5bc6\u7801\u53d1\u9001\u5230\u60a8\u7684\u767b\u5f55\u90ae\u7bb1\u4e2d\uff0c\u8bf7\u5c3d\u5feb\u67e5\u6536\uff01</p></div>',
width:500}):Sbox.Error("\u91cd\u7f6e\u5931\u8d25\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})})};Sbox.ValidateDeletePassword=function(d){var g=new Sbox.Views.Window({title:"\u56de\u6536\u7ad9\u5bc6\u7801\u9a8c\u8bc1",body:'<form><div class="recyclebin-password-dialog"> \t\t\t        \t\t<div class="field"> \t\t\t        \t\t\t<div class="label">\u8bf7\u8f93\u5165\u56de\u6536\u7ad9\u5bc6\u7801\uff1a</div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<input type="password" class="ipt-text" name="deletePassword" id="deletePassword" onpaste="return false;" /> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t\t<div class="field"> \t\t\t        \t\t\t<div class="label"></div> \t\t\t        \t\t\t<div class="ipt"> \t\t\t        \t\t\t\t<a href="javascript:;" id="forgetPassword" style="color:#337FD4">\u5fd8\u8bb0\u56de\u6536\u7ad9\u5bc6\u7801\uff1f</a> \t\t\t        \t\t\t</div> \t\t\t        \t\t\t<div class="tips"> \t\t\t        \t\t\t\t<span class="tip"></span> \t\t\t        \t\t\t</div> \t\t\t        \t\t</div> \t\t\t        \t</div></form>',
width:560,closeButton:true});g.addButton({text:"\u786e\u5b9a",onclick:function(){h=true;g.body.find("input").blur();if(h){f.html('<span class="icon icon-loading"></span>');b.post("/User!confirmDeletePassword.action",g.body.find("form").serialize(),function(a){if(a.code===701||a.code===403)Sbox.Login();else if(a.code===200){g.remove();d&&d()}else a.code===302&&f.html('<span class="error">\u56de\u6536\u7ad9\u5bc6\u7801\u9519\u8bef</span>')},"json").error(function(){Sbox.Loading().remove();Sbox.Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}},
className:"confirm"}).addButton({text:"\u53d6\u6d88",onclick:function(){g.remove()}});var e=g.body,c=e.find("#deletePassword"),f=c.parent().next(),h=true;e.find("form").on("submit",function(){g.getButton("\u786e\u5b9a")[0].trigger("click");return false});e.find("input").on("keypress",function(a){a.keyCode===13&&g.getButton("\u786e\u5b9a")[0].trigger("click")});e.find("#forgetPassword").on("click",function(){Sbox.ResetDeletePassword()});c.on("blur",function(){var a=b(this).val();if(a===""){f.html('<span class="error">\u8bf7\u8f93\u5165\u56de\u6536\u7ad9\u5bc6\u7801</span>');
h=false}else if(a.length>16||a.length<6){f.html('<span class="error">\u957f\u5ea6\u4e3a6-16\u4e2a\u5b57\u7b26</span>');h=false}}).on("focus",function(){f.empty()})}})(jQuery);
