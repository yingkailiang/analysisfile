jQuery(function(){function i(){jQuery.browser.msie&&(document.title=WEBSITE_NAME)}function o(){i()}function p(a){var b=this;a.name=decodeURIComponent(a.name);this.addFileParam(a.id,"resourceId",uploadLinkInfo.resourceId);this.addFileParam(a.id,"length",a.size);this.addFileParam(a.id,"sign",uploadLinkInfo.sign);this.addFileParam(a.id,"date",uploadLinkInfo.date);this.addFileParam(a.id,"password",k);h.find("ul")[0]||(j.hide(),l.show(),h.append("<ul>"));var c=h.find("ul"),d='<li id="upload_'+a.id+'">                     <div class="progress-bg"></div>                     <span class="f-name" title="'+
a.name+'">'+a.name+'</span>                     <span class="f-percent">\u7b49\u5f85\u4e0a\u4f20</span>                     <span class="f-size">'+formatbytes(a.size)+'</span>                     <span class="f-op">                         <a class="cancle" href="javascript:;"><span class="icon icon-cancle2"></span></a> &nbsp;                     </span>                 </li>',d=$(d);c.append(d);var e=d.find(".progress-bg"),f=d.find(".f-percent"),g=d.find(".f-op");/\.(exe|js|com|bat|dll|vbs|ocx)$/i.test(a.name)&&
(b.cancelUpload(a.id,!1),e.remove(),g.empty(),f.html('<span class="fail">\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u683c\u5f0f</span>'));d.on("click",".cancle",function(){b.cancelUpload(a.id);e.remove();g.empty();f.html('<span class="fail">\u53d6\u6d88\u4e0a\u4f20</span>')});window.onbeforeunload=function(){return"\u60a8\u6709\u6587\u4ef6\u6b63\u5728\u4e0a\u4f20\uff0c\u7ee7\u7eed\u64cd\u4f5c\u4f1a\u4e2d\u65ad\u4e0a\u4f20\uff0c\u8981\u7ee7\u7eed\u5417\uff1f"}}function q(a,b){if(b===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED)Sbox.Error("\u540c\u65f6\u4e0a\u4f20\u6587\u4ef6\u4e0d\u5f97\u8d85\u8fc7100\u4e2a");
else{h.find("ul")[0]||(j.hide(),l.show(),h.append("<ul>"));"undefined"===typeof a.size?(b=SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT,size="\u672a\u77e5\u5927\u5c0f"):size=formatbytes(a.size);var c=h.find("ul"),d='<li id="upload_'+a.id+'">                     <div class="progress-bg"></div>                     <span class="f-name" title="'+a.name+'">'+a.name+'</span>                     <span class="f-percent">\u7b49\u5f85\u4e0a\u4f20</span>                     <span class="f-size">'+formatbytes(a.size)+
'</span>                     <span class="f-op">                         <a class="cancle" href="javascript:;"><span class="icon icon-cancle2"></span></a> &nbsp;                     </span>                 </li>',d=$(d);c.append(d);d.find(".progress-bg");d.find(".f-percent");d.find(".f-op").empty();switch(b){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:e(a,"\u8d85\u8fc7\u5927\u5c0f\u9650\u5236");break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:e(a,"\u6587\u4ef6\u4e3a\u7a7a");break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:e(a,
"\u6587\u4ef6\u7c7b\u578b\u9519\u8bef");break;default:null!==a&&e(a,"\u672a\u77e5\u9519\u8bef")}}}function r(){this.startUpload();i()}function s(){}function t(a,b,c){var b=Math.ceil(1E4*(b/c))/100,d=$("#upload_"+a.id),a=d.find(".progress-bg"),c=d.find(".f-percent"),d=d.find(".f-op");a.css("width",b+"%");100===b?(c.html('<span class="saving"><span class="icon icon-loading"></span>\u6b63\u5728\u5b58\u50a8</span>'),d.empty()):c.html(b+"%")}function u(a,b,c){console.log(b);var d=$("#upload_"+a.id);d.find(".progress-bg");
d.find(".f-percent");switch(b){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:e(a,'\u4e0a\u4f20\u9519\u8bef<em style="color:white">'+SWFUpload.UPLOAD_ERROR.HTTP_ERROR+"</em>");this.debug("Error Code: HTTP Error, File name: "+a.name+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:e(a,"\u4e0a\u4f20\u5931\u8d25");this.debug("Error Code: Upload Failed, File name: "+a.name+", File size: "+a.size+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:e(a,"\u670d\u52a1\u5668\u9519\u8bef");
this.debug("Error Code: IO Error, File name: "+a.name+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:e(a,'\u4e0a\u4f20\u9519\u8bef<em style="color:white">'+SWFUpload.UPLOAD_ERROR.SECURITY_ERROR+"</em>");this.debug("Error Code: Security Error, File name: "+a.name+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:e(a,"\u7a7a\u95f4\u4e0d\u8db3");this.debug("Error Code: Upload Limit Exceeded, File name: "+a.name+", File size: "+a.size+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:e(a,
'\u4e0a\u4f20\u9519\u8bef<em style="color:white">'+SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED+"</em>");this.debug("Error Code: File Validation Failed, File name: "+a.name+", File size: "+a.size+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:e(a,"\u53d6\u6d88\u4e0a\u4f20");break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:e(a,'\u4e0a\u4f20\u9519\u8bef<em style="color:white">'+SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED+"</em>");break;default:e(a,"\u4e0a\u4f20\u9519\u8bef"),this.debug("Error Code: "+
b+", File name: "+a.name+", File size: "+a.size+", Message: "+c)}}function v(a,b){var c=$("#upload_"+a.id),d=c.find(".progress-bg"),e=c.find(".f-percent"),c=c.find(".f-op");d.remove();c.empty();0<=b.indexOf("701:")?Sbox.Login():(b=jQuery.parseJSON(b),null===b?e.html('<span class="fail">\u4e0a\u4f20\u5931\u8d25</span>'):200===b.code?(e.html('<span class="success">\u4e0a\u4f20\u6210\u529f</span>'),f.getSetting("fileList")&&a.post.dirId===f.getSetting("path").get("pathId")&&f.getSetting("fileList").trigger("reload")):
501===b.code?e.html('<span class="fail">\u7a7a\u95f4\u5927\u5c0f\u4e0d\u8db3</span>'):503===b.code?e.html('<span class="fail">\u8be5\u6587\u4ef6\u88ab\u9501\u5b9a</span>'):505===b.code?e.html('<span class="fail">\u6ca1\u6709\u6743\u9650</span>'):801===b.code?(e.html('<span class="fail">\u5bc6\u7801\u5df2\u4fee\u6539</span>'),Sbox.Error({message:"\u4e0a\u4f20\u5bc6\u7801\u5df2\u4fee\u6539\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u5bc6\u7801\uff01",onHide:function(){location.reload()}}),this.cancelQueue()):
e.html('<span class="fail">\u4e0a\u4f20\u5931\u8d25</span>'))}function w(){0===this.getStats().files_queued&&(window.onbeforeunload=null)}function x(){0===this.getStats().files_queued&&(window.onbeforeunload=null)}function e(a,b){var c=$("#upload_"+a.id);c.find(".f-percent").empty().html('<span class="fail">'+b+"</span>");c.find(".progress-bg").remove();c.find(".f-op").empty();c.removeAttr("id")}if(document.getElementById("anonymousUploadMod")){var y={flash_url:"/assets/swf/swfu-v2.swf",upload_url:"/AnonymousWholeUpload!sendFile.action",
post_params:{},file_size_limit:"300 MB",file_types:"*.*",file_types_description:"All Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{},debug:0<=location.hash.indexOf("debugmode"),button_image_url:STATIC_DOMAIN+"/img/upload-v2.png",button_width:"97",button_height:"31",button_placeholder_id:"uploadHandler",button_cursor:-2,swfupload_loaded_handler:o,file_dialog_start_handler:i,file_queued_handler:p,file_queue_error_handler:q,file_dialog_complete_handler:r,upload_start_handler:s,upload_progress_handler:t,
upload_error_handler:u,upload_success_handler:v,upload_complete_handler:w,queue_complete_handler:x};$("#uploadContainer");var z=$("#uploadBtn"),A=$("#uploadDisabled"),f,B=$("#passwordMod"),j=$("#uploadTipMod"),m=$("#password"),g=$("#passwordTip"),n=$("#passwordBtn"),l=$("#uploadList"),h=$("#uploadBody"),k;m.on("keypress",function(a){13===a.keyCode&&n.trigger("click")});n.on("click",function(){var a=m.val();""===a?g.html('<span class="error">\u8bf7\u8f93\u5165\u4e0a\u4f20\u5bc6\u7801</span>'):(g.html('<span class="icon icon-loading"></span>'),
$.post("/CheckShareDirPassword!share.action",{resourceId:uploadLinkInfo.resourceId,userId:uploadLinkInfo.userId,sign:uploadLinkInfo.sign,date:uploadLinkInfo.date,password:a,shareType:2},function(b){200===b.code?(g.empty(),k=a,B.hide(),j.show(),A.hide(),checkFlash()?f=new SWFUpload(y):z.html('<span style="color:#E65455;">\u4e0a\u4f20\u9700\u8981flash\u652f\u6301\uff0c\u8bf7\u4e0b\u8f7d\u5b89\u88c5\u540e\u91cd\u8bd5\uff0c<a target="_blank" href="http://get.adobe.com/cn/flashplayer/">\u4e0b\u8f7d\u5730\u5740</a></span>')):
g.html('<span class="error">\u5bc6\u7801\u9519\u8bef</span>')},"json"))})}});
