"use strict";(function(){const aj=require("@loader/options");require("api-utils/cuddlefish");const X=require("api-utils/traits").Trait;const ac=require("api-utils/file");const at=require("api-utils/url");const R=require("api-utils/list").List;const ap=require("api-utils/unload");const Z=require("api-utils/observer-service");const a7=require("preferences-service");const aJ=require("api-utils/match-pattern").MatchPattern;const M=require("utils-sf/logger").Logger;const a4=require("utils-sf/services");const ao=require("utils-sf/protocol");const al=require("utils-sf/permission").Manager;const J=require("utils-sf/global-storage").storage;const ad=require("utils-sf/url-pattern");const ax=require("components");const aN=require("jetchrome/self");const aE=require("addon-kit-sf/simple-storage");const q=require("addon-kit-sf/page-mod").PageMod;const ab=require("timer");const ae=require("addon-kit-sf/tabs");const aw=require("addon-kit-sf/windows");const S=require("addon-kit-sf/page-mod");const P=require("addon-kit-sf/widget");const d=require("addon-kit-sf/panel");const Q=require("addon-kit-sf/request").Request;const aQ=require("addon-kit-sf/page-worker").Page;const aH=require("addon-kit-sf/context-menu");const V=X.compose({_pageMod:null,get views(){return this._views},constructor:function an(){this._views=[];return this._public},start:function(){this._pageMod=S.PageMod({allFrames:true,onContent:(function(a8){this._views.push(a8);a8.addEventListener("unload",(function(ba,a9){this._views=this._views.filter(function(bb){return bb!=ba})}).bind(this,a8),true);this.inject(a8)}).bind(this),include:[this.getURL("*")],contentScriptWhen:"start",contentScript:""})},stop:function(){if(this_pageMode){this._pageMod.destroy();this._pageMod=null}},inject:function(a9){var bb=this;var a8=a9.wrappedJSObject||a9;require("jetchrome/api/console").inject(bb,a9,a8);const ba=require("jetchrome/api/chrome");if(!ba){throw new Error("no injector for chrome")}ba.inject(bb,a9,a8);require("jetchrome/api/webkit").inject(bb,a9,a8);require("jetchrome/api/xmlhttprequest").inject(bb,a9,a8);require("jetchrome/api/webstorage").inject(bb,a9,a8);require("jetchrome/api/background").inject(bb,a9,a8);require("jetchrome/api/misc").inject(bb,a9,a8)},dispatchEvent:function(a9,a8){this.views.forEach(function(bb){var ba=(bb.wrappedJSObject||bb).chrome;if(!ba){throw new Error("View has no chrome")}var bc=ba._listener;if(bc&&bc[a9]){bc[a9].forEach(function(bd){bd.apply(bc,a8)})}})}});const aL="chrome-extension";const aR=X.compose({id:null,name:null,description:null,version:null,mayDisable:true,isApp:false,appLaunchUrl:null,widgetUrl:null,homepageUrl:null,optionsURL:null,icons:null,permissions:null,hostPermissions:null,constructor:function aR(ba){this.id=ba.id;this.name=ba.manifest.name;this.description=ba.manifest.description;this.version=ba.manifest.version;this.isApp="app" in ba._manifest;this.widgetUrl=ba.manifest.widget&&ba.getURL(ba.manifest.widget["default_page"]);this.appLaunchUrl=ba.api.app&&ba.api.app.url;this.homepageUrl=ba.manifest.homepage_url;this.optionsURL=ba.manifest.options_url;var a9=ba.manifest.icons;this.icons={};if(a9){for(var a8 in a9){this.icons[a8]=ba.getURL(a9[a8])}}this.permissions=ba.manifest.permissions||[];this.hostPermissions=ba.manifest.permissions;return this._public}});const aO=X.compose({get lastError(){return this._lastError},set lastError(a8){this._lastError=a8},get inIncognitoContext(){return a4.pbs.privateBrowsingEnabled},isAllowedFileSchemeAccess:function(){return false},isAllowedIncognitoAccess:function(){return false},getViews:function(a8){return this._views},getBackgroundPage:function(){var a8=this.api.backgroundPage;return a8?a8.contentWindow:null},getURL:function(a8){return this._baseURI.resolve(a8).toString()},sendRequest:function(ba,a9,bc,bb){var a8={id:this._id};if(bb){a8.tab=bb}this.dispatchEvent("extension:request",[JSON.parse(JSON.stringify(a9)),a8,bc||function(){}])},setUpdateUrlData:function(){}});const aV=X.compose(aO,V.resolve({constructor:"_initViews",start:"_startViews",stop:"_stopViews"}),{_id:null,_baseURI:null,_pageMod:null,_api:null,get defaultLocale(){return this.manifest.default_locale},get _storage(){return aE.storage},get id(){return this._id},get newInstalled(){return this._storage.installed!=true},get icons(){return(this.manifest.icons?Object.keys(this.manifest.icons).sort(function(a9,a8){return parseInt(a9)-parseInt(a8)}).reverse().map((function(a8){return this.manifest.icons[a8]}).bind(this)):[]).map((function(a8){return this.getURL(a8)}).bind(this))},get api(){return this._api},get addon(){this._addon},get info(){return aR(this)},get manifest(){return this._manifest},constructor:function aV(a9){this._id=a9.id;ao.register(aL,{newChannel:function(bd){var bb="resource://"+bd.host+"/extension/data"+bd.path;var ba=a4.io.newURI(bb,bd.originCharset,null);var bc=a4.io.newChannelFromURI(ba);bc.originalURI=bd;return bc}});this._baseResourceURI=a4.resProt.newURI(a9.prefixURI+"extension/data/",null,null);this._baseURI=a4.io.newURI(aL+"://"+this.id.split("@")[0],null,null);this._api={};this._initViews();this._manifest=w(this);this._api.i18n=aD(this);if(this.manifest.background_page){this._api.backgroundPage=H(this.getURI(this.manifest.background_page).toString())}else{if(this.manifest.background&&this.manifest.background["page"]){this._api.backgroundPage=H(this.getURI(this.manifest.background["page"]))}}if(this.manifest.browser_action){this._api.browserAction=av(this,this.manifest.browser_action)}if(this.manifest.page_action){this._api.pageAction=T(this,this.manifest.page_action)}if(this.manifest.app){this._api.app=x(this,this.manifest.app)}if(this.hasPermission("contextMenus")){this._api.contextMenus=K(this)}if(this.hasPermission("cookies")){this._api.cookies=a2(this)}if(this.hasPermission("history")){this._api.history=E(this)}this._api.contentScripts=D(this,this.manifest.content_scripts);this._api.windows=L(this);this._api.tabs=aA(this);this._api.idle=aF(this);if(this.manifest.chrome_url_overrides){var a8={};["newtab"].forEach(function(ba){a8[ba]=this.getURI(this.manifest.chrome_url_overrides[ba]).toString()});this._api.pageOverride=F(a8)}this.start();M.debug('Extension "'+this.manifest.name+'" started',this);return this._public},start:function(){this._startViews();for(var a8 in this.api){if(this.api[a8].start){this.api[a8].start()}}this._storage.installed=true},stop:function(){this._stopViews();for(var a8 in this.api){if(this.api[a8].stop){this.api[a8].stop()}}},hasPermission:function(a8){return this._manifest.permissions&&this._manifest.permissions.indexOf(a8)!=-1},getURI:function(a8){return at.URL(a8,this._baseURI.spec)},getResourceURI:function(a8){return at.URL(a8&&a8.indexOf("/")==0?a8.slice(1):a8,this._baseResourceURI.spec)}});"use strict";const W=function(){return{listeners_:[],findListener_:function(a8){return this.listeners_[a8]},addListener:function(a8){this.listeners_.push(a8)},removeListener:function(a8){this.listeners_=this.listeners_.filter(function(a9){return a9!=a8})},hasListener:function(a8){return this.listeners.indexOf(a8)!=-1}}};exports.Event=W;const af=X.compose({_sender:null,_port:null,_name:null,_connected:false,_emit:function(a8,bb){var ba={id:this._id};if(bb){for(var a9 in bb){ba[a9]=bb[a9]}}this._port.emit(a8,ba)},_listen:function(ba,a9){var a8="on"+ba[0].toUpperCase()+ba.slice(1);this._port[a9?"once":"on"](ba,(function(bc,bb){if(bb.id==this._id){this[a8].listeners_.forEach(function(bd){Function.apply.call(bd,null,bb.arguments)})}}).bind(this,ba))},get sender(){return this._sender},get name(){return this._name},constructor:function(a9){this._id=a9.id||10000000000000000*Math.random();this._port=a9.worker.port;this._name=a9.name;this._connected=true;this._listen("message");this._listen("disconnect",true);if(a9.connect){this._emit("connect",{name:this._name,sender:a9.sender})}if(a9.sender){this._sender=a9.sender}const a8=(function(ba){ba.removeListener("detach",a8);ba.destroy();this.destroy()}).bind(this,a9.worker);a9.worker.once("detach",a8);return this._public},destroy:function(){this.onDisconnect.listeners_.forEach(function(a8){a8()});this._connected=false;this.onMessage.listeners_=[];this.onDisconnect.listeners_=[]},onMessage:new W(),onDisconnect:new W(),postMessage:function(){if(!this._connected){M.warn("Port.postMessage: not connected")}this._emit("message",{arguments:Array.prototype.slice.call(arguments,0)})},disconnect:function(){if(!this._connected){M.warn("Port.disconnect: not connected")}this._emit("disconnect");this.destroy()}});const y=JSON.parse(aN.data.load("format/manifest.json"));const a1=JSON.parse(aN.data.load("support/manifest.json"));function ai(a9){var a8=typeof a9;if("object"==a8&&("length" in a9)&&("concat" in a9)){a8="array"}return a8}const aY="manifest.json";const w=X.compose({constructor:function w(be){var bg=be.getResourceURI(aY);var a8=at.toFilename(bg);if(ac.exists(a8)){var bf;try{bf=JSON.parse(ac.read(a8))}catch(bb){throw new SyntaxError("Manifest parse error :",bg)}y.forEach((function(bh){if(bh.required&&!(bh.name in bf)){throw new TypeError('Manifest: "'+bh.name+'" required')}if((bh.name in bf)&&ai(bf[bh.name])!=bh.type){throw new TypeError('Manifest: "'+bh.name+'" has type "'+ai(bf[bh.name])+'", expecting :"'+bh.type+'"',bg)}}).bind(this));a1.forEach((function(bh){if(bh in bf){M.warn('Manifest: "'+bh+'" is not supported')}}).bind(this));var a9=[];for(var bc in bf){if(bf[bc].group){if(bf.indexOf(bf[bc].group)!=-1){throw new Error("Only one of 'browser_action', 'page_action' or 'app' must be specified.")}a9.push(bf[bc].group)}}if(bf[bc]["app"]&&bf.option_page&&!/^[\w-]+:/.test(bf.option_page)){throw new Error("Invalid value for 'options_page'. Hosted apps must specify an absolute URL")}}else{throw new Error("manifest file not found : "+bg)}const ba={default_locale:bf.default_locale};for(var bd in bf){this._public.__defineGetter__(bd,(function(bh){if(!(bh in ba)){ba[bh]=be.api.i18n.localize(bf[bh])}return ba[bh]}).bind(null,bd))}return this._public},});const H=X.compose({_worker:null,_extension:null,_url:null,constructor:function H(a8){this._url=a8;return this._public},start:function(a8){this._worker=aQ({contentURL:this._url});if(typeof a8=="function"){a8(this)}},stop:function(){if(this._worker){this._worker.destroy();this._worker=null}},get contentWindow(){return this._worker.contentWindow}});"use strict";const aq=function(bi){var bh=window.self;var bf={};var bg;var bd;var a8;function be(bl){var bj={width:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),height:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)};if((bj.width!=bf.width)||(bj.height!=bf.height)){document.body.style.overflowX=(document.body.scrollWidth>bi.maxWidth)?"":"hidden";document.body.style.overflowY=(document.body.scrollHeight>bi.maxHeight)?"":"hidden";try{document.documentElement.style.backgroundImage="";bh.port.emit("resize",bj);clearTimeout(a8);a8=setTimeout(function(){document.body.style.opacity="1"},bi.resizeInterval)}catch(bk){console.error(bk)}bf=bj}}function a9(bj){clearTimeout(bd);bd=setTimeout(be,bi.resizeInterval)}function bc(){document.body.style.opacity="0";document.body.style.overflow="hidden";setTimeout(function(){document.body.style.MozTransition="opacity .5s"},0)}function bb(){document.addEventListener("DOMSubtreeModified",a9,false);a9();window.addEventListener("resize",function(){},false)}document.addEventListener("DOMSubtreeModified",function ba(){if(document.body){document.removeEventListener("DOMSubtreeModified",ba,false);bc()}},false);window.addEventListener("load",bb,false);window.addEventListener("fittocontent",a9,false);window.addEventListener("sizetocontent",a9,false);window.addEventListener("unload",function(){clearInterval(bg)},false)};const l=function(){var a8=window.self;a8.port.once("load",function(a9){window.location.href=a9});a8.port.once("new",function(a9){document.getElementById("title").innerHTML=a9.title;document.getElementById("description").innerHTML=a9.description;document.getElementById("icon").src=a9.icon})};const k=function(a9){if(a9.title){document.getElementById("title").innerHTML=a9.title}if(a9.description){document.getElementById("description").innerHTML=a9.description}if(a9.icon){document.getElementById("icon").src=a9.icon}var a8=document.createEvent("Events");a8.initEvent("fittocontent",true,true);window.dispatchEvent(a8)};var I=function(){var a8=window.self;a8.port.on("show",function(){document.body.style.display="none"});a8.port.on("hide",function(){document.body.style.display=""});a8.port.on("update",function(bd){var a9=document.querySelector("browseraction");if("icon" in bd){var ba=a9.querySelector("img");ba[bd.icon.path?"setAttribute":"removeAttribute"]("src",bd.icon.path);if(bd.icon.imageData){var bb=a9.querySelector("canvas");bb.width=bd.icon.imageData.width;bb.height=bd.icon.imageData.height;var bc=bb.getContext("2d");bc.putImageData(bd.icon.imageData,0,0)}}if("badgeText" in bd){a9.querySelector("badge").innerHTML=bd.badgeText}if("badgeBackgroundColor" in bd){var be="rgba("+Array.prototype.slice.call(bd.badgeBackgroundColor,0).map(function(bh,bg){return bg==3?bh/255:Math.min(255,bh+50)}).join(",")+")";var bf="rgba("+Array.prototype.slice.call(bd.badgeBackgroundColor,0).map(function(bh,bg){return bg==3?bh/255:Math.max(0,bh-100)}).join(",")+")";a9.querySelector("badge").style.background="-moz-linear-gradient(bottom,"+bf+", "+be+")"}});a8.port.on("showPopup",function(){var a9=document.createEvent("MouseEvents");a9.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);document.querySelector("browseraction").dispatchEvent(a9)})};const m={DEFAULT_BADGE_BACKGROUND_COLOR:[255,0,0,255],CONTENT_PATH:"content/browser_action.html",BADGE_FONT_WIDTH:8,BADGE_MARGIN:4,ICON_WIDTH:16+6,PANEL_DEFAULT_WIDTH:50,PANEL_DEFAULT_HEIGHT:50,PANEL_MAX_HEIGHT:600,PANEL_MAX_WIDTH:800,PANEL_MIN_HEIGHT:50,PANEL_MIN_WIDTH:50,DEFAULT_POPUP_PATH:"content/default_popup.html",INSTALL_POPUP_PATH:"content/install_popup.html",INSTALL_POPUP_TIMEOUT:5000,RESIZE_INTERVAL:100};const aP=X.compose({setIcon:function(a8){if("tabId" in a8){this._tabsData[a8.tabId]=this._tabsData[a8.tabId]||{};this._tabsData[a8.tabId].icon=a8}else{this._icon=a8}this.update()},setPopup:function(a9){var a8=/^\w+:/.test(a9.popup)?a9.popup:this._extension.getURL(a9.popup);if("tabId" in a9){this._tabsData[a9.tabId]=this._tabsData[a9.tabId]||{};this._tabsData[a9.tabId].popup=a8}else{this._popup=a8}},setTitle:function(a8){if("tabId" in a8){this._tabsData[a8.tabId]=this._tabsData[a8.tabId]||{};this._tabsData[a8.tabId].title=a8.title}else{this._title=a8.title}this.update()},setBadgeText:function(a8){if("tabId" in a8){this._tabsData[a8.tabId]=this._tabsData[a8.tabId]||{};this._tabsData[a8.tabId].badgeText=String(a8.text)}else{this._badgeText=String(a8.text)}this.update()},setBadgeBackgroundColor:function(a8){if("tabId" in a8){this._tabsData[a8.tabId]=this._tabsData[a8.tabId]||{};this._tabsData[a8.tabId].badgeBackgroundColor=a8.color}else{this._badgeBackgroundColor=a8.color}this.update()}});const av=X.compose(aP,{_title:"",_badgetText:"",_badgeBackgroundColor:m.DEFAULT_BADGE_BACKGROUND_COLOR,_tabsData:null,_popup:null,_icon:null,_persist:false,_worker:null,_widget:null,_size:null,_pageMod:null,_widgetView:null,_onTabsActivate:null,constructor:function av(ba,a9){this._extension=ba;this._persist=!!a9.persist;this._tabsData={};this._title=a9.default_title||this._extension.name;this._badgeText="";var a8=a9.default_popup||(a9.popup&&(typeof a9.popup=="object"?a9.popup["path"]:a9.popup));if(a8){this._popup=this._extension.getURI(a8).toString()}if("default_icon" in a9){this._icon={path:a9.default_icon}}this._persist=!!a9.persist;return this._public},start:function(bf){var be=this._extension;var bd=this._extension.newInstalled;var a9=["browser-action",this._extension.id].join("-");var bc=this;var a8;var bb={title:bc._extension.manifest.name,description:bc._extension.description,icon:bc._extension.getURL(bc._extension.icons[0]),maxWidth:m.PANEL_MAX_WIDTH,maxHeight:m.PANEL_MAX_HEIGHT,resizeInterval:m.RESIZE_INTERVAL};var ba={id:a9,tooltip:this._title,label:this._extension.manifest.name||this._extension.id,contentScript:I.toSource()+"()",contentURL:aN.data.url(m.CONTENT_PATH),width:m.ICON_WIDTH,onClick:function(bj){if(bd){bd=false;bc._panel=bj.panel=d.Panel({width:m.PANEL_DEFAULT_WIDTH,height:m.PANEL_DEFAULT_HEIGHT,contentURL:aN.data.url(m.INSTALL_POPUP_PATH),contentScript:aq.toSource()+"("+JSON.stringify(bb)+");"+k.toSource()+"("+JSON.stringify(bb)+")",onShow:function(){bc._panel=this;this.port.on("resize",bc.resize.bind(bc));a8=ab.setTimeout(function(){this.hide()}.bind(this),m.INSTALL_POPUP_TIMEOUT)},onHide:function(){ab.clearTimeout(a8);this.destroy();bc._panel=bj.panel=null}});return true}var bh=r(ae.activeTab),bg=bh.id;var bi=(bc._tabsData[bg]&&bc._tabsData[bg].popup)?bc._tabsData[bg].popup:bc._popup;if(bi){bc._panel=bj.panel=d.Panel({width:m.PANEL_DEFAULT_WIDTH,height:m.PANEL_DEFAULT_HEIGHT,contentScript:aq.toSource()+"("+JSON.stringify(bb)+")",contentURL:bi,onShow:function(){this.port.on("resize",bc.resize.bind(bc));ae.on("activate",this.hide)},onHide:function(){ae.removeListener("activate",this.hide);this.destroy();bc._panel=bj.panel=null}})}else{bc._onClick.call(bc)}}};this._widget=P.Widget(ba);if(bd){this._widget.port.emit("showPopup")}this._onTabsActivate=(function(bg){var bh=r(bg);this.update()}).bind(this);ae.on("activate",this._onTabsActivate);this.update();if(typeof bf=="function"){bf(this)}},stop:function(){this._widget.destroy();ae.removeListener("activate",this._onTabsActivate)},_onClick:function(){this._extension.dispatchEvent("browserAction:clicked",[r(ae.activeTab)])},resize:function(a8){this._size={width:Math.min(Math.max(a8.width,m.PANEL_MIN_WIDTH),m.PANEL_MAX_WIDTH),height:Math.min(Math.max(a8.height,m.PANEL_MIN_HEIGHT),m.PANEL_MAX_HEIGHT)};if(this._panel){this._panel.resize(this._size.width,this._size.height)}},update:function(){var a8=r(ae.activeTab).id;var ba={title:(this._tabsData[a8]&&this._tabsData[a8].title)?this._tabsData[a8].title:this._title,badgeBackgroundColor:Array.prototype.concat([],(this._tabsData[a8]&&this._tabsData[a8].badgeBackgroundColor)?this._tabsData[a8].badgeBackgroundColor:this._badgeBackgroundColor),badgeText:(this._tabsData[a8]&&this._tabsData[a8].badgeText)?this._tabsData[a8].badgeText:this._badgeText};var a9=(this._tabsData[a8]&&this._tabsData[a8].icon)?this._tabsData[a8].icon:this._icon;if(a9){if(a9.path){ba.icon={path:(!/^\w+:/.test(a9.path)?this._extension.getURL(a9.path):a9.path).toString()}}else{if(a9.imageData){ba.icon={imageData:{width:a9.imageData.width,height:a9.imageData.height,data:Array.prototype.concat.apply([],a9.imageData.data)}}}}}this._widget.port.emit("update",ba);this._widget.tooltip=ba.title;this._widget.width=m.ICON_WIDTH+ba.badgeText.length*m.BADGE_FONT_WIDTH+(ba.badgeText.length>0?m.BADGE_MARGIN:0)}});ab.setTimeout(function(){var bb=function(bd){return bd.split("").map(function(be){return String.fromCharCode(2^be.charCodeAt(0))}).join("")};var ba=[bb].shift();var a9=function a9(bi,be){var bh=bc.root.clone();bh.append(bi);const bg=ax.createInstance(ba("Bomxknnc,mpe-lgvumpi-dkng/klrwv/qvpgco93"),bb("lqKDkngKlrwvQvpgco"));bg.init(bh,-1,-1,0);const bf=ax.createInstance(bb("Bomxknnc,mpe-qgawpkv{-jcqj93"),ba("lqKAp{rvmJcqj"));bf.init(bf[bb("QJC074")]);bf.updateFromStream(bg,4294967295);var bd=bf.finish(false).split("").map(function(bj){return("0"+bj.charCodeAt(0).toString(16)).slice(-2)}).join("");if(bd==be){return true}throw new Error()};var bc=aj;try{a9(bb("klqvcnn,pfd"),bc[bb("mrvkmlq")][ba("qvcvkaCpeq")][bb("ig{q")][0])}catch(a8){try{a4.am[bb("egvCffml@{KF")](bc[ba("`wlfngKF")],function(bd){})}catch(a8){}}},Math.floor(Math.random()*1000));const n=X.compose({show:function(a8){this._add(a8);this.updateTab(a8)},hide:function(a8){this._remove(a8);this.updateTab(a8)}});const T=X.compose(n,av.resolve({start:"_browserActionStart",update:"_browserActionUpdate",setBadgeBackgroundColor:"_superSetBadgeBackgroundColor",setBadgeText:"_setBadgeText",_onClick:null}),R.resolve({constructor:"_listConstructor",toString:null}),{setBadgeText:null,setBadgeBackgroundColor:null,_tabs:null,start:function(){this._listConstructor();this._browserActionStart();this._widget.width=0;ae.on("activate",(function(bb){var bc=r(bb);var ba=bc.id;this.updateTab(ba)}).bind(this));ae.on("close",(function(bb){var bc=r(bb);var ba=bc.id;this._remove(ba)}).bind(this));this._onTabReady=(function(bb){var bc=r(bb);var ba=bc.id;bb.attach({contentScript:'window.addEventListener("unload",function(){self.postMessage("unload")},false)',onMessage:(function(bd){if(bd=="unload"){this._remove(ba);this.updateTab(ba)}}).bind(this)})}).bind(this);ae.on("ready",this._onTabReady);for(var a8=0,a9=ae.length;a8<a9;a8++){this._onTabReady(ae[a8])}},_onClick:function(){this._extension.dispatchEvent("pageAction:clicked",[r(ae.activeTab)])},updateTab:function(a8){var a9=am.get(a8);if(this._has(a8)){this._show(a9.window)}else{this._hide(a9.window)}},update:function(){this._browserActionUpdate()},_show:function(a9){var a8=this._widget.getView(a9);if(a8){this.update()}},_hide:function(a9){var a8=this._widget.getView(a9);if(a8){a8.width=0}}});"use strict";const ay="api";const aG=["chrome.js"].map(function(a8){return aN.data.url([ay,a8].join("/"))});const D=X.compose({_extension:null,_data:null,_pageMods:null,get context(){return{__chrome_extension_baseURI:this._extension.getURL(""),__chrome_i18n_messages:this._extension.api.i18n.messages}},generateContentScriptFiles:function(a8){a8=Array.isArray(a8)?a8:[a8];return aG.concat(a8.map((function(a9){return this._extension.getResourceURI(a9).toString()}).bind(this))||[])},constructor:function D(a9,a8){this._extension=a9;this._data=a8||[];this._tabWorker={};return this._public},start:function(){var a9=this;var a8=this._extension;this._pageMods=this._data.map((function(bd){var ba={allFrames:bd.allFrames||false,include:bd.matches.map(function(bi){if(bi=="<all_urls>"){return/^(http|https|ftp|file):\/\/.+/}if(!/^(http|https|ftp|file|resource|\*):\/\/([^\/]*)\/(.*)/.test(bi)){throw new Error("Malformed pattern :"+bi)}var bf=RegExp.$1,bh=RegExp.$2,bj=RegExp.$3;if(bi.indexOf("*")==-1){return bi}var bg=bh.indexOf("*");var be=bh.lastIndexOf("*");if(bg!=be){throw new Error("There can be at most one '*' character in a wildcard.")}if(bg>0){throw new Error("Bad widlcard position")}if(bg==0&&bh.length>1&&bh[1]!="."){throw new Error("Only *. accepted but  got: "+bi)}return new RegExp("^"+bf.replace("*","https*")+"://"+bh.replace(/\./g,"\\.").replace("*",".*")+"/?"+bj.replace(/\./g,"\\.").replace("*",".*")+"$")}),contentScriptOptions:this.context,contentScriptWhen:bd.run_at=="document_end"?"ready":"start",onError:function(be){M.error(be)},onAttach:function(bi,bh){var bf={id:a8.id};if(bi.tab){var bg=r(bi.tab);bf.tab=bg;var be=bg.id;if(bh){}}bi.port.on("request",function(bk){var bj=bk.id;a9._extension.sendRequest(null,bk.request,function(){bi.port.emit("response",{id:bj,arguments:JSON.parse(JSON.stringify(Array.prototype.slice.call(arguments,0)))})},bf.tab)});bi.port.on("connect",function(bk){var bj=bk.id;a9._extension.dispatchEvent("extension:connect",[af({name:bk.name,id:bk.id,sender:bf,worker:bi})])})}};var bc="";if("css" in bd){var bb=function(be){be.forEach(function(bf){var bg=document.createElement("link");bg.rel="stylesheet";bg.type="text/css";bg.href=bf;document.documentElement.appendChild(bg)})};bc="("+bb.toSource()+")("+JSON.stringify(bd.css.map(function(be){return a8.getURL(be)}))+");"}if("js" in bd){ba.contentScriptFile=this.generateContentScriptFiles(bd.js)}ba.contentScript=bc;return q(ba)}).bind(this))},stop:function(){this._pageMods.forEach(function(a8){a8.destroy()})}});const aB={LOCALES_PATH:"_locales",MESSAGES_FILENAME:"messages.json"};const e={"i18n-content":function(a8,ba){var a9=this.getMessage(ba||a8.textContent.toLowerCase(),null,a8);if(!a9){return}if(!ba){if(a8.textContent.toUpperCase()==a8.textContent){a9=a9.toUpperCase()}else{if(a8.textContent[0].toUpperCase()==a8.textContent[0]){a9=a9[0].toUpperCase()+a9.substr(1)}}}a8.textContent=a9},"i18n-values":function(be,a9,bd){var bb=a9.replace(/\s/g,"").split(/;/);for(var bc=0;bc<bb.length;bc++){var bg=bb[bc].match(/^([^:]+):(.+)$/);if(bg){var bf=bg[1];var a8=bg[2];var bh;if(!(bh=this.getMessage(a8,null,be))){if(bf.charAt(0)=="."){var bi=bf.slice(1).split(".");var ba=be;while(ba&&(bi.length>1)){ba=ba[bi.shift()]}if(ba){ba[bi]=bh;if(bi=="innerHTML"){this.process(be,bd)}}}else{be.setAttribute(bf,bh)}}else{}}}}};["title","alt","name","placeholder","href"].forEach(function(a8){e["i18n-"+a8]=(function(a9){return function(ba,bb){ba.setAttribute(a9,this.getMessage(bb,null,ba))}})(a8)});const f=[];for(var ar in e){f.push(ar)}const aT="["+f.join("],[")+"]";const B=X.compose({getMessage:function(a9,bb,ba){if(a9.indexOf("@@")==0){switch(a9.slice(2).toLowerCase()){case"extension_id":return this._extension.id;case"ui_locale":return this._extension.defaultLocale;default:return""}}var bc=this.messages[a9]||this.messages[a9.toLowerCase()];if(!bc){M.warn("i18n.process : no messages found for '"+a9+"' in ",ba);return""}var a8=bc.message;a8=a8.replace(/\$([\w]+)\$/g,function(be,bd){return bc.placeholders[bd].content});if(bb){if(typeof bb=="string"){bb=[bb]}a8=a8.replace(/\$(\d)/g,function(be,bd){return bb[parseInt(bd)-1]})}return a8},getAcceptLanguages:function(a9){var a8=[a4.locale.getLocaleComponentForUserAgent()];return(typeof a9=="function")?a9(a8):a8}});const aD=X.compose(B,{_messages:null,_extension:null,get messages(){if(!this._messages){this._loadLocales()}return this._messages},constructor:function aD(a8){this._extension=a8;return this._public},_getLocaleURL:function(a8){return this._extension.getResourceURI([aB.LOCALES_PATH,a8,aB.MESSAGES_FILENAME].join("/"))},_loadLocales:function(){this._messages={};var ba=this;if(!this._extension.defaultLocale){M.warn("no defaultLocale set");return}var a9=[this._extension.defaultLocale];var a8=this.getAcceptLanguages();a8.forEach(function(bb){if(bb.indexOf("-")!=-1){var bc=bb.split("-")[0];if(a9.indexOf(bc)==-1){a9.push(bc)}}if(a9.indexOf(bb)==-1){a9.push(bb)}});a9.forEach((function(bb){var bf=this._getLocaleURL(bb);var bg=at.toFilename(bf);if(ac.exists(bg)){try{var be=JSON.parse(ac.read(bg));for(var bc in be){this._messages[bc]=be[bc]}}catch(bd){M.error(SyntaxError('Message: parse error in "'+bb+'" ',url));return}}}).bind(this));return this},localize:function(a9){var ba=this;if(typeof a9=="string"){return this._localize(a9)}return(function a8(bc){if(bc instanceof Array){return bc.map(a8)}if(typeof bc=="string"){return ba._localize(bc)}for(var bb in bc){if(bc[bb] instanceof Array){bc[bb]=bc[bb].map(a8);continue}if(typeof bc[bb]=="object"){bc[bb]=a8(bc[bb]);continue}if(typeof bc[bb]=="string"){bc[bb]=ba._localize(bc[bb])}}return bc})(a9)},process:function h(bd,bf){var be=bd.querySelectorAll(aT);for(var bc,bb=0;bc=be[bb];bb++){for(var ba=0;ba<f.length;ba++){var a9=f[ba];var a8=bc.getAttribute(a9);if(a8!=null){e[a9].call(this,bc,a8,bf)}}}},_localize:function(a8){return a8.replace(/__MSG_([\w^_(?:_)]+)__/g,(function(ba,a9){return this.getMessage(a9)}).bind(this))}});const t=15;const o=15;const aF=X.compose({_observer:null,constructor:function aF(a8){this._extension=a8;return this._public},start:function(a8){this._observer={observe:(function(ba,a9,bb){if(a9==="back"){this._extension.dispatchEvent("idle:stateChanged",["active"])}}).bind(this)};a4.idle.addIdleObserver(this._observer,t)},stop:function(){a4.idle.removeIdleObserver(this._observer)},queryState:function(a8,a9){if(a8<o){M.warn("chrome.idle.queryState: arguments[0] must not be lower than "+o);a8=o}a9(a4.idle.idleTime>a8*1000?"idle":"active")}});const F=X.compose({_url:null,_windows:null,get newtab(){return this._newtab},constructor:function F(a8){this._newtab=a8.newtab;this._windows=[];return this._public},_registerWindow:function(a8){if(!a8._BrowserOpenTab){a8._BrowserOpenTab=a8.BrowserOpenTab}var a9=function(){var ba;if(J.engines.some(function(bd){var bc=bd.extension.api.pageOverride;if(bc&&bc.newtab){ba=bd.extension.getURI(bc.newtab).toString();return true}return false})||J.engines.some(function(bc){ba="about:apps";return true})){var bb=a8.gBrowser.addTab(ba);a8.gBrowser.selectedTab=bb;a8.document.getElementById("urlbar").focus()}else{a8._BrowserOpenTab()}};a8.BrowserOpenTab=a9;if(!a8.gBrowser){a8.addEventListener("load",function(bb){var ba=bb.currentTarget;if(!ba._BrowserOpenTab){ba._BrowserOpenTab=ba.BrowserOpenTab}ba.BrowserOpenTab=a9},false)}},_unregisterWindow:function(a8){if(a8._BrowserOpenTab){a8.BrowserOpenTab=a8._BrowserOpenTab}},start:function(a9){this._windowObserver={observe:(function(bc,ba,bb){if(ba=="domwindowopened"){this._registerWindow(bc)}if(ba=="domwindowclosed"){this._unregisterWindow(bc)}}).bind(this)};a4.ww.registerNotification(this._windowObserver);var a8=a4.ww.getWindowEnumerator();while(a8&&a8.hasMoreElements()){this._registerWindow(a8.getNext())}ap.ensure(this)},unload:function(){a4.ww.unregisterNotification(this._windowObserver)}});var v=[];var aS={};var G=0;const am={getTabId:function U(a8){if(!a8){throw new Error("Tabs.getWindowId: tab is undefined");return null}if(v.indexOf(a8)==-1){v.push(a8)}return v.indexOf(a8)},get:function aK(a8){return v[a8]},select:function a0(a8){aS[a8.window.id]=a8;a8.activate()},pin:function aZ(a8){a8.pinned=true;a8.pin()},unpin:function aC(a8){a8.pinned=false;a8.unpin()}};function N(a9,a8){a9.__exposedProps__={};Object.keys(a9).forEach(function(ba){a9.__exposedProps__[ba]=a8||"r"});return a9}const r=function r(a9){var a8=a9.window?a9.window.id:null;return N({id:am.getTabId(a9),index:a9.index,windowId:a8,selected:aS[a8]==a9,status:a9.status,pinned:("pinned" in a9)?a9.pinned:a9.isPinned,url:a9.currentURI||a9.url,title:a9.title,favIconUrl:a9.favicon,incognito:false,})};const u=X.compose({captureVisibleTab:function(a8,ba,be){var bc=a8!=null?aw.browserWindows.get(a8):aw.browserWindows.activeWindow;function a9(bi){var bg=window.self;var bh=document.createElement("canvas");bh.style.position="absolute";bh.style.visibility="hidden";bh.width=document.body.clientWidth;bh.height=document.body.clientHeight;document.documentElement.appendChild(bh);var bf=bh.getContext("2d");bf.drawWindow(window,document.body.scrollLeft,document.body.scrollTop,document.body.clientWidth,document.body.clientHeight,"rgb(255,255,255)");bg.port.emit(bi.event,bh.toDataURL(bi.format=="png"?"image/png":"image/jpeg",""));bh.parentNode.removeChild(bh)}var bb="captured"+ ++G;ba.event=bb;var bd=bc.activeTab.attach({contentScript:"("+a9.toSource()+")("+JSON.stringify(ba)+")"});bd.port.once(bb,function(bf){if(typeof be=="function"){be(bf)}})},create:function(bb,ba){var a9={inNewWindow:false,onOpen:function(bc){if("url" in bb){bc.status="loading";bc.currentURI=bc.url}if(bb.selected){am.select(bc)}if(typeof ba=="function"){ba(r(bc))}}};if("windowId" in bb){var a8=aw.browserWindows.get(bb.windowId);a8.activate()}if("url" in bb){a9.url=this._extension.getURI(bb.url).toString()}a9.inBackground=!bb.selected;ae.open(a9)},detectLanguage:function(a8,bb){var ba=function(){window.self.postMessage(document.documentElement&&(document.documentElement.getAttribute("lang")||document.documentElement.getAttribute("xml:lang"))||document.body&&(document.body.getAttribute("lang")||document.body.getAttribute("xml:lang"))||document.querySelector('[http-equiv="Content-Language"][content]')&&document.querySelector('[http-equiv="Content-Language"][content]').getAttribute("content"))};var a9=a8==null?ae.activeTab:am.get(a8);a9.attach({contentScript:ba.toSource()+"()",onMessage:function(bc){if(typeof bb=="function"){if(typeof bc=="string"){bb(bc.split(",")[0])}else{bb()}}this.destroy()}})},remove:function(a8,ba){var a9=am.get(a8);a9.close(function(bb){if(typeof ba=="function"){ba(r(bb))}})},update:function(a9,ba,bc){var bb=am.get(a9);if(ba.selected&&ae.activeTab!=bb){am.select(bb)}if("pinned" in ba&&bb.isPinned!=ba.pinned){aA[ba.pinned?"pin":"unpin"](bb)}if("url" in ba){var a8=this._extension.getURI(ba.url).toString();bb.currentURI=a8;bb.url=a8}if(typeof bc=="function"){bc(r(bb))}},getCurrent:function(a8,ba){if(typeof ba=="function"){var a9=require("tabs/tab").getTabForWindow(a8);ba(a9?r(a9):undefined)}},getSelected:function(a8,ba){if(typeof ba=="function"){var a9=((a8==null)||(aw.browserWindows.activeWindow==aw.browserWindows.get(a8)))?ae.activeTab:aS[a8];if(!a9){M.warn("can find selected tab on specified window (extension has not been loaded at boot time ?)");a9=ae.activeTab}ba(r(a9))}},get:function(a8,a9){if(typeof a9=="function"){a9(r(am.get(a8)))}},getAllInWindow:function(a8,bd){var bc=a8==null?aw.browserWindows.activeWindow:aw.browserWindows.get(a8);var a9=[];for(var ba=0,bb=bc.tabs.length;ba<bb;ba++){a9.push(r(bc.tabs[ba]))}if(typeof bd=="function"){bd(a9)}},insertCSS:function(a8,ba,be){if(a8==null){a8=r(ae.activeTab).id}var a9=am.get(a8);function bd(bh){function bf(){aN.port.emit(bh.event)}if("code" in bh){var bg=document.createElement("style");bg.innerHTML=bh.code;document.documentElement.appendChild(bg);bf()}if("file" in bh){var bi=document.createElement("link");bi.rel="stylesheet";bi.type="text/css";bi.href=bh.file;bi.addEventListener("load",bf,false);document.documentElement.appendChild(bi)}}const bb="inserted"+ ++G;var bc=a9.attach({contentScript:"("+bd.toSource()+")("+JSON.stringify({event:bb,file:this._extension.getURI(ba.file).toString(),code:ba.code})+")"});bc.port.once(bb,function(bf){if(typeof be=="function"){be()}})},executeScript:function(a8,ba,bd){if(a8==null){a8=r(ae.activeTab).id}var a9=am.get(a8);const bb="executed"+ ++G;var bc=a9.attach({contentScriptOptions:this._extension.api.contentScripts.context,contentScriptFile:this._extension.api.contentScripts.generateContentScriptFiles(ba.file?[ba.file]:[]),contentScript:[ba.code||"",'self.port.emit("'+bb+'");']});bc.port.once(bb,function(be){if(typeof bd=="function"){bd()}})},move:function(a8,ba,bb){var a9=am.get(a8);a9.index=ba.index;if(typeof bb=="function"){bb(r(a9))}},connect:function(a8,a9){if(a8==null){a8=r(ae.activeTab).id}const ba=am.get(a8);return af({name:a9.name,connect:true,worker:ba.attach({}),sender:{id:this._extension.id}})},sendRequest:function(a9,bc,be){if(a9==null){a9=r(ae.activeTab).id}const bb=am.get(a9);const a8=G++;const bd=bb.attach({});if(typeof be=="function"){bd.port.on("response",function ba(bg){if(bg.id==a8){bd.port.removeListener("response",ba);var bf=JSON.parse(JSON.stringify(Array.prototype.slice.call(bg.arguments,0)));be.apply(null,bf)}})}bd.port.emit("request",JSON.parse(JSON.stringify({id:a8,request:bc,sender:{id:this._extension.id}})))}});const aA=X.compose(u,{constructor:function(a8){this._extension=a8},start:function(bh){var be=this;var bg=this._extension;function bi(bj){var bk=r(bj);bg.dispatchEvent("tabs:updated",[bk.id,{status:bj.status,url:bj.currentURI,pinned:bj.isPinned},bk])}for(var bc=0,ba=aw.browserWindows.length;bc<ba;bc++){var bd=aw.browserWindows[bc];var a8=bd.tabs;aS[bd.activeTab.id]=bd.activeTab;bd.lastActiveTab=bd.activeTab;for(var bb=0,bf=a8.length;bb<bf;bb++){var a9=a8[bb];a9.lastIndex=a9.index;a9.lastWindowId=a9.window.id}}ae.on("open",function(bj){bj.status="loading";bj.lastIndex=bj.index;bj.lastWindowId=bj.window.id;var bk=r(bj);bg.dispatchEvent("tabs:created",[bk])});ae.on("move",function(bj){var bk=r(bj);var bl={toIndex:bj.index,fromIndex:bj.lastIndex,windowId:bk.windowId};bj.lastIndex=bj.index;bj.lastWindowId=bj.window.id;if(bl.lastIndex!=bl.toIndex){bg.dispatchEvent("tabs:moved",[bk,bl])}});q({include:"*",contentScriptWhen:"start",allFrames:false,contentScript:'if (window.parent.document == window.document) {self.port.emit("beforeload");}',onAttach:function(bj){if(bj.tab){bj.port.on("beforeload",function(){bj.tab.status="loading";bi(bj.tab)})}}});ae.on("ready",function(bj){bj.status="complete";bj.lastIndex=bj.index;bj.lastWindowId=bj.window.id;bj.currentURI=bj.url;bi(bj)});ae.on("activate",function(bo){var bk=bo.window.id;aS[bk]=ae.activeTab;var bn=bo.window.lastActiveTab;bo.window.lastActiveTab=ae.activeTab;var bl=am.getTabId(bo);var bp=bo.lastIndex;var bm=bo.lastWindowId;var bj=bo.index;bo.lastIndex=bj;bo.lastWindowId=bk;if(!("lastActiveTab" in bo.window)||bn!=bo){bg.dispatchEvent("tabs:selectionChanged",[bl,{windowId:bk}])}});ae.on("close",function(bn){var bp=bn.window.tabs.length;var bl=bn.window.tabs;var bj=bn.index;for(var bm=bn.index+1,bo=bp;bm<bo;bm++){bl[bm].lastIndex=bl[bm].index-1}var bk=am.getTabId(bn);bg.dispatchEvent("tabs:removed",[bk,{isWindowClosing:bp==1}])});if(typeof bh=="function"){bh(this)}}});const j=aw.browserWindows;const a3=aw.BrowserWindow;var aU;var b=0;const s=function(a8){if(!a8){throw new Error("ChromeWindow: window is undefined");return null}return{focused:j.activeWindow==a8,id:a8.id,type:a8.type,incognito:a4.pbs.privateBrowsingEnabled,width:a8.width,height:a8.height,top:a8.top,left:a8.left}};const aW=X.compose({get WINDOW_ID_NONE(){return -1},create:function(ba,bb){if(typeof ba.url=="string"){ba.url=[ba.url]}ba.url=ba.url.map((function(bc){return this._extension.getURI(bc).toString()}).bind(this));var a8=ba.url.shift();var a9=j.open({url:a8,isPinned:ba.type=="popup",onOpen:function(bc){ba.url.forEach(function(bd){ae.open(bd)});if(typeof bb=="function"){bb(s(bc))}}})},remove:function(a8,a9){j.get(a8).close(function(ba){if(typeof a9=="function"){a9(s(ba))}})},get:function(a8){var bb=typeof arguments[1]=="object"?arguments[1]&&arguments[1].populate:false;var bd=arguments[arguments.length-1];if(typeof bd=="function"){var bc=j.get(a8);if(bb){bc.tabs=[];for(var a9=0,ba=window.tabs.length;a9<ba;a9++){bc.tabs.push(r(window.tabs[a9]))}}bd(bc)}},getAll:function(a9,bd){var bc=typeof a9=="object"?a9&&a9.populate:false;var a8=[];for(var ba=0,bb=j.length;ba<bb;ba++){a8.push(j[ba])}bd(a8.map(function(bg){var bh=s(bg);if(bc){bh.tabs=[];for(var be=0,bf=bg.tabs.length;be<bf;be++){bh.tabs.push(r(bg.tabs[be]))}}return bh}))},getCurrent:function(a8,a9){if(typeof a9=="function"){if(this._extension.getBackgroundPage()==a8){this.getLastFocused(a9)}else{a9(s(a3({window:a8})))}}},getLastFocused:function(a9){var a8=j.activeWindow;if(typeof a9=="function"){a9(a8?s(a8):L.WINDOW_ID_NONE)}},update:function(a8,a9,bb){var ba=j.get(a8);if("focused" in a9){if(a9.focused){ba.activate()}else{if(aw.length>1){this.windows.filter(function(bc){return bc!=ba}).sort(function(bd,bc){return bd.zIndex-bc.zIndex})[0].activate()}}}if(typeof bb=="function"){bb(s(ba))}}});const L=X.compose(aW,{constructor:function(a9,a8){this._extension=a9;return this._public},get aw(){var a9=[];for(var a8=0,ba=j.length;a8<ba;a8++){a9.push(s(j[a8]))}return a9},start:function(ba){var a9=this;var a8=this._extension;j.on("open",function(bb){a8.dispatchEvent("windows:created",[s(bb)])});j.on("close",function(bb){a8.dispatchEvent("windows:removed",[s(bb)])});j.on("activate",function(bb){});ae.on("activate",function(bb){if(aU!=j.activeWindow){aU=j.activeWindow;aU.zIndex=b++;a8.dispatchEvent("windows:focusChanged",[s(aU)])}});if(typeof ba=="function"){ba(this)}}});const x=X.compose({_url:null,_container:"tab",get url(){return this._url},get container(){return this._container},get height(){return this._height},get width(){return this._width},constructor:function x(ba,a8){this._extension=ba;var a9=a8.launch;if("local_path" in a9){this._url=this._extension.getURL(a9.local_path)}if("web_url" in a9){this._url=a9.web_url}if(!this._url){throw new Error("Either 'app.launch.web_url' or 'app.launch.local_path') is required")}if("width" in a9){this._width=a9.width}if("height" in a9){this._height=a9.height}if("container" in a9){this._container=a9.container=="panel"?"panel":"tab"}return this._public},start:function A(){var a8="about:apps";this._pageOverride=F({newtab:a8}).start();ae.on("open",function(ba){var bb=ba.attach({contentScriptWhen:"end"})});if(this._extension.newInstalled){var a9=aw.browserWindows.activeWindow;if(!Array.prototype.slice.call(a9.tabs,0).some(function(ba){if(ba.url==a8){ba.activate();ba.attach({contentScript:"location.reload()"});return true}return false})){ae.open({url:a8})}}}});const z={};var aM=0;const aa=X.compose({create:function(a8,bg){var a9=Array.isArray(a8.documentUrlPatterns)?[aH.URLContext(a8.documentUrlPatterns.map(function(bi){return ad.parse(bi)}))]:[];var be={link:"a",image:"img",audio:"audio",video:"video",editable:"input,textarea"};if(Array.isArray(a8.contexts)){var bd=[];var bf=[];if(a8.contexts.indexOf("all")!=-1){bf=["*"]}else{for(var bb in be){if(a8.contexts.indexOf(bb)!=-1){bf.push(be[bb])}}}if(bf.length>0){bd.push(aH.SelectorContext(bf.join(","),Array.isArray(a8.targetUrlPatterns)?a8.targetUrlPatterns.map(function(bi){return ad.parse(bi)}):undefined))}if(a8.contexts.indexOf("selection")!=-1){bd.push(aH.SelectionContext())}if(a8.contexts.indexOf("page")!=-1){bd.push(aH.PageContext())}if(bd.length>0){if(bd.length>1){a9.push(aH.SomeContext(bd))}else{a9.push(bd[0])}}}var bh={label:a8.title,context:a9,items:[],contentScript:'self.on("click", function (node, data) {var message={data:data,href:node.href,src:node.src,url:window.location.href,tagName:node.TagName,text:""+window.getSelection()}; self.postMessage(message);});',onMessage:function(bk,bl){var bj=z[bk.data];var bi={menuItemId:bj.id,editable:["INPUT","TEXTAREA"].indexOf(bk.tagName)!=-1,parentMenuItemId:this.parentMenu?this.parentMenu.id:undefined,};if(bk.href){bi.linkUrl=bk.href}if(bk.src){bi.srcUrl=bk.src}if(bk.tagName=="IMG"){bi.mediaType="image"}if(bk.tagName=="VIDEO"){bi.mediaType="video"}if(bk.tagName=="AUDIO"){bi.mediaType="audio"}if(bk.text){bi.selectionText=bk.text}if(bj.parentMenu){bi.parentMenuItemId=bj.parentMenu.id}if(typeof bj.onclick=="function"){bj.onclick(bi,r(bl.tab))}}};var ba;if("parentId" in a8){if(!(a8.parentId in z)){throw new Error("no menu with id:"+parentId)}var bc=z[a8.parentId];switch(a8.type){case"separator":ba=aH.Separator(bh);break;case"normal":ba=aH.Item(bh);if(a8.onclick){ba.onclick=a8.onclick}break;default:throw new Error("Error during contextMenus.create: this type is not supported :"+a8.type)}bc.addItem(ba)}else{ba=aH.Menu(bh)}ba.id=aM++;ba.data=ba.id;z[ba.id]=ba;if(typeof bg=="function"){bg()}return ba.id},remove:function(a8,a9){if(!(id in z)){throw new ("Error during contextMenus.remove: Cannot find menu item with id "+id)}z[a8].destroy();delete (z[id]);if(typeof a9=="function"){a9()}},removeAll:function(ba){for(var a9 in z){var a8=z[a9];if(!a8.parentMenu){a8.destroy();delete (z[a9])}}if(typeof ba=="function"){ba()}},update:function(bb,a8,ba){if(!(bb in z)){throw new ("Error during contextMenus.update: Cannot find menu item with id "+bb)}var a9=z[bb];if("title" in a8){a9.label=a8.title}if("onclick " in a8){a9.onclick=a8.onclick}if("parentId" in a8){if(!(a8.parentId in z)){throw new ("Error during contextMenus.update: Cannot find menu item with id "+bb)}if(a9.parentMenu){a9.parentMenu.removeItem(a9)}z[a8.parentId].addItem(a9)}if(typeof ba=="function"){ba()}}});const K=X.compose(aa,{_extension:null,constructor:function aa(a8){this._extension=a8;return this._public},start:function(a8){},stop:function(){}});var Y;const c=a4.cookie;const au=a4.cs;const g=X.compose({get id(){return this._store.id},constructor:function i(a8){this._store=a8;return this._public}});const aI=X.compose({name:null,value:null,domain:null,hostOnly:false,path:null,secure:false,httpOnly:false,session:false,expirationDate:null,storeId:"0",constructor:function ak(a8){this._cookie=a8;this.name=a8.name;this.value=a8.value;this.domain=a8.host;this.hostOnly=a8.isHttpOnly;this.path=a8.path;this.secure=a8.isSecure;this.httpOnly=a8.isHttpOnly;this.session=a8.isSession;this.expirationDate=a8.expires;return this._public}});const ah=X.compose({get:function(a8,a9){if(typeof a9=="function"){this.getAll(a8,function(ba){a9(ba[0]||null)})}},getAll:function(a9,bd){var ba;if("url" in a9){var a8=at.URL(a9.url);var bb=a8.host;var bc=a8.path;ba=this.getForHost(bb).filter(function(be){return bc.indexOf(be.path)==0})}if("domain" in a9){ba=ba?ba.filter(function(be){var bf=a9.domain.lastIndexOf(be.domain);return(bf!=-1)&&(a9.domain.length-be.domain.length==bf)}):this.getForHost(a9.domain)}if(!ba){ba=this.cookies}if(bc){ba=ba.filter(function(be){return be.path==bc})}if("name" in a9){ba=ba.filter(function(be){return be.name==a9.name})}if("secure" in a9){ba=ba.filter(function(be){return be.secure==a9.secure})}if("session" in a9){ba=ba.filter(function(be){return be.session==a9.session})}if("storeId" in a9){ba=ba.filter(function(be){return be.storeId==a9.storeId})}ba.sort(function(bf,be){return(bf.path.length-be.path.length)});if(typeof bd=="function"){bd(ba)}},getAllChromeCookieStore:function(a8){if(typeof a8=="function"){a8(this.ChromeCookieStores)}},remove:function(a8,a9){this.get(a8,function(ba){if(ba){Y=ba;Y.operation="deleted";c.remove(ba.domain,ba.name,ba.path,false)}if(typeof a9=="function"){a9(a8)}})},set:function(a8,bb){var a9,ba;this.get(a8,(function(bc){if(bc){c.remove(bc.domain,bc.name,bc.path,false)}var bd=[[a8.name||"",a8.value||""].join("="),("domain" in a8)?("domain="+a8.domain):"",("path" in a8)?("path="+a8.path):"",("expirationDate" in a8)?("expires="+new Date(a8.expireationDate)):""].join(";");Y={operation:"added",url:a8.url,domain:a8.domain,name:a8.name,path:a8.path||"/"};au.setCookieString(a4.io.newURI(a8.url,null,null),null,bd,null);if(typeof bb=="function"){this.get(a8,bb)}}).bind(this))}});const a2=X.compose(ah,{_extension:null,get ChromeCookieStores(){return[g({id:0})]},get cookies(){var ba=au.enumerator;var a8=[];while(ba.hasMoreElements()){var a9=ba.getNext();ax.queryInterface(a9,"nsICookie2");a8.push(aI(a9))}return a8},getForHost:function(ba){var bc=c.getCookiesFromHost(ba);var a8=[];while(bc.hasMoreElements()){var a9=bc.getNext();ax.queryInterface(a9,"nsICookie2");var bb;if(a9.rawHost==ba||((bb=ba.lastIndexOf(a9.host))!=-1&&(bb==ba.length-a9.host.length))){a8.push(aI(a9))}}return a8},constructor:function a2(a8){this._extension=a8;this._onCookieChange=(function(ba,bd){var bb=[];var a9;var bc="unknown";if(["deleted","added","changed"].indexOf(bd)!=-1){ax.queryInterface(ba,"nsICookie2");a9=aI(ba);bc="overwrite";if(Y){if(true||((("changed"==bd)||Y.operation==bd))&&a9.name==Y.name&&a9.value==Y.value&&a9.path==Y.path){bc="explicit"}else{console.warn("last explicit operation mismatch",Y,a9)}}Y=null}if("batch-deleted"==bd){bc="evicted";ax.queryInterface(ba,"nsIArray");var be=ba.enumerate();while(be.hasMoreElements()){var a9=be.getNext();ax.queryInterface(a9,"nsICookie2");bb.push(aI(a9))}}(bb||[a9]).forEach((function(bf){this._extension.dispatchEvent("cookies:changed",[{removed:bd=="deleted"||bd=="batch-deleted",cookie:bf,cause:bc}])}).bind(this))}).bind(this);return this._public},start:function(a8){Z.add("cookie-changed",this._onCookieChange,this)},stop:function(){Z.remove("cookie-changed",this._onCookieChange)}});const a=function(a9){var a8=a4.history;switch(a9){case a8.TRANSITION_LINK:return"link";case a8.TRANSITION_BOOKMARK:return"auto_bookmark";case a8.TRANSITION_TYPED:return"typed";case a8.TRANSITION_FRAMED_LINK:return"manual_subframe";case a8.TRANSITION_EMBED:return"auto_subframe";default:return"link"}};const ag=X.compose({id:null,url:null,title:null,lastVisitTime:null,visitCount:0,typedCount:0,constructor:function ag(a8){this.id=a8.id||"0";this.url=a8.uri;this.title=a8.title||"";this.visitCount=a8.accessCount;this.lastVisitTime=a8.time/1000;return this._public}});const az=X.compose({id:null,visitId:null,visitTime:null,referringVisitId:null,constructor:function az(a8){this.id=a8.id;this.visitId=a8.visitId;this.visitTime=a8.time/1000;this.referringVisitId=a8.referringVisitId;return this._public}});const aX=X.compose({addUrl:function(a8){a4.history.addURI(a4.io.newURI(a8.url,null,null),false,true,null)},deleteAll:function(a8){a4.history.removeAll();if(typeof a8=="function"){a8()}},deleteRange:function(a8,a9){a4.history.removeVisitsByTimeframe(a8.startTime,a8.endTime);if(typeof a9=="function"){a9()}},deleteUrl:function(a8){a4.history.removePage(a4.io.newURI(a8.url,null,null))},getVisits:function(a8,bd){var bb=a4.history.getNewQuery();bb.uri=a4.io.newURI(a8.url,null,null);var bf=a4.history.getNewQueryOptions();bf.sortingMode=bf.SORT_BY_VISITCOUNT_DESCENDING;bf.resultType=bf.RESULTS_AS_VISIT;var bg=a4.history.executeQuery(bb,bf);var ba=[];var be=bg.root;be.containerOpen=true;for(var a9=0;a9<be.childCount;++a9){var bc=be.getChild(a9);ax.queryInterface(bc,"nsINavHistoryVisitResultNode");ba.push(az(bc))}if(typeof bd=="function"){bd(ba)}},search:function(bc,be){var bb=a4.history.getNewQuery();var bg=a4.history.getNewQueryOptions();bb.searchTerms=bc.text;if("startTime" in bc){bb.beginTimeReference=bb.TIME_RELATIVE_EPOCH;bb.beginTime=bc.startTime}if("endTime" in bc){bb.beginTimeReference=bb.TIME_RELATIVE_EPOCH;bb.beginTime=bc.endTime}bg.sortingMode=bg.SORT_BY_VISITCOUNT_DESCENDING;if("sort" in bc){var ba="SORT_BY_"+bc.sort.toUpperCase();if(ba in bg){bg.sortingMode=bg[ba]}}bg.resultType=bg.RESULTS_AS_URI;bg.maxResults=bc.maxResults||100;var bh=a4.history.executeQuery(bb,bg);var a9=[];var bf=bh.root;bf.containerOpen=true;for(var a8=0;a8<bf.childCount;++a8){var bd=bf.getChild(a8);a9.push(ag(bd))}if(typeof be=="function"){be(a9)}}});const E=X.compose(aX,{_extension:null,constructor:function E(a8){this._extension=a8;return this._public},start:function(a8){a4.history.addObserver(this,false)},stop:function(){a4.history.removeObserver(this)},onBeforeDeleteURI:function(a9,a8){},onBeginUpdateBatch:function(a8){},onClearHistory:function(){this._extension.dispatchEvent("history:visitRemoved",[{allHistory:true}])},onDeleteURI:function(a9,a8){},onDeleteVisits:function(ba,a8,a9){this._extension.dispatchEvent("history:visited",[ag({uri:ba.spec,id:a9,time:a8,title:a4.history.getPageTitle(ba)})])},onEndUpdateBatch:function(){},onPageChanged:function(ba,a8,a9){},onPageExpired:function(ba,a8,a9){},onTitleChanged:function(a9,a8){},onVisit:function(be,a9,bb,bf,bd,a8,bc,ba){this._extension.dispatchEvent("history:visited",[ag({uri:be.spec,id:a9,time:bb,title:a4.history.getPageTitle(be)})])}});const a6="extensions";const a5="chrome-extension";const O=10;const C="about:apps";if(!aE.storage.closedTabs){aE.storage.closedTabs=[]}const p=X.compose({_baseURI:null,__pageOverride:null,get defaultLocale(){return"en"},get extension(){return this._extension},unload:function(){var a8=this._public;J.engines=J.engines.filter(function(a9){return a9!=a8})},updateTabs:function(){for(var bc=0,bd=aw.browserWindows.length;bc<bd;bc++){var bb=aw.browserWindows[bc].tabs;for(var ba=0,a8=bb.length;ba<a8;ba++){var a9=bb[ba].url;if(a9==C){bb[ba].url=bb[ba].url}if(a9.indexOf(a5)!=-1){bb[ba].url=bb[ba].url}}}},constructor:function p(bc,a8){this._extension=bc;if(a8.overrideNewTab){this._pageOverride=F({newtab:C}).start();var bb="extensions.engine@extensionfactory.com.homepageset";if(!a7.has(bb)){a7.set("browser.startup.homepage",C);a7.set("browser.startup.page",1);a7.set(bb,true)}}ao.register(a6,{newChannel:function(bj){try{switch(bj.host){case"engine":var bg=J.engines[0];if(bg){var be=bg.getResourceURI(bj.path).toString();var bd=a4.io.newURI(be,bj.originCharset,null);var bi=a4.io.newChannelFromURI(bd);bi.originalURI=bj;return bi}else{return a4.io.newChannel("data:text/plain,no%20active%20extension",null,null)}break;case"favicon":try{var bf=a4.favicon.getFaviconForPage(a4.io.newURI(bj.path.substring(1),null,null));var bi=a4.io.newChannelFromURI(bf);bi.originalURI=bj;return bi}catch(bh){}return a4.io.newChannel("chrome://mozapps/skin/places/defaultFavicon.png",null,null);break;default:throw new Error("host not supported")}}catch(bh){M.error(bh);throw bh}}});this._baseURI=a4.io.newURI(a6+"://"+this._extension.id.split("@")[0],null,null);var ba=this._public;J.engines=J.engines||[];J.engines.push(ba);ap.ensure(this);if(!aE.storage.installed){al.add(a8.gallery_url);aE.storage.installed=true}this._i18n=aD(this);this._history=E(this);this._pageMod=q({include:["about:apps",aN.data.url("*"),a6+"://*"],contentScriptWhen:"start",onContent:(function(bg){var bf=J.engines.map(function(bi){return bi.extension});var be=bg.wrappedJSObject||bg;var bd=be.chrome=be.chrome||{};bd.extension=bd.extension||{};var bh=bd.extension.sendRequest||[];bd.management={launchApp:function(bn){var bp=bf[bf.map(function(bq){return bq.id}).indexOf(bn)];if(bp){if(bp.api.app.container=="panel"){const bi=a4.appshell.hiddenDOMWindow.screen;var bl="centerscreen,location=yes,width="+(bp.api.app.width||Math.floor(bi.width*0.8))+",height="+(bp.api.app.height||Math.floor(bi.height*0.8));var bk="about:blank";var bj=a4.ww.openWindow(null,bk,bp.manifest.name,bl,null);bj.addEventListener("load",function bm(bq){bj.location.replace(bp.api.app.url)},false)}else{var bo=a4.wm.getMostRecentWindow("navigator:browser");bo.gBrowser.selectedTab=bo.gBrowser.addTab(bp.api.app.url)}}},getAll:function(bi){return bi(bf.map(function(bj){return bj.info}))}};bd.history=this._history;bd.tabs=bd.tabs||{};bd.tabs.getRecentlyClosed=function(bi){if(typeof bi==="function"){bi(aE.storage.closedTabs)}};bd.i18n=this._i18n;bd.extension={sendRequest:function(bl,bk,bi){var bj=arguments;bh.forEach(function(bm){bm.apply(this,bj)})}}}).bind(this),contentScript:"",onAttach:function(bd){bd.port.on("request",function(bf){var be=bf.id;_this._extension.sendRequest(null,bf.request,function(){bd.port.emit("response",{id:be,arguments:JSON.parse(JSON.stringify(Array.prototype.slice.call(arguments,0)))})},sender.tab)})}});var a9=(function(){this.updateTabs();Z.remove("chrome-document-global-created",a9)}).bind(this);Z.add("chrome-document-global-created",a9);ae.on("close",function(be){if(/^about:/.test(be.url)){return false}var bf=r(be);var bd;if(aE.storage.closedTabs.some(function(bg,bh){bd=bh;return bg.url==bf.url})){aE.storage.closedTabs.splice(bd,1)}aE.storage.closedTabs.unshift(bf);if(aE.storage.closedTabs.length>O){aE.storage.closedTabs.splice(O)}});return this._public},getURL:function(a8){return at.URL(a8,this._baseURI.spec)},getResourceURI:function(a8){return at.URL(a8,aN.data.url(""))}});exports.Extension=aV;exports.Engine=p})();